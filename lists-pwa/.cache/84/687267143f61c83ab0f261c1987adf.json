{"id":"A6C1","dependencies":[{"name":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\package.json","includedInParent":true,"mtime":1603796256257},{"name":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\package.json","includedInParent":true,"mtime":1603788678842},{"name":"tslib","loc":{"line":1,"column":86},"parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\tslib\\tslib.es6.js"},{"name":"@firebase/app","loc":{"line":3,"column":14},"parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\app\\dist\\index.esm.js"},{"name":"@firebase/logger","loc":{"line":5,"column":43},"parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\logger\\dist\\index.esm.js"},{"name":"@firebase/util","loc":{"line":7,"column":134},"parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\util\\dist\\index.esm.js"},{"name":"@firebase/webchannel-wrapper","loc":{"line":9,"column":108},"parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\webchannel-wrapper\\dist\\index.esm.js"},{"name":"@firebase/component","loc":{"line":11,"column":31},"parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\component\\dist\\index.esm.js"},{"name":"process","parent":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\@firebase\\firestore\\dist\\index.esm.js","resolved":"S:\\Documents\\Master 2\\PWA\\pwa-react\\lists-pwa\\node_modules\\process\\browser.js"}],"generated":{"js":"var process = require(\"process\");\nvar t=require(\"process\");Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.__PRIVATE_registerFirestore=sa;var e=require(\"tslib\"),n=u(require(\"@firebase/app\")),r=require(\"@firebase/logger\"),i=require(\"@firebase/util\"),o=require(\"@firebase/webchannel-wrapper\"),s=require(\"@firebase/component\");function u(t){return t&&t.__esModule?t:{default:t}}function a(t){return(a=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}var c={OK:\"ok\",CANCELLED:\"cancelled\",UNKNOWN:\"unknown\",INVALID_ARGUMENT:\"invalid-argument\",DEADLINE_EXCEEDED:\"deadline-exceeded\",NOT_FOUND:\"not-found\",ALREADY_EXISTS:\"already-exists\",PERMISSION_DENIED:\"permission-denied\",UNAUTHENTICATED:\"unauthenticated\",RESOURCE_EXHAUSTED:\"resource-exhausted\",FAILED_PRECONDITION:\"failed-precondition\",ABORTED:\"aborted\",OUT_OF_RANGE:\"out-of-range\",UNIMPLEMENTED:\"unimplemented\",INTERNAL:\"internal\",UNAVAILABLE:\"unavailable\",DATA_LOSS:\"data-loss\"},h=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name=\"FirebaseError\",r.toString=function(){return r.name+\": [code=\"+r.code+\"]: \"+r.message},r}return(0,e.__extends)(n,t),n}(Error),f=new r.Logger(\"@firebase/firestore\");function l(){return f.logLevel}function p(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(f.logLevel<=r.LogLevel.DEBUG){var o=n.map(y);f.debug.apply(f,(0,e.__spreadArrays)([\"Firestore (8.0.0): \"+t],o))}}function d(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(f.logLevel<=r.LogLevel.ERROR){var o=n.map(y);f.error.apply(f,(0,e.__spreadArrays)([\"Firestore (8.0.0): \"+t],o))}}function v(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(f.logLevel<=r.LogLevel.WARN){var o=n.map(y);f.warn.apply(f,(0,e.__spreadArrays)([\"Firestore (8.0.0): \"+t],o))}}function y(t){if(\"string\"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function g(t){void 0===t&&(t=\"Unexpected state\");var e=\"FIRESTORE (8.0.0) INTERNAL ASSERTION FAILED: \"+t;throw d(e),new Error(e)}function m(t,e){t||g()}function w(t,e){return t}function _(t){var e=\"undefined\"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&\"function\"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var b=function(){function t(){}return t.t=function(){for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",e=Math.floor(256/t.length)*t.length,n=\"\";n.length<20;)for(var r=_(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function I(t,e){return t<e?-1:t>e?1:0}function E(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function T(t){return t+\"\\0\"}var N=function(){function t(t){this.i=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e=\"\",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.i,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},t.prototype.o=function(){return 2*this.i.length},t.prototype.h=function(t){return I(this.i,t.i)},t.prototype.isEqual=function(t){return this.i===t.i},t}();N.u=new N(\"\");var A=function(){function t(t){this.l=t}return t.fromBase64String=function(e){try{return new t(N.fromBase64String(e))}catch(e){throw new h(c.INVALID_ARGUMENT,\"Failed to construct Bytes from Base64 string: \"+e)}},t.fromUint8Array=function(e){return new t(N.fromUint8Array(e))},t.prototype.toBase64=function(){return this.l.toBase64()},t.prototype.toUint8Array=function(){return this.l.toUint8Array()},t.prototype.toString=function(){return\"Bytes(base64: \"+this.toBase64()+\")\"},t.prototype.isEqual=function(t){return this.l.isEqual(t.l)},t}();function D(){if(\"undefined\"==typeof Uint8Array)throw new h(c.UNIMPLEMENTED,\"Uint8Arrays are not available in this environment.\")}function S(){if(\"undefined\"==typeof atob)throw new h(c.UNIMPLEMENTED,\"Blobs are unavailable in Firestore in this environment.\")}var x=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.fromBase64String=function(t){S();try{return new n(N.fromBase64String(t))}catch(t){throw new h(c.INVALID_ARGUMENT,\"Failed to construct Blob from Base64 string: \"+t)}},n.fromUint8Array=function(t){return D(),new n(N.fromUint8Array(t))},n.prototype.toBase64=function(){return S(),t.prototype.toBase64.call(this)},n.prototype.toUint8Array=function(){return D(),t.prototype.toUint8Array.call(this)},n.prototype.toString=function(){return\"Blob(base64: \"+this.toBase64()+\")\"},n}(A),k=function(t,e,n,r,i,o){this._=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.T=o},P=function(){function t(t,e){this.projectId=t,this.database=e||\"(default)\"}return Object.defineProperty(t.prototype,\"I\",{get:function(){return\"(default)\"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.h=function(t){return I(this.projectId,t.projectId)||I(this.database,t.database)},t}();function L(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function O(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function V(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var C=function(){function t(t,e){this.m=t,this.A=e,this.R={}}return t.prototype.get=function(t){var e=this.m(t),n=this.R[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.A(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.m(t),r=this.R[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.A(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.R[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.m(t),n=this.R[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.A(n[r][0],t))return 1===n.length?delete this.R[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){O(this.R,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}})},t.prototype.P=function(){return V(this.R)},t}(),R=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new h(c.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(e>=1e9)throw new h(c.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(t<-62135596800)throw new h(c.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t);if(t>=253402300800)throw new h(c.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.g=function(t){return this.seconds===t.seconds?I(this.nanoseconds,t.nanoseconds):I(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return\"Timestamp(seconds=\"+this.seconds+\", nanoseconds=\"+this.nanoseconds+\")\"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,\"0\")+\".\"+String(this.nanoseconds).padStart(9,\"0\")},t}(),U=function(){function t(t){this.timestamp=t}return t.V=function(e){return new t(e)},t.min=function(){return new t(new R(0,0))},t.prototype.h=function(t){return this.timestamp.g(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.p=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return\"SnapshotVersion(\"+this.timestamp.toString()+\")\"},t.prototype.v=function(){return this.timestamp},t}(),M=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&g(),void 0===n?n=t.length-e:n>t.length-e&&g(),this.segments=t,this.offset=e,this.S=n}return Object.defineProperty(t.prototype,\"length\",{get:function(){return this.S},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.D(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.C(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.N=function(t){return t=void 0===t?1:t,this.C(this.segments,this.offset+t,this.length-t)},t.prototype.F=function(){return this.C(this.segments,this.offset,this.length-1)},t.prototype.k=function(){return this.segments[this.offset]},t.prototype.O=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.P=function(){return 0===this.length},t.prototype.M=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.$=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.L=function(){return this.segments.slice(this.offset,this.limit())},t.D=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.C=function(t,e,r){return new n(t,e,r)},n.prototype.B=function(){return this.L().join(\"/\")},n.prototype.toString=function(){return this.B()},n.q=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf(\"//\")>=0)throw new h(c.INVALID_ARGUMENT,\"Invalid segment (\"+s+\"). Paths must not contain // in them.\");r.push.apply(r,s.split(\"/\").filter(function(t){return t.length>0}))}return new n(r)},n.U=function(){return new n([])},n}(M),F=/^[_a-zA-Z][_a-zA-Z0-9]*$/,j=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.C=function(t,e,r){return new n(t,e,r)},n.K=function(t){return F.test(t)},n.prototype.B=function(){return this.L().map(function(t){return t=t.replace(\"\\\\\",\"\\\\\\\\\").replace(\"`\",\"\\\\`\"),n.K(t)||(t=\"`\"+t+\"`\"),t}).join(\".\")},n.prototype.toString=function(){return this.B()},n.prototype.W=function(){return 1===this.length&&\"__name__\"===this.get(0)},n.j=function(){return new n([\"__name__\"])},n.G=function(t){for(var e=[],r=\"\",i=0,o=function(){if(0===r.length)throw new h(c.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\");e.push(r),r=\"\"},s=!1;i<t.length;){var u=t[i];if(\"\\\\\"===u){if(i+1===t.length)throw new h(c.INVALID_ARGUMENT,\"Path has trailing escape character: \"+t);var a=t[i+1];if(\"\\\\\"!==a&&\".\"!==a&&\"`\"!==a)throw new h(c.INVALID_ARGUMENT,\"Path has invalid escape sequence: \"+t);r+=a,i+=2}else\"`\"===u?(s=!s,i++):\".\"!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new h(c.INVALID_ARGUMENT,\"Unterminated ` in path: \"+t);return new n(e)},n.U=function(){return new n([])},n}(M),G=function(){function t(t){this.path=t}return t.H=function(e){return new t(q.q(e))},t.J=function(e){return new t(q.q(e).N(5))},t.prototype.Y=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===q.D(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.D=function(t,e){return q.D(t.path,e.path)},t.X=function(t){return t.length%2==0},t.Z=function(e){return new t(new q(e.slice()))},t}();function B(t){return null==t}function z(t){return 0===t&&1/t==-1/0}function K(t){return\"number\"==typeof t&&Number.isInteger(t)&&!z(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var W=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.tt=null};function Q(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new W(t,e,n,r,i,o,s)}function H(t){var e=w(t);if(null===e.tt){var n=e.path.B();null!==e.collectionGroup&&(n+=\"|cg:\"+e.collectionGroup),n+=\"|f:\",n+=e.filters.map(function(t){return function(t){return t.field.B()+t.op.toString()+qt(t.value)}(t)}).join(\",\"),n+=\"|ob:\",n+=e.orderBy.map(function(t){return(e=t).field.B()+e.dir;var e}).join(\",\"),B(e.limit)||(n+=\"|l:\",n+=e.limit),e.startAt&&(n+=\"|lb:\",n+=zn(e.startAt)),e.endAt&&(n+=\"|ub:\",n+=zn(e.endAt)),e.tt=n}return e.tt}function Y(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Yn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Ct(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Wn(t.startAt,e.startAt)&&Wn(t.endAt,e.endAt)}function X(t){return G.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}var J,$,Z=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=U.min()),void 0===o&&(o=U.min()),void 0===s&&(s=N.u),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.st=function(e){return new t(this.target,this.targetId,this.et,e,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.it=function(e,n){return new t(this.target,this.targetId,this.et,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.rt=function(e){return new t(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,e,this.resumeToken)},t}(),tt=function(t){this.count=t};function et(t){switch(t){case c.OK:return g();case c.CANCELLED:case c.UNKNOWN:case c.DEADLINE_EXCEEDED:case c.RESOURCE_EXHAUSTED:case c.INTERNAL:case c.UNAVAILABLE:case c.UNAUTHENTICATED:return!1;case c.INVALID_ARGUMENT:case c.NOT_FOUND:case c.ALREADY_EXISTS:case c.PERMISSION_DENIED:case c.FAILED_PRECONDITION:case c.ABORTED:case c.OUT_OF_RANGE:case c.UNIMPLEMENTED:case c.DATA_LOSS:return!0;default:return g()}}function nt(t){if(void 0===t)return d(\"GRPC error has no .code\"),c.UNKNOWN;switch(t){case J.OK:return c.OK;case J.CANCELLED:return c.CANCELLED;case J.UNKNOWN:return c.UNKNOWN;case J.DEADLINE_EXCEEDED:return c.DEADLINE_EXCEEDED;case J.RESOURCE_EXHAUSTED:return c.RESOURCE_EXHAUSTED;case J.INTERNAL:return c.INTERNAL;case J.UNAVAILABLE:return c.UNAVAILABLE;case J.UNAUTHENTICATED:return c.UNAUTHENTICATED;case J.INVALID_ARGUMENT:return c.INVALID_ARGUMENT;case J.NOT_FOUND:return c.NOT_FOUND;case J.ALREADY_EXISTS:return c.ALREADY_EXISTS;case J.PERMISSION_DENIED:return c.PERMISSION_DENIED;case J.FAILED_PRECONDITION:return c.FAILED_PRECONDITION;case J.ABORTED:return c.ABORTED;case J.OUT_OF_RANGE:return c.OUT_OF_RANGE;case J.UNIMPLEMENTED:return c.UNIMPLEMENTED;case J.DATA_LOSS:return c.DATA_LOSS;default:return g()}}($=J||(J={}))[$.OK=0]=\"OK\",$[$.CANCELLED=1]=\"CANCELLED\",$[$.UNKNOWN=2]=\"UNKNOWN\",$[$.INVALID_ARGUMENT=3]=\"INVALID_ARGUMENT\",$[$.DEADLINE_EXCEEDED=4]=\"DEADLINE_EXCEEDED\",$[$.NOT_FOUND=5]=\"NOT_FOUND\",$[$.ALREADY_EXISTS=6]=\"ALREADY_EXISTS\",$[$.PERMISSION_DENIED=7]=\"PERMISSION_DENIED\",$[$.UNAUTHENTICATED=16]=\"UNAUTHENTICATED\",$[$.RESOURCE_EXHAUSTED=8]=\"RESOURCE_EXHAUSTED\",$[$.FAILED_PRECONDITION=9]=\"FAILED_PRECONDITION\",$[$.ABORTED=10]=\"ABORTED\",$[$.OUT_OF_RANGE=11]=\"OUT_OF_RANGE\",$[$.UNIMPLEMENTED=12]=\"UNIMPLEMENTED\",$[$.INTERNAL=13]=\"INTERNAL\",$[$.UNAVAILABLE=14]=\"UNAVAILABLE\",$[$.DATA_LOSS=15]=\"DATA_LOSS\";var rt=function(){function t(t,e){this.D=t,this.root=e||ot.EMPTY}return t.prototype.ot=function(e,n){return new t(this.D,this.root.ot(e,n,this.D).copy(null,null,ot.at,null,null))},t.prototype.remove=function(e){return new t(this.D,this.root.remove(e,this.D).copy(null,null,ot.at,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.P();){var n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.P();){var r=this.D(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.P=function(){return this.root.P()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.ht=function(){return this.root.ht()},t.prototype.ct=function(){return this.root.ct()},t.prototype.ut=function(t){return this.root.ut(t)},t.prototype.forEach=function(t){this.ut(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.ut(function(e,n){return t.push(e+\":\"+n),!1}),\"{\"+t.join(\", \")+\"}\"},t.prototype.lt=function(t){return this.root.lt(t)},t.prototype._t=function(){return new it(this.root,null,this.D,!1)},t.prototype.ft=function(t){return new it(this.root,t,this.D,!1)},t.prototype.dt=function(){return new it(this.root,null,this.D,!0)},t.prototype.wt=function(t){return new it(this.root,t,this.D,!0)},t}(),it=function(){function t(t,e,n,r){this.Et=r,this.Tt=[];for(var i=1;!t.P();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.Et?t.right:t.left}}return t.prototype.It=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.P();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.P();)this.Tt.push(t),t=t.left;return e},t.prototype.At=function(){return this.Tt.length>0},t.prototype.Rt=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},t}(),ot=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.P=function(){return!1},t.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},t.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},t.prototype.min=function(){return this.left.P()?this:this.left.min()},t.prototype.ht=function(){return this.min().key},t.prototype.ct=function(){return this.right.P()?this.key:this.right.ct()},t.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).Pt()},t.prototype.gt=function(){if(this.left.P())return t.EMPTY;var e=this;return e.left.Vt()||e.left.left.Vt()||(e=e.yt()),(e=e.copy(null,null,null,e.left.gt(),null)).Pt()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.P()||i.left.Vt()||i.left.left.Vt()||(i=i.yt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Vt()&&(i=i.bt()),i.right.P()||i.right.Vt()||i.right.left.Vt()||(i=i.vt()),0===n(e,i.key)){if(i.right.P())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.gt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Pt()},t.prototype.Vt=function(){return this.color},t.prototype.Pt=function(){var t=this;return t.right.Vt()&&!t.left.Vt()&&(t=t.St()),t.left.Vt()&&t.left.left.Vt()&&(t=t.bt()),t.left.Vt()&&t.right.Vt()&&(t=t.Dt()),t},t.prototype.yt=function(){var t=this.Dt();return t.right.left.Vt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},t.prototype.vt=function(){var t=this.Dt();return t.left.left.Vt()&&(t=(t=t.bt()).Dt()),t},t.prototype.St=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.bt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},t.prototype.Nt=function(){if(this.Vt()&&this.left.Vt())throw g();if(this.right.Vt())throw g();var t=this.left.Nt();if(t!==this.right.Nt())throw g();return t+(this.Vt()?0:1)},t}();ot.EMPTY=null,ot.RED=!0,ot.at=!1,ot.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,\"key\",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"value\",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"color\",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"left\",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"right\",{get:function(){throw g()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.ot=function(t,e,n){return new ot(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.P=function(){return!0},t.prototype.ut=function(t){return!1},t.prototype.lt=function(t){return!1},t.prototype.ht=function(){return null},t.prototype.ct=function(){return null},t.prototype.Vt=function(){return!1},t.prototype.Ct=function(){return!0},t.prototype.Nt=function(){return 0},t}());var st=function(){function t(t){this.D=t,this.data=new rt(this.D)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.ht()},t.prototype.last=function(){return this.data.ct()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ut(function(e,n){return t(e),!1})},t.prototype.xt=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(this.D(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ft=function(t,e){var n;for(n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},t.prototype.kt=function(t){var e=this.data.ft(t);return e.At()?e.It().key:null},t.prototype._t=function(){return new ut(this.data._t())},t.prototype.ft=function(t){return new ut(this.data.ft(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.P=function(){return this.data.P()},t.prototype.Ot=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data._t(),r=e.data._t();n.At();){var i=n.It().key,o=r.It().key;if(0!==this.D(i,o))return!1}return!0},t.prototype.L=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),\"SortedSet(\"+t.toString()+\")\"},t.prototype.copy=function(e){var n=new t(this.D);return n.data=e,n},t}(),ut=function(){function t(t){this.Mt=t}return t.prototype.It=function(){return this.Mt.It().key},t.prototype.At=function(){return this.Mt.At()},t}(),at=new rt(G.D);function ct(){return at}function ht(){return ct()}var ft=new rt(G.D);function lt(){return ft}var pt=new rt(G.D),dt=new st(G.D);function vt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=dt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var yt=new st(I);function gt(){return yt}var mt=function(){function t(t){this.D=t?function(e,n){return t(e,n)||G.D(e.key,n.key)}:function(t,e){return G.D(t.key,e.key)},this.$t=lt(),this.Lt=new rt(this.D)}return t.Bt=function(e){return new t(e.D)},t.prototype.has=function(t){return null!=this.$t.get(t)},t.prototype.get=function(t){return this.$t.get(t)},t.prototype.first=function(){return this.Lt.ht()},t.prototype.last=function(){return this.Lt.ct()},t.prototype.P=function(){return this.Lt.P()},t.prototype.indexOf=function(t){var e=this.$t.get(t);return e?this.Lt.indexOf(e):-1},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Lt.ut(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.ot(t.key,t),e.Lt.ot(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Lt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Lt._t(),r=e.Lt._t();n.At();){var i=n.It().key,o=r.It().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?\"DocumentSet ()\":\"DocumentSet (\\n  \"+t.join(\"  \\n\")+\"\\n)\"},t.prototype.copy=function(e,n){var r=new t;return r.D=this.D,r.$t=e,r.Lt=n,r},t}(),wt=function(){function t(){this.qt=new rt(G.D)}return t.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);n?0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):g():this.qt=this.qt.ot(e,t)},t.prototype.Ut=function(){var t=[];return this.qt.ut(function(e,n){t.push(n)}),t},t}(),_t=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Kt=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}return t.Gt=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,mt.Bt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,\"hasPendingWrites\",{get:function(){return!this.Qt.P()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&xn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Kt.isEqual(t.Kt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),bt=function(){function t(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Jt=r,this.Yt=i}return t.Xt=function(e,n){var r=new Map;return r.set(e,It.Zt(e,n)),new t(U.min(),r,gt(),ct(),vt())},t}(),It=function(){function t(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}return t.Zt=function(e,n){return new t(N.u,n,vt(),vt(),vt())},t}(),Et=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},Tt=function(t,e){this.targetId=t,this.oe=e},Nt=function(t,e,n,r){void 0===n&&(n=N.u),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},At=function(){function t(){this.ae=0,this.he=xt(),this.ce=N.u,this.ue=!1,this.le=!0}return Object.defineProperty(t.prototype,\"te\",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"resumeToken\",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"_e\",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"fe\",{get:function(){return this.le},enumerable:!1,configurable:!0}),t.prototype.de=function(t){t.o()>0&&(this.le=!0,this.ce=t)},t.prototype.we=function(){var t=vt(),e=vt(),n=vt();return this.he.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:g()}}),new It(this.ce,this.ue,t,e,n)},t.prototype.Ee=function(){this.le=!1,this.he=xt()},t.prototype.Te=function(t,e){this.le=!0,this.he=this.he.ot(t,e)},t.prototype.Ie=function(t){this.le=!0,this.he=this.he.remove(t)},t.prototype.me=function(){this.ae+=1},t.prototype.Ae=function(){this.ae-=1},t.prototype.Re=function(){this.le=!0,this.ue=!0},t}(),Dt=function(){function t(t){this.Pe=t,this.ge=new Map,this.Ve=ct(),this.ye=St(),this.pe=new st(I)}return t.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof pn?this.ve(r,t.re):t.re instanceof dn&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Se(s,t.key,t.re)}},t.prototype.De=function(t){var e=this;this.Ce(t,function(n){var r=e.Ne(n);switch(t.state){case 0:e.xe(n)&&r.de(t.resumeToken);break;case 1:r.Ae(),r._e||r.Ee(),r.de(t.resumeToken);break;case 2:r.Ae(),r._e||e.removeTarget(n);break;case 3:e.xe(n)&&(r.Re(),r.de(t.resumeToken));break;case 4:e.xe(n)&&(e.Fe(n),r.de(t.resumeToken));break;default:g()}})},t.prototype.Ce=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.ge.forEach(function(t,r){n.xe(r)&&e(r)})},t.prototype.ke=function(t){var e=t.targetId,n=t.oe.count,r=this.Oe(e);if(r){var i=r.target;if(X(i))if(0===n){var o=new G(i.path);this.Se(e,o,new dn(o,U.min()))}else m(1===n);else this.Me(e)!==n&&(this.Fe(e),this.pe=this.pe.add(e))}},t.prototype.$e=function(t){var e=this,n=new Map;this.ge.forEach(function(r,i){var o=e.Oe(i);if(o){if(r.te&&X(o.target)){var s=new G(o.target.path);null!==e.Ve.get(s)||e.Le(i,s)||e.Se(i,s,new dn(s,t))}r.fe&&(n.set(i,r.we()),r.Ee())}});var r=vt();this.ye.forEach(function(t,n){var i=!0;n.Ft(function(t){var n=e.Oe(t);return!n||2===n.et||(i=!1,!1)}),i&&(r=r.add(t))});var i=new bt(t,n,this.pe,this.Ve,r);return this.Ve=ct(),this.ye=St(),this.pe=new st(I),i},t.prototype.ve=function(t,e){if(this.xe(t)){var n=this.Le(t,e.key)?2:0;this.Ne(t).Te(e.key,n),this.Ve=this.Ve.ot(e.key,e),this.ye=this.ye.ot(e.key,this.Be(e.key).add(t))}},t.prototype.Se=function(t,e,n){if(this.xe(t)){var r=this.Ne(t);this.Le(t,e)?r.Te(e,1):r.Ie(e),this.ye=this.ye.ot(e,this.Be(e).delete(t)),n&&(this.Ve=this.Ve.ot(e,n))}},t.prototype.removeTarget=function(t){this.ge.delete(t)},t.prototype.Me=function(t){var e=this.Ne(t).we();return this.Pe.qe(t).size+e.ee.size-e.se.size},t.prototype.me=function(t){this.Ne(t).me()},t.prototype.Ne=function(t){var e=this.ge.get(t);return e||(e=new At,this.ge.set(t,e)),e},t.prototype.Be=function(t){var e=this.ye.get(t);return e||(e=new st(I),this.ye=this.ye.ot(t,e)),e},t.prototype.xe=function(t){var e=null!==this.Oe(t);return e||p(\"WatchChangeAggregator\",\"Detected inactive target\",t),e},t.prototype.Oe=function(t){var e=this.ge.get(t);return e&&e._e?null:this.Pe.Ue(t)},t.prototype.Fe=function(t){var e=this;this.ge.set(t,new At),this.Pe.qe(t).forEach(function(n){e.Se(t,n,null)})},t.prototype.Le=function(t,e){return this.Pe.qe(t).has(e)},t}();function St(){return new rt(G.D)}function xt(){return new rt(G.D)}function kt(t){var e,n;return\"server_timestamp\"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Pt(t){var e=t.mapValue.fields.__previous_value__;return kt(e)?Pt(e):e}function Lt(t){var e=jt(t.mapValue.fields.__local_write_time__.timestampValue);return new R(e.seconds,e.nanos)}var Ot=new RegExp(/^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.(\\d+))?Z$/);function Vt(t){return\"nullValue\"in t?0:\"booleanValue\"in t?1:\"integerValue\"in t||\"doubleValue\"in t?2:\"timestampValue\"in t?3:\"stringValue\"in t?5:\"bytesValue\"in t?6:\"referenceValue\"in t?7:\"geoPointValue\"in t?8:\"arrayValue\"in t?9:\"mapValue\"in t?kt(t)?4:10:g()}function Ct(t,e){var n=Vt(t);if(n!==Vt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Lt(t).isEqual(Lt(e));case 3:return function(t,e){if(\"string\"==typeof t.timestampValue&&\"string\"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=jt(t.timestampValue),r=jt(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Bt(t.bytesValue).isEqual(Bt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Gt(t.geoPointValue.latitude)===Gt(e.geoPointValue.latitude)&&Gt(t.geoPointValue.longitude)===Gt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if(\"integerValue\"in t&&\"integerValue\"in e)return Gt(t.integerValue)===Gt(e.integerValue);if(\"doubleValue\"in t&&\"doubleValue\"in e){var n=Gt(t.doubleValue),r=Gt(e.doubleValue);return n===r?z(n)===z(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return E(t.arrayValue.values||[],e.arrayValue.values||[],Ct);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(L(n)!==L(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ct(n[i],r[i])))return!1;return!0}(t,e);default:return g()}}function Rt(t,e){return void 0!==(t.values||[]).find(function(t){return Ct(t,e)})}function Ut(t,e){var n=Vt(t),r=Vt(e);if(n!==r)return I(n,r);switch(n){case 0:return 0;case 1:return I(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Gt(t.integerValue||t.doubleValue),r=Gt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Mt(t.timestampValue,e.timestampValue);case 4:return Mt(Lt(t),Lt(e));case 5:return I(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Bt(t),r=Bt(e);return n.h(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split(\"/\"),r=e.split(\"/\"),i=0;i<n.length&&i<r.length;i++){var o=I(n[i],r[i]);if(0!==o)return o}return I(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=I(Gt(t.latitude),Gt(e.latitude));return 0!==n?n:I(Gt(t.longitude),Gt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ut(n[i],r[i]);if(o)return o}return I(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=I(r[s],o[s]);if(0!==u)return u;var a=Ut(n[r[s]],i[o[s]]);if(0!==a)return a}return I(r.length,o.length)}(t.mapValue,e.mapValue);default:throw g()}}function Mt(t,e){if(\"string\"==typeof t&&\"string\"==typeof e&&t.length===e.length)return I(t,e);var n=jt(t),r=jt(e),i=I(n.seconds,r.seconds);return 0!==i?i:I(n.nanos,r.nanos)}function qt(t){return Ft(t)}function Ft(t){return\"nullValue\"in t?\"null\":\"booleanValue\"in t?\"\"+t.booleanValue:\"integerValue\"in t?\"\"+t.integerValue:\"doubleValue\"in t?\"\"+t.doubleValue:\"timestampValue\"in t?function(t){var e=jt(t);return\"time(\"+e.seconds+\",\"+e.nanos+\")\"}(t.timestampValue):\"stringValue\"in t?t.stringValue:\"bytesValue\"in t?Bt(t.bytesValue).toBase64():\"referenceValue\"in t?(n=t.referenceValue,G.J(n).toString()):\"geoPointValue\"in t?\"geo(\"+(e=t.geoPointValue).latitude+\",\"+e.longitude+\")\":\"arrayValue\"in t?function(t){for(var e=\"[\",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=\",\",e+=Ft(i[r]);return e+\"]\"}(t.arrayValue):\"mapValue\"in t?function(t){for(var e=\"{\",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=\",\",e+=o+\":\"+Ft(t.fields[o])}return e+\"}\"}(t.mapValue):g();var e,n}function jt(t){if(m(!!t),\"string\"==typeof t){var e=0,n=Ot.exec(t);if(m(!!n),n[1]){var r=n[1];r=(r+\"000000000\").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Gt(t.seconds),nanos:Gt(t.nanos)}}function Gt(t){return\"number\"==typeof t?t:\"string\"==typeof t?Number(t):0}function Bt(t){return\"string\"==typeof t?N.fromBase64String(t):N.fromUint8Array(t)}function zt(t,e){return{referenceValue:\"projects/\"+t.projectId+\"/databases/\"+t.database+\"/documents/\"+e.path.B()}}function Kt(t){return!!t&&\"integerValue\"in t}function Wt(t){return!!t&&\"arrayValue\"in t}function Qt(t){return!!t&&\"nullValue\"in t}function Ht(t){return!!t&&\"doubleValue\"in t&&isNaN(Number(t.doubleValue))}function Yt(t){return!!t&&\"mapValue\"in t}var Xt={asc:\"ASCENDING\",desc:\"DESCENDING\"},Jt={\"<\":\"LESS_THAN\",\"<=\":\"LESS_THAN_OR_EQUAL\",\">\":\"GREATER_THAN\",\">=\":\"GREATER_THAN_OR_EQUAL\",\"==\":\"EQUAL\",\"!=\":\"NOT_EQUAL\",\"array-contains\":\"ARRAY_CONTAINS\",in:\"IN\",\"not-in\":\"NOT_IN\",\"array-contains-any\":\"ARRAY_CONTAINS_ANY\"},$t=function(t,e){this._=t,this.Ke=e};function Zt(t){return{integerValue:\"\"+t}}function te(t,e){if(t.Ke){if(isNaN(e))return{doubleValue:\"NaN\"};if(e===1/0)return{doubleValue:\"Infinity\"};if(e===-1/0)return{doubleValue:\"-Infinity\"}}return{doubleValue:z(e)?\"-0\":e}}function ee(t,e){return K(e)?Zt(e):te(t,e)}function ne(t,e){return t.Ke?new Date(1e3*e.seconds).toISOString().replace(/\\.\\d*/,\"\").replace(\"Z\",\"\")+\".\"+(\"000000000\"+e.nanoseconds).slice(-9)+\"Z\":{seconds:\"\"+e.seconds,nanos:e.nanoseconds}}function re(t,e){return t.Ke?e.toBase64():e.toUint8Array()}function ie(t,e){return ne(t,e.v())}function oe(t){return m(!!t),U.V(function(t){var e=jt(t);return new R(e.seconds,e.nanos)}(t))}function se(t,e){return function(t){return new q([\"projects\",t.projectId,\"databases\",t.database])}(t).child(\"documents\").child(e).B()}function ue(t){var e=q.q(t);return m(ke(e)),e}function ae(t,e){return se(t._,e.path)}function ce(t,e){var n=ue(e);return m(n.get(1)===t._.projectId),m(!n.get(3)&&!t._.database||n.get(3)===t._.database),new G(pe(n))}function he(t,e){return se(t._,e)}function fe(t){var e=ue(t);return 4===e.length?q.U():pe(e)}function le(t){return new q([\"projects\",t._.projectId,\"databases\",t._.database]).B()}function pe(t){return m(t.length>4&&\"documents\"===t.get(4)),t.N(5)}function de(t,e,n){return{name:ae(t,e),fields:n.proto.mapValue.fields}}function ve(t,e){var n;if(e instanceof tn)n={update:de(t,e.key,e.value)};else if(e instanceof un)n={delete:ae(t,e.key)};else if(e instanceof en)n={update:de(t,e.key,e.data),updateMask:xe(e.Qe)};else if(e instanceof rn)n={transform:{document:ae(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Ce)return{fieldPath:e.field.B(),setToServerValue:\"REQUEST_TIME\"};if(n instanceof Re)return{fieldPath:e.field.B(),appendMissingElements:{values:n.elements}};if(n instanceof Me)return{fieldPath:e.field.B(),removeAllFromArray:{values:n.elements}};if(n instanceof Fe)return{fieldPath:e.field.B(),increment:n.We};throw g()}(0,t)})}};else{if(!(e instanceof an))return g();n={verify:ae(t,e.key)}}return e.Ge.je||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ie(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:g()}(t,e.Ge)),n}function ye(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?We.updateTime(oe(t.updateTime)):void 0!==t.exists?We.exists(t.exists):We.ze()}(e.currentDocument):We.ze();if(e.update){e.update.name;var r=ce(t,e.update.name),i=new cn({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new Be(e.map(function(t){return j.G(t)}))}(e.updateMask);return new en(r,i,o,n)}return new tn(r,i,n)}if(e.delete){var s=ce(t,e.delete);return new un(s,n)}if(e.transform){var u=ce(t,e.transform.document),a=e.transform.fieldTransforms.map(function(e){return function(t,e){var n=null;if(\"setToServerValue\"in e)m(\"REQUEST_TIME\"===e.setToServerValue),n=new Ce;else if(\"appendMissingElements\"in e){var r=e.appendMissingElements.values||[];n=new Re(r)}else if(\"removeAllFromArray\"in e){var i=e.removeAllFromArray.values||[];n=new Me(i)}else\"increment\"in e?n=new Fe(t,e.increment):g();var o=j.G(e.fieldPath);return new ze(o,n)}(t,e)});return m(!0===n.exists),new rn(u,a)}if(e.verify){var c=ce(t,e.verify);return new an(c,n)}return g()}function ge(t,e){return{documents:[he(t,e.path)]}}function me(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=he(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=he(t,r.F()),n.structuredQuery.from=[{collectionId:r.O()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if(\"==\"===t.op){if(Ht(t.value))return{unaryFilter:{field:Ne(t.field),op:\"IS_NAN\"}};if(Qt(t.value))return{unaryFilter:{field:Ne(t.field),op:\"IS_NULL\"}}}else if(\"!=\"===t.op){if(Ht(t.value))return{unaryFilter:{field:Ne(t.field),op:\"IS_NOT_NAN\"}};if(Qt(t.value))return{unaryFilter:{field:Ne(t.field),op:\"IS_NOT_NULL\"}}}return{fieldFilter:{field:Ne(t.field),op:Te(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:\"AND\",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ne(t.field),direction:Ee(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Ke||B(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=be(e.startAt)),e.endAt&&(n.structuredQuery.endAt=be(e.endAt)),n}function we(t){var e=fe(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){m(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=_e(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(t){return function(t){return new Qn(Ae(t.field),function(t){switch(t){case\"ASCENDING\":return\"asc\";case\"DESCENDING\":return\"desc\";default:return}}(t.direction))}(t)}));var c=null;n.limit&&(c=function(t){var e;return B(e=\"object\"==a(t)?t.value:t)?null:e}(n.limit));var h=null;n.startAt&&(h=Ie(n.startAt));var f=null;return n.endAt&&(f=Ie(n.endAt)),Nn(gn(e,i,u,s,c,\"F\",h,f))}function _e(t){return t?void 0!==t.unaryFilter?[Se(t)]:void 0!==t.fieldFilter?[De(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return _e(t)}).reduce(function(t,e){return t.concat(e)}):g():[]}function be(t){return{before:t.before,values:t.position}}function Ie(t){var e=!!t.before,n=t.values||[];return new Bn(n,e)}function Ee(t){return Xt[t]}function Te(t){return Jt[t]}function Ne(t){return{fieldPath:t.B()}}function Ae(t){return j.G(t.fieldPath)}function De(t){return Vn.create(Ae(t.fieldFilter.field),function(t){switch(t){case\"EQUAL\":return\"==\";case\"NOT_EQUAL\":return\"!=\";case\"GREATER_THAN\":return\">\";case\"GREATER_THAN_OR_EQUAL\":return\">=\";case\"LESS_THAN\":return\"<\";case\"LESS_THAN_OR_EQUAL\":return\"<=\";case\"ARRAY_CONTAINS\":return\"array-contains\";case\"IN\":return\"in\";case\"NOT_IN\":return\"not-in\";case\"ARRAY_CONTAINS_ANY\":return\"array-contains-any\";case\"OPERATOR_UNSPECIFIED\":default:return g()}}(t.fieldFilter.op),t.fieldFilter.value)}function Se(t){switch(t.unaryFilter.op){case\"IS_NAN\":var e=Ae(t.unaryFilter.field);return Vn.create(e,\"==\",{doubleValue:NaN});case\"IS_NULL\":var n=Ae(t.unaryFilter.field);return Vn.create(n,\"==\",{nullValue:\"NULL_VALUE\"});case\"IS_NOT_NAN\":var r=Ae(t.unaryFilter.field);return Vn.create(r,\"!=\",{doubleValue:NaN});case\"IS_NOT_NULL\":var i=Ae(t.unaryFilter.field);return Vn.create(i,\"!=\",{nullValue:\"NULL_VALUE\"});case\"OPERATOR_UNSPECIFIED\":default:return g()}}function xe(t){var e=[];return t.fields.forEach(function(t){return e.push(t.B())}),{fieldPaths:e}}function ke(t){return t.length>=4&&\"projects\"===t.get(0)&&\"databases\"===t.get(2)}var Pe=function(){this.He=void 0};function Le(t,e,n){return t instanceof Ce?function(t,e){var n={fields:{__type__:{stringValue:\"server_timestamp\"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Re?Ue(t,e):t instanceof Me?qe(t,e):function(t,e){var n=Ve(t,e),r=je(n)+je(t.We);return Kt(n)&&Kt(t.We)?Zt(r):te(t.serializer,r)}(t,e)}function Oe(t,e,n){return t instanceof Re?Ue(t,e):t instanceof Me?qe(t,e):n}function Ve(t,e){return t instanceof Fe?Kt(n=e)||n&&\"doubleValue\"in n?e:{integerValue:0}:null;var n}var Ce=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n}(Pe),Re=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,e.__extends)(n,t),n}(Pe);function Ue(t,e){for(var n=Ge(e),r=function(t){n.some(function(e){return Ct(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Me=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,e.__extends)(n,t),n}(Pe);function qe(t,e){for(var n=Ge(e),r=function(t){n=n.filter(function(e){return!Ct(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Fe=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.We=n,r}return(0,e.__extends)(n,t),n}(Pe);function je(t){return Gt(t.integerValue||t.doubleValue)}function Ge(t){return Wt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Be=function(){function t(t){this.fields=t,t.sort(j.D)}return t.prototype.Je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].M(t))return!0;return!1},t.prototype.isEqual=function(t){return E(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),ze=function(t,e){this.field=t,this.transform=e},Ke=function(t,e){this.version=t,this.transformResults=e},We=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.ze=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,\"je\",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Qe(t,e){return void 0!==t.updateTime?e instanceof pn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof pn}var He=function(){};function Ye(t,e,n){return t instanceof tn?function(t,e,n){return new pn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof en?function(t,e,n){if(!Qe(t.Ge,e))return new vn(t.key,n.version);var r=nn(t,e);return new pn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof rn?function(t,e,n){if(m(null!=n.transformResults),!Qe(t.Ge,e))return new vn(t.key,n.version);var r=on(t,e),i=function(t,e,n){var r=[];m(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof pn&&(u=e.field(o.field)),r.push(Oe(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=sn(t,r.data(),i);return new pn(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new dn(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Xe(t,e,n,r){return t instanceof tn?function(t,e){if(!Qe(t.Ge,e))return e;var n=Ze(e);return new pn(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof en?function(t,e){if(!Qe(t.Ge,e))return e;var n=Ze(e),r=nn(t,e);return new pn(t.key,n,r,{Ye:!0})}(t,e):t instanceof rn?function(t,e,n,r){if(!Qe(t.Ge,e))return e;var i=on(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof pn&&(c=n.field(u.field)),null===c&&r instanceof pn&&(c=r.field(u.field)),i.push(Le(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=sn(t,i.data(),o);return new pn(t.key,i.version,s,{Ye:!0})}(t,e,r,n):function(t,e){return Qe(t.Ge,e)?new dn(t.key,U.min()):e}(t,e)}function Je(t,e){return t instanceof rn?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof pn?e.field(o.field):void 0,u=Ve(o.transform,s||null);null!=u&&(n=null==n?(new hn).set(o.field,u):n.set(o.field,u))}return n?n.Xe():null}(t,e):null}function $e(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||E(t.fieldTransforms,t.fieldTransforms,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Re&&e instanceof Re||t instanceof Me&&e instanceof Me?E(t.elements,e.elements,Ct):t instanceof Fe&&e instanceof Fe?Ct(t.We,e.We):t instanceof Ce&&e instanceof Ce}(t.transform,e.transform)}(t,e)}))}function Ze(t){return t instanceof pn?t.version:U.min()}var tn=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ge=r,i.type=0,i}return(0,e.__extends)(n,t),n}(He),en=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Qe=r,o.Ge=i,o.type=1,o}return(0,e.__extends)(n,t),n}(He);function nn(t,e){return function(t,e){var n=new hn(e);return t.Qe.fields.forEach(function(e){if(!e.P()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}}),n.Xe()}(t,e instanceof pn?e.data():cn.empty())}var rn=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ge=We.exists(!0),r}return(0,e.__extends)(n,t),n}(He);function on(t,e){return e}function sn(t,e,n){for(var r=new hn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var un=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=3,r}return(0,e.__extends)(n,t),n}(He),an=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=4,r}return(0,e.__extends)(n,t),n}(He),cn=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.P())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Yt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},t.prototype.isEqual=function(t){return Ct(this.proto,t.proto)},t}(),hn=function(){function t(t){void 0===t&&(t=cn.empty()),this.Ze=t,this.tn=new Map}return t.prototype.set=function(t,e){return this.en(t,e),this},t.prototype.delete=function(t){return this.en(t,null),this},t.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Vt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.O(),e)},t.prototype.Xe=function(){var t=this.nn(j.U(),this.tn);return null!=t?new cn(t):this.Ze},t.prototype.nn=function(t,e){var n=this,r=!1,i=this.Ze.field(t),o=Yt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach(function(e,i){if(e instanceof Map){var s=n.nn(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)}),r?{mapValue:{fields:o}}:null},t}();function fn(t){var e=[];return O(t.fields||{},function(t,n){var r=new j([t]);if(Yt(n)){var i=fn(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)}),new Be(e)}var ln=function(t,e){this.key=t,this.version=e},pn=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).sn=r,o.Ye=!!i.Ye,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return(0,e.__extends)(n,t),n.prototype.field=function(t){return this.sn.field(t)},n.prototype.data=function(){return this.sn},n.prototype.rn=function(){return this.sn.proto},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},n.prototype.toString=function(){return\"Document(\"+this.key+\", \"+this.version+\", \"+this.sn.toString()+\", {hasLocalMutations: \"+this.Ye+\"}), {hasCommittedMutations: \"+this.hasCommittedMutations+\"})\"},Object.defineProperty(n.prototype,\"hasPendingWrites\",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),n}(ln),dn=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return(0,e.__extends)(n,t),n.prototype.toString=function(){return\"NoDocument(\"+this.key+\", \"+this.version+\")\"},Object.defineProperty(n.prototype,\"hasPendingWrites\",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(ln),vn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.toString=function(){return\"UnknownDocument(\"+this.key+\", \"+this.version+\")\"},Object.defineProperty(n.prototype,\"hasPendingWrites\",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(ln),yn=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=\"F\"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=s,this.endAt=u,this.hn=null,this.cn=null,this.startAt,this.endAt};function gn(t,e,n,r,i,o,s,u){return new yn(t,e,n,r,i,o,s,u)}function mn(t){return new yn(t)}function wn(t){return!B(t.limit)&&\"F\"===t.an}function _n(t){return!B(t.limit)&&\"L\"===t.an}function bn(t){return t.on.length>0?t.on[0].field:null}function In(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function En(t){return null!==t.collectionGroup}function Tn(t){var e=w(t);if(null===e.hn){e.hn=[];var n=In(e),r=bn(e);if(null!==n&&null===r)n.W()||e.hn.push(new Qn(n)),e.hn.push(new Qn(j.j(),\"asc\"));else{for(var i=!1,o=0,s=e.on;o<s.length;o++){var u=s[o];e.hn.push(u),u.field.W()&&(i=!0)}if(!i){var a=e.on.length>0?e.on[e.on.length-1].dir:\"asc\";e.hn.push(new Qn(j.j(),a))}}}return e.hn}function Nn(t){var e=w(t);if(!e.cn)if(\"F\"===e.an)e.cn=Q(e.path,e.collectionGroup,Tn(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Tn(e);r<i.length;r++){var o=i[r],s=\"desc\"===o.dir?\"asc\":\"desc\";n.push(new Qn(o.field,s))}var u=e.endAt?new Bn(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Bn(e.startAt.position,!e.startAt.before):null;e.cn=Q(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function An(t,e,n){return new yn(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Dn(t,e){return new yn(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function Sn(t,e){return new yn(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function xn(t,e){return Y(Nn(t),Nn(e))&&t.an===e.an}function kn(t){return H(Nn(t))+\"|lt:\"+t.an}function Pn(t){return\"Query(target=\"+function(t){var e=t.path.B();return null!==t.collectionGroup&&(e+=\" collectionGroup=\"+t.collectionGroup),t.filters.length>0&&(e+=\", filters: [\"+t.filters.map(function(t){return(e=t).field.B()+\" \"+e.op+\" \"+qt(e.value);var e}).join(\", \")+\"]\"),B(t.limit)||(e+=\", limit: \"+t.limit),t.orderBy.length>0&&(e+=\", orderBy: [\"+t.orderBy.map(function(t){return(e=t).field.B()+\" (\"+e.dir+\")\";var e}).join(\", \")+\"]\"),t.startAt&&(e+=\", startAt: \"+zn(t.startAt)),t.endAt&&(e+=\", endAt: \"+zn(t.endAt)),\"Target(\"+e+\")\"}(Nn(t))+\"; limitType=\"+t.an+\")\"}function Ln(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.Y(t.collectionGroup)&&t.path.M(n):G.X(t.path)?t.path.isEqual(n):t.path.$(n)}(t,e)&&function(t,e){for(var n=0,r=t.on;n<r.length;n++){var i=r[n];if(!i.field.W()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Kn(t.startAt,Tn(t),e)||t.endAt&&Kn(t.endAt,Tn(t),e))}(t,e)}function On(t){return function(e,n){for(var r=!1,i=0,o=Tn(t);i<o.length;i++){var s=o[i],u=Hn(s,e,n);if(0!==u)return u;r=r||s.field.W()}return 0}}var Vn=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,e.__extends)(n,t),n.create=function(t,e,r){return t.W()?\"in\"===e||\"not-in\"===e?this.ln(t,e,r):new Cn(t,e,r):\"array-contains\"===e?new qn(t,r):\"in\"===e?new Fn(t,r):\"not-in\"===e?new jn(t,r):\"array-contains-any\"===e?new Gn(t,r):new n(t,e,r)},n.ln=function(t,e,n){return\"in\"===e?new Rn(t,n):new Un(t,n)},n.prototype.matches=function(t){var e=t.field(this.field);return\"!=\"===this.op?null!==e&&this._n(Ut(e,this.value)):null!==e&&Vt(this.value)===Vt(e)&&this._n(Ut(e,this.value))},n.prototype._n=function(t){switch(this.op){case\"<\":return t<0;case\"<=\":return t<=0;case\"==\":return 0===t;case\"!=\":return 0!==t;case\">\":return t>0;case\">=\":return t>=0;default:return g()}},n.prototype.un=function(){return[\"<\",\"<=\",\">\",\">=\",\"!=\",\"not-in\"].indexOf(this.op)>=0},n}(function(){}),Cn=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=G.J(r.referenceValue),i}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=G.D(t.key,this.key);return this._n(e)},n}(Vn),Rn=function(t){function n(e,n){var r=this;return(r=t.call(this,e,\"in\",n)||this).keys=Mn(\"in\",n),r}return(0,e.__extends)(n,t),n.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},n}(Vn),Un=function(t){function n(e,n){var r=this;return(r=t.call(this,e,\"not-in\",n)||this).keys=Mn(\"not-in\",n),r}return(0,e.__extends)(n,t),n.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},n}(Vn);function Mn(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return G.J(t.referenceValue)})}var qn=function(t){function n(e,n){return t.call(this,e,\"array-contains\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return Wt(e)&&Rt(e.arrayValue,this.value)},n}(Vn),Fn=function(t){function n(e,n){return t.call(this,e,\"in\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Rt(this.value.arrayValue,e)},n}(Vn),jn=function(t){function n(e,n){return t.call(this,e,\"not-in\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){if(Rt(this.value.arrayValue,{nullValue:\"NULL_VALUE\"}))return!1;var e=t.field(this.field);return null!==e&&!Rt(this.value.arrayValue,e)},n}(Vn),Gn=function(t){function n(e,n){return t.call(this,e,\"array-contains-any\",n)||this}return(0,e.__extends)(n,t),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Wt(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Rt(e.value.arrayValue,t)})},n}(Vn),Bn=function(t,e){this.position=t,this.before=e};function zn(t){return(t.before?\"b\":\"a\")+\":\"+t.position.map(function(t){return qt(t)}).join(\",\")}function Kn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.W()?G.D(G.J(s.referenceValue),n.key):Ut(s,n.field(o.field)),\"desc\"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Wn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ct(t.position[n],e.position[n]))return!1;return!0}var Qn=function(t,e){void 0===e&&(e=\"asc\"),this.field=t,this.dir=e};function Hn(t,e,n){var r=t.field.W()?G.D(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Ut(r,i):g()}(t.field,e,n);switch(t.dir){case\"asc\":return r;case\"desc\":return-1*r;default:return g()}}function Yn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Xn=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Jn=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.En=r,this.Tn=i,this.In=0,this.mn=null,this.An=Date.now(),this.reset()}return t.prototype.reset=function(){this.In=0},t.prototype.Rn=function(){this.In=this.Tn},t.prototype.Pn=function(t){var e=this;this.cancel();var n=Math.floor(this.In+this.gn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);i>0&&p(\"ExponentialBackoff\",\"Backing off for \"+i+\" ms (base delay: \"+this.In+\" ms, delay with jitter: \"+n+\" ms, last attempt: \"+r+\" ms ago)\"),this.mn=this.fn.Vn(this.dn,i,function(){return e.An=Date.now(),t()}),this.In*=this.En,this.In<this.wn&&(this.In=this.wn),this.In>this.Tn&&(this.In=this.Tn)},t.prototype.yn=function(){null!==this.mn&&(this.mn.pn(),this.mn=null)},t.prototype.cancel=function(){null!==this.mn&&(this.mn.cancel(),this.mn=null)},t.prototype.gn=function(){return(Math.random()-.5)*this.In},t}(),$n=function(){function t(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t(function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)},function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Dn&&g(),this.Dn=!0,this.Sn?this.error?this.Cn(n,this.error):this.Nn(e,this.result):new t(function(t,i){r.bn=function(n){r.Nn(e,n).next(t,i)},r.vn=function(e){r.Cn(n,e).next(t,i)}})},t.prototype.xn=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.Fn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Nn=function(e,n){return e?this.Fn(function(){return e(n)}):t.resolve(n)},t.prototype.Cn=function(e,n){return e?this.Fn(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.kn=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.On=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.kn(r)},t}(),Zn=function(){function n(t,e,r){this.name=t,this.version=e,this.Mn=r,12.2===n.$n((0,i.getUA)())&&d(\"Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\")}return n.delete=function(t){return p(\"SimpleDb\",\"Removing database:\",t),or(window.indexedDB.deleteDatabase(t)).xn()},n.Ln=function(){if(\"undefined\"==typeof indexedDB)return!1;if(n.Bn())return!0;var t=(0,i.getUA)(),e=n.$n(t),r=0<e&&e<10,o=n.qn(t),s=0<o&&o<4.5;return!(t.indexOf(\"MSIE \")>0||t.indexOf(\"Trident/\")>0||t.indexOf(\"Edge/\")>0||r||s)},n.Bn=function(){var e;return void 0!==t&&\"YES\"===(null===(e=t.env)||void 0===e?void 0:e.Un)},n.Kn=function(t,e){return t.store(e)},n.$n=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\\d_]+)/i),n=e?e[1].split(\"_\").slice(0,2).join(\".\"):\"-1\";return Number(n)},n.qn=function(t){var e=t.match(/Android ([\\d.]+)/i),n=e?e[1].split(\".\").slice(0,2).join(\".\"):\"-1\";return Number(n)},n.prototype.Qn=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.db?[3,2]:(p(\"SimpleDb\",\"Opening database:\",this.name),n=this,[4,new Promise(function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new er(t,\"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed.\"))},i.onerror=function(e){var r=e.target.error;\"VersionError\"===r.name?n(new h(c.FAILED_PRECONDITION,\"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.\")):n(new er(t,r))},i.onupgradeneeded=function(t){p(\"SimpleDb\",'Database \"'+r.name+'\" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.Mn.createOrUpgrade(e,i.transaction,t.oldVersion,r.version).next(function(){p(\"SimpleDb\",\"Database upgrade to version \"+r.version+\" complete\")})}})]);case 1:n.db=e.sent(),e.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return r.Wn(t)}),this.db)]}})})},n.prototype.jn=function(t){this.Wn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},n.prototype.runTransaction=function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,u,c,h;return(0,e.__generator)(this,function(f){switch(f.label){case 0:o=\"readonly\"===n,s=0,u=function(){var n,u,a,h,f;return(0,e.__generator)(this,function(e){switch(e.label){case 0:++s,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,c.Qn(t)];case 2:return c.db=e.sent(),n=rr.open(c.db,t,o?\"readonly\":\"readwrite\",r),u=i(n).catch(function(t){return n.abort(t),$n.reject(t)}).xn(),a={},u.catch(function(){}),[4,n.Gn];case 3:return[2,(a.value=(e.sent(),u),a)];case 4:return h=e.sent(),f=\"FirebaseError\"!==h.name&&s<3,p(\"SimpleDb\",\"Transaction failed with error:\",h.message,\"Retrying:\",f),c.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},c=this,f.label=1;case 1:return[5,u()];case 2:if(\"object\"==a(h=f.sent()))return[2,h.value];f.label=3;case 3:return[3,1];case 4:return[2]}})})},n.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},n}(),tr=function(){function t(t){this.zn=t,this.Hn=!1,this.Jn=null}return Object.defineProperty(t.prototype,\"Sn\",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"Yn\",{get:function(){return this.Jn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"cursor\",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Hn=!0},t.prototype.Xn=function(t){this.Jn=t},t.prototype.delete=function(){return or(this.zn.delete())},t}(),er=function(t){function n(e,n){var r=this;return(r=t.call(this,c.UNAVAILABLE,\"IndexedDB transaction '\"+e+\"' failed: \"+n)||this).name=\"IndexedDbTransactionError\",r}return(0,e.__extends)(n,t),n}(h);function nr(t){return\"IndexedDbTransactionError\"===t.name}var rr=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Zn=new Xn,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){e.error?n.Zn.reject(new er(t,e.error)):n.Zn.resolve()},this.transaction.onerror=function(e){var r=ur(e.target.error);n.Zn.reject(new er(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new er(n,e)}},Object.defineProperty(t.prototype,\"Gn\",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(p(\"SimpleDb\",\"Aborting transaction:\",t?t.message:\"Client-initiated abort\"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ir(e)},t}(),ir=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(p(\"SimpleDb\",\"PUT\",this.store.name,t,e),n=this.store.put(e,t)):(p(\"SimpleDb\",\"PUT\",this.store.name,\"<auto-key>\",t),n=this.store.put(t)),or(n)},t.prototype.add=function(t){return p(\"SimpleDb\",\"ADD\",this.store.name,t,t),or(this.store.add(t))},t.prototype.get=function(t){var e=this;return or(this.store.get(t)).next(function(n){return void 0===n&&(n=null),p(\"SimpleDb\",\"GET\",e.store.name,t,n),n})},t.prototype.delete=function(t){return p(\"SimpleDb\",\"DELETE\",this.store.name,t),or(this.store.delete(t))},t.prototype.count=function(){return p(\"SimpleDb\",\"COUNT\",this.store.name),or(this.store.count())},t.prototype.ts=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.es(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.ns=function(t,e){p(\"SimpleDb\",\"DELETE ALL\",this.store.name);var n=this.options(t,e);n.ss=!1;var r=this.cursor(n);return this.es(r,function(t,e,n){return n.delete()})},t.prototype.rs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.es(r,e)},t.prototype.os=function(t){var e=this.cursor({});return new $n(function(n,r){e.onerror=function(t){var e=ur(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.es=function(t,e){var n=[];return new $n(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new tr(i),s=e(i.primaryKey,i.value,o);if(s instanceof $n){var u=s.catch(function(t){return o.done(),$n.reject(t)});n.push(u)}o.Sn?r():null===o.Yn?i.continue():i.continue(o.Yn)}else r()}}).next(function(){return $n.kn(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&(\"string\"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e=\"next\";if(t.reverse&&(e=\"prev\"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function or(t){return new $n(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ur(t.target.error);n(e)}})}var sr=!1;function ur(t){var e=Zn.$n((0,i.getUA)());if(e>=12.2&&e<13){var n=\"An internal error was encountered in the Indexed Database server\";if(t.message.indexOf(n)>=0){var r=new h(\"internal\",\"IOS_INDEXEDDB_BUG1: IndexedDb has thrown '\"+n+\"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\");return sr||(sr=!0,setTimeout(function(){throw r},0)),r}}return t}function ar(){return\"undefined\"!=typeof window?window:null}function cr(){return\"undefined\"!=typeof document?document:null}var hr=function(){function t(t,e,n,r,i){this.hs=t,this.dn=e,this.cs=n,this.op=r,this.us=i,this.ls=new Xn,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch(function(t){})}return t._s=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.fs=setTimeout(function(){return e.ds()},t)},t.prototype.pn=function(){return this.ds()},t.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new h(c.CANCELLED,\"Operation cancelled\"+(t?\": \"+t:\"\"))))},t.prototype.ds=function(){var t=this;this.hs.ws(function(){return null!==t.fs?(t.clearTimeout(),t.op().then(function(e){return t.ls.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.fs&&(this.us(this),clearTimeout(this.fs),this.fs=null)},t}(),fr=function(){function t(){var t=this;this.Es=Promise.resolve(),this.Ts=[],this.Is=!1,this.As=[],this.Rs=null,this.Ps=!1,this.gs=[],this.Vs=new Jn(this,\"async_queue_retry\"),this.ys=function(){var e=cr();e&&p(\"AsyncQueue\",\"Visibility state changed to  \",e.visibilityState),t.Vs.yn()};var e=cr();e&&\"function\"==typeof e.addEventListener&&e.addEventListener(\"visibilitychange\",this.ys)}return Object.defineProperty(t.prototype,\"ps\",{get:function(){return this.Is},enumerable:!1,configurable:!0}),t.prototype.ws=function(t){this.enqueue(t)},t.prototype.bs=function(t){this.vs(),this.Ss(t)},t.prototype.Ds=function(){if(!this.Is){this.Is=!0;var t=cr();t&&\"function\"==typeof t.removeEventListener&&t.removeEventListener(\"visibilitychange\",this.ys)}},t.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise(function(t){}):this.Ss(t)},t.prototype.Cs=function(t){var e=this;this.ws(function(){return e.Ts.push(t),e.Ns()})},t.prototype.Ns=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(0===this.Ts.length)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return e.sent(),this.Ts.shift(),this.Vs.reset(),[3,4];case 3:if(!nr(t=e.sent()))throw t;return p(\"AsyncQueue\",\"Operation failed with retryable error: \"+t),[3,4];case 4:this.Ts.length>0&&this.Vs.Pn(function(){return n.Ns()}),e.label=5;case 5:return[2]}})})},t.prototype.Ss=function(t){var e=this,n=this.Es.then(function(){return e.Ps=!0,t().catch(function(t){throw e.Rs=t,e.Ps=!1,d(\"INTERNAL UNHANDLED ERROR: \",function(t){var e=t.message||\"\";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+\"\\n\"+t.stack),e}(t)),t}).then(function(t){return e.Ps=!1,t})});return this.Es=n,n},t.prototype.Vn=function(t,e,n){var r=this;this.vs(),this.gs.indexOf(t)>-1&&(e=0);var i=hr._s(this,t,e,n,function(t){return r.xs(t)});return this.As.push(i),i},t.prototype.vs=function(){this.Rs&&g()},t.prototype.Fs=function(){},t.prototype.ks=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this.Es];case 1:e.sent(),e.label=2;case 2:if(t!==this.Es)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Os=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},t.prototype.Ms=function(t){var e=this;return this.ks().then(function(){e.As.sort(function(t,e){return t.cs-e.cs});for(var n=0,r=e.As;n<r.length;n++){var i=r[n];if(i.pn(),\"all\"!==t&&i.dn===t)break}return e.ks()})},t.prototype.$s=function(t){this.gs.push(t)},t.prototype.xs=function(t){var e=this.As.indexOf(t);this.As.splice(e,1)},t}();function lr(t,e){if(d(\"AsyncQueue\",e+\": \"+t),nr(t))return new h(c.UNAVAILABLE,e+\": \"+t);throw t}var pr=function(){this.Ls=void 0,this.listeners=[]},dr=function(){this.Bs=new C(function(t){return kn(t)},xn),this.onlineState=\"Unknown\",this.qs=new Set};function vr(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u,a,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(r=w(t),i=n.query,o=!1,(s=r.Bs.get(i))||(o=!0,s=new pr),!o)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),u=s,[4,r.Us(i)];case 2:return u.Ls=e.sent(),[3,4];case 3:return a=e.sent(),c=lr(a,\"Initialization of query '\"+Pn(n.query)+\"' failed\"),[2,void n.onError(c)];case 4:return r.Bs.set(i,s),s.listeners.push(n),n.Ks(r.onlineState),s.Ls&&n.Qs(s.Ls)&&wr(r),[2]}})})}function yr(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u;return(0,e.__generator)(this,function(e){return r=w(t),i=n.query,o=!1,(s=r.Bs.get(i))&&(u=s.listeners.indexOf(n))>=0&&(s.listeners.splice(u,1),o=0===s.listeners.length),o?[2,(r.Bs.delete(i),r.Ws(i))]:[2]})})}function gr(t,e){for(var n=w(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Bs.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Ls=s}}r&&wr(n)}function mr(t,e,n){var r=w(t),i=r.Bs.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Bs.delete(e)}function wr(t){t.qs.forEach(function(t){t.next()})}var _r=function(){function t(t,e,n){this.query=t,this.js=e,this.Gs=!1,this.zs=null,this.onlineState=\"Unknown\",this.options=n||{}}return t.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _t(t.query,t.docs,t.Kt,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.js.next(t),o=!0):this.Js(t,this.onlineState)&&(this.Ys(t),o=!0),this.zs=t,o},t.prototype.onError=function(t){this.js.error(t)},t.prototype.Ks=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Js(this.zs,t)&&(this.Ys(this.zs),e=!0),e},t.prototype.Js=function(t,e){if(!t.fromCache)return!0;var n=\"Offline\"!==e;return!(this.options.Xs&&n||t.docs.P()&&\"Offline\"!==e)},t.prototype.Hs=function(t){if(t.docChanges.length>0)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Ys=function(t){t=_t.Gt(t.query,t.docs,t.Qt,t.fromCache),this.Gs=!0,this.js.next(t)},t}(),br=function(){function t(t){this.uid=t}return t.prototype.Zs=function(){return null!=this.uid},t.prototype.ti=function(){return this.Zs()?\"uid:\"+this.uid:\"anonymous-user\"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();br.UNAUTHENTICATED=new br(null),br.ei=new br(\"google-credentials-uid\"),br.ni=new br(\"first-party-uid\");var Ir=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.si=function(t){return n.ii(t)},this.ri=function(t){return e.oi(t)})}return t.prototype.ii=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ri&&this.ri(t),t},t}();function Er(t,e){return\"firestore_clients_\"+t+\"_\"+e}function Tr(t,e,n){var r=\"firestore_mutations_\"+t+\"_\"+n;return e.Zs()&&(r+=\"_\"+e.uid),r}function Nr(t,e){return\"firestore_targets_\"+t+\"_\"+e}Ir.ai=-1;var Ar=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.hi=function(e,n,r){var i=JSON.parse(r),o=\"object\"==a(i)&&-1!==[\"pending\",\"acknowledged\",\"rejected\"].indexOf(i.state)&&(void 0===i.error||\"object\"==a(i.error)),s=void 0;return o&&i.error&&(o=\"string\"==typeof i.error.message&&\"string\"==typeof i.error.code)&&(s=new h(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(d(\"SharedClientState\",\"Failed to parse mutation state for ID '\"+n+\"': \"+r),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Dr=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.hi=function(e,n){var r=JSON.parse(n),i=\"object\"==a(r)&&-1!==[\"not-current\",\"current\",\"rejected\"].indexOf(r.state)&&(void 0===r.error||\"object\"==a(r.error)),o=void 0;return i&&r.error&&(i=\"string\"==typeof r.error.message&&\"string\"==typeof r.error.code)&&(o=new h(r.error.code,r.error.message)),i?new t(e,r.state,o):(d(\"SharedClientState\",\"Failed to parse target state for ID '\"+e+\"': \"+n),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Sr=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.hi=function(e,n){for(var r=JSON.parse(n),i=\"object\"==a(r)&&r.activeTargetIds instanceof Array,o=gt(),s=0;i&&s<r.activeTargetIds.length;++s)i=K(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(d(\"SharedClientState\",\"Failed to parse client data for instance '\"+e+\"': \"+n),null)},t}(),xr=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.hi=function(e){var n=JSON.parse(e);return\"object\"==a(n)&&-1!==[\"Unknown\",\"Online\",\"Offline\"].indexOf(n.onlineState)&&\"string\"==typeof n.clientId?new t(n.clientId,n.onlineState):(d(\"SharedClientState\",\"Failed to parse online state: \"+e),null)},t}(),kr=function(){function t(){this.activeTargetIds=gt()}return t.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.li=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.L(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Pr=function(){function t(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this._i=r,this.fi=null,this.di=null,this.si=null,this.wi=this.Ei.bind(this),this.Ti=new rt(I),this.Ii=!1,this.mi=[];var o=n.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");this.storage=this.window.localStorage,this.currentUser=i,this.Ai=Er(this.persistenceKey,this._i),this.Ri=function(t){return\"firestore_sequence_number_\"+t}(this.persistenceKey),this.Ti=this.Ti.ot(this._i,new kr),this.Pi=new RegExp(\"^firestore_clients_\"+o+\"_([^_]*)$\"),this.gi=new RegExp(\"^firestore_mutations_\"+o+\"_(\\\\d+)(?:_(.*))?$\"),this.Vi=new RegExp(\"^firestore_targets_\"+o+\"_(\\\\d+)$\"),this.yi=function(t){return\"firestore_online_state_\"+t}(this.persistenceKey),this.window.addEventListener(\"storage\",this.wi)}return t.Ln=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,s,u,a,c,h,f,l=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,this.fi.pi()];case 1:for(t=e.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this._i&&(o=this.getItem(Er(this.persistenceKey,i)))&&(s=Sr.hi(i,o))&&(this.Ti=this.Ti.ot(s.clientId,s));for(this.bi(),(u=this.storage.getItem(this.yi))&&(a=this.vi(u))&&this.Si(a),c=0,h=this.mi;c<h.length;c++)f=h[c],this.Ei(f);return this.mi=[],this.window.addEventListener(\"unload\",function(){return l.Di()}),this.Ii=!0,[2]}})})},t.prototype.oi=function(t){this.setItem(this.Ri,JSON.stringify(t))},t.prototype.Ci=function(){return this.Ni(this.Ti)},t.prototype.xi=function(t){var e=!1;return this.Ti.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.Fi=function(t){this.ki(t,\"pending\")},t.prototype.Oi=function(t,e,n){this.ki(t,e,n),this.Mi(t)},t.prototype.$i=function(t){var e=\"not-current\";if(this.xi(t)){var n=this.storage.getItem(Nr(this.persistenceKey,t));if(n){var r=Dr.hi(t,n);r&&(e=r.state)}}return this.Li.ui(t),this.bi(),e},t.prototype.Bi=function(t){this.Li.li(t),this.bi()},t.prototype.qi=function(t){return this.Li.activeTargetIds.has(t)},t.prototype.Ui=function(t){this.removeItem(Nr(this.persistenceKey,t))},t.prototype.Ki=function(t,e,n){this.Qi(t,e,n)},t.prototype.Wi=function(t,e,n){var r=this;e.forEach(function(t){r.Mi(t)}),this.currentUser=t,n.forEach(function(t){r.Fi(t)})},t.prototype.ji=function(t){this.Gi(t)},t.prototype.Di=function(){this.Ii&&(this.window.removeEventListener(\"storage\",this.wi),this.removeItem(this.Ai),this.Ii=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return p(\"SharedClientState\",\"READ\",t,e),e},t.prototype.setItem=function(t,e){p(\"SharedClientState\",\"SET\",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){p(\"SharedClientState\",\"REMOVE\",t),this.storage.removeItem(t)},t.prototype.Ei=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(p(\"SharedClientState\",\"EVENT\",r.key,r.newValue),r.key===this.Ai)return void d(\"Received WebStorage notification for local change. Another client might have garbage-collected our state\");this.fn.Cs(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var t,n,i,o,s,u;return(0,e.__generator)(this,function(e){if(this.Ii){if(null!==r.key)if(this.Pi.test(r.key)){if(null==r.newValue)return t=this.zi(r.key),[2,this.Hi(t,null)];if(n=this.Ji(r.key,r.newValue))return[2,this.Hi(n.clientId,n)]}else if(this.gi.test(r.key)){if(null!==r.newValue&&(i=this.Yi(r.key,r.newValue)))return[2,this.Xi(i)]}else if(this.Vi.test(r.key)){if(null!==r.newValue&&(o=this.Zi(r.key,r.newValue)))return[2,this.tr(o)]}else if(r.key===this.yi){if(null!==r.newValue&&(s=this.vi(r.newValue)))return[2,this.Si(s)]}else r.key===this.Ri&&(u=function(t){var e=Ir.ai;if(null!=t)try{var n=JSON.parse(t);m(\"number\"==typeof n),e=n}catch(t){d(\"SharedClientState\",\"Failed to read sequence number from WebStorage\",t)}return e}(r.newValue))!==Ir.ai&&this.si(u)}else this.mi.push(r);return[2]})})})}},Object.defineProperty(t.prototype,\"Li\",{get:function(){return this.Ti.get(this._i)},enumerable:!1,configurable:!0}),t.prototype.bi=function(){this.setItem(this.Ai,this.Li.ci())},t.prototype.ki=function(t,e,n){var r=new Ar(this.currentUser,t,e,n),i=Tr(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},t.prototype.Mi=function(t){var e=Tr(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Gi=function(t){var e={clientId:this._i,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},t.prototype.Qi=function(t,e,n){var r=Nr(this.persistenceKey,t),i=new Dr(t,e,n);this.setItem(r,i.ci())},t.prototype.zi=function(t){var e=this.Pi.exec(t);return e?e[1]:null},t.prototype.Ji=function(t,e){var n=this.zi(t);return Sr.hi(n,e)},t.prototype.Yi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ar.hi(new br(i),r,e)},t.prototype.Zi=function(t,e){var n=this.Vi.exec(t),r=Number(n[1]);return Dr.hi(r,e)},t.prototype.vi=function(t){return xr.hi(t)},t.prototype.Xi=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.fi.er(t.batchId,t.state,t.error)]:(p(\"SharedClientState\",\"Ignoring mutation for non-active user \"+t.user.uid),[2])})})},t.prototype.tr=function(t){return this.fi.nr(t.targetId,t.state,t.error)},t.prototype.Hi=function(t,e){var n=this,r=e?this.Ti.ot(t,e):this.Ti.remove(t),i=this.Ni(this.Ti),o=this.Ni(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.fi.sr(s,u).then(function(){n.Ti=r})},t.prototype.Si=function(t){this.Ti.get(t.clientId)&&this.di(t.onlineState)},t.prototype.Ni=function(t){var e=gt();return t.forEach(function(t,n){e=e.Ot(n.activeTargetIds)}),e},t}(),Lr=function(){function t(){this.ir=new kr,this.rr={},this.di=null,this.si=null}return t.prototype.Fi=function(t){},t.prototype.Oi=function(t,e,n){},t.prototype.$i=function(t){return this.ir.ui(t),this.rr[t]||\"not-current\"},t.prototype.Ki=function(t,e,n){this.rr[t]=e},t.prototype.Bi=function(t){this.ir.li(t)},t.prototype.qi=function(t){return this.ir.activeTargetIds.has(t)},t.prototype.Ui=function(t){delete this.rr[t]},t.prototype.Ci=function(){return this.ir.activeTargetIds},t.prototype.xi=function(t){return this.ir.activeTargetIds.has(t)},t.prototype.start=function(){return this.ir=new kr,Promise.resolve()},t.prototype.Wi=function(t,e,n){},t.prototype.ji=function(t){},t.prototype.Di=function(){},t.prototype.oi=function(t){},t}(),Or=function(){function t(t,e,n,r){this.batchId=t,this.ar=e,this.baseMutations=n,this.mutations=r}return t.prototype.hr=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Ye(o,e,r[i]))}return e},t.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Xe(i,e,e,this.ar))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Xe(a,e,o,this.ar))}return e},t.prototype.lr=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.ur(r.key,t.get(r.key));i&&(n=n.ot(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},vt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&E(this.mutations,t.mutations,function(t,e){return $e(t,e)})&&E(this.baseMutations,t.baseMutations,function(t,e){return $e(t,e)})},t}(),Vr=function(){function t(t,e,n,r){this.batch=t,this._r=e,this.cr=n,this.dr=r}return t.from=function(e,n,r){m(e.mutations.length===r.length);for(var i=pt,o=e.mutations,s=0;s<o.length;s++)i=i.ot(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Cr=function(){function t(){this.wr=new C(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Er=!1}return Object.defineProperty(t.prototype,\"readTime\",{get:function(){return this.Tr},set:function(t){this.Tr=t},enumerable:!1,configurable:!0}),t.prototype.Ir=function(t,e){this.mr(),this.readTime=e,this.wr.set(t.key,t)},t.prototype.Ar=function(t,e){this.mr(),e&&(this.readTime=e),this.wr.set(t,null)},t.prototype.Rr=function(t,e){this.mr();var n=this.wr.get(e);return void 0!==n?$n.resolve(n):this.Pr(t,e)},t.prototype.getEntries=function(t,e){return this.gr(t,e)},t.prototype.apply=function(t){return this.mr(),this.Er=!0,this.Vr(t)},t.prototype.mr=function(){},t}(),Rr=\"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.\",Ur=function(){function t(){this.yr=[]}return t.prototype.pr=function(t){this.yr.push(t)},t.prototype.br=function(){this.yr.forEach(function(t){return t()})},t}(),Mr=function(){function t(t,e,n){this.vr=t,this.Sr=e,this.Dr=n}return t.prototype.Cr=function(t,e){var n=this;return this.Sr.Nr(t,e).next(function(r){return n.Fr(t,e,r)})},t.prototype.Fr=function(t,e,n){return this.vr.Rr(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].ur(e,t);return t})},t.prototype.kr=function(t,e,n){var r=ht();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].ur(t,e);r=r.ot(t,e)}),r},t.prototype.Or=function(t,e){var n=this;return this.vr.getEntries(t,e).next(function(e){return n.Mr(t,e)})},t.prototype.Mr=function(t,e){var n=this;return this.Sr.$r(t,e).next(function(r){var i=n.kr(t,e,r),o=ct();return i.forEach(function(t,e){e||(e=new dn(t,U.min())),o=o.ot(t,e)}),o})},t.prototype.Lr=function(t,e,n){return function(t){return G.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Br(t,e.path):En(e)?this.qr(t,e,n):this.Ur(t,e,n)},t.prototype.Br=function(t,e){return this.Cr(t,new G(e)).next(function(t){var e=lt();return t instanceof pn&&(e=e.ot(t.key,t)),e})},t.prototype.qr=function(t,e,n){var r=this,i=e.collectionGroup,o=lt();return this.Dr.Kr(t,i).next(function(s){return $n.forEach(s,function(s){var u=function(t,e){return new yn(e,null,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(e,s.child(i));return r.Ur(t,u,n).next(function(t){t.forEach(function(t,e){o=o.ot(t,e)})})}).next(function(){return o})})},t.prototype.Ur=function(t,e,n){var r,i,o=this;return this.vr.Lr(t,e,n).next(function(n){return r=n,o.Sr.Qr(t,e)}).next(function(e){return i=e,o.Wr(t,i,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=Xe(a,h,h,o.ar);r=f instanceof pn?r.ot(c,f):r.remove(c)}})}).next(function(){return r.forEach(function(t,n){Ln(e,n)||(r=r.remove(t))}),r})},t.prototype.Wr=function(t,e,n){for(var r=vt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof en&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.vr.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof pn&&(c=c.ot(t,e))}),c})},t}(),qr=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Gr=r}return t.zr=function(e,n){for(var r=vt(),i=vt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}();function Fr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=I(n,i);return 0===s?I(r,o):s}var jr=function(){function t(t){this.Hr=t,this.buffer=new st(Fr),this.Jr=0}return t.prototype.Yr=function(){return++this.Jr},t.prototype.Xr=function(t){var e=[t,this.Yr()];if(this.buffer.size<this.Hr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Fr(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,\"maxValue\",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Gr={Zr:!1,eo:0,no:0,so:0},Br=function(){function t(t,e,n){this.io=t,this.ro=e,this.oo=n}return t.ao=function(e){return new t(e,t.ho,t.co)},t}();Br.uo=-1,Br.lo=1048576,Br._o=41943040,Br.ho=10,Br.co=1e3,Br.fo=new Br(Br._o,Br.ho,Br.co),Br.do=new Br(Br.uo,0,0);var zr=function(){function t(t,e){this.wo=t,this.hs=e,this.Eo=!1,this.To=null}return t.prototype.start=function(t){this.wo.params.io!==Br.uo&&this.Io(t)},t.prototype.stop=function(){this.To&&(this.To.cancel(),this.To=null)},Object.defineProperty(t.prototype,\"Ii\",{get:function(){return null!==this.To},enumerable:!1,configurable:!0}),t.prototype.Io=function(t){var n=this,r=this.Eo?3e5:6e4;p(\"LruGarbageCollector\",\"Garbage collection scheduled in \"+r+\"ms\"),this.To=this.hs.Vn(\"lru_garbage_collection\",r,function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:this.To=null,this.Eo=!0,e.label=1;case 1:return e.trys.push([1,3,,7]),[4,t.mo(this.wo)];case 2:return e.sent(),[3,7];case 3:return nr(n=e.sent())?(p(\"LruGarbageCollector\",\"Ignoring IndexedDB error during garbage collection: \",n),[3,6]):[3,4];case 4:return[4,co(n)];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return[4,this.Io(t)];case 8:return e.sent(),[2]}})})})},t}(),Kr=function(){function t(t,e){this.Ao=t,this.params=e}return t.prototype.Ro=function(t,e){return this.Ao.Po(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.Vo=function(t,e){var n=this;if(0===e)return $n.resolve(Ir.ai);var r=new jr(e);return this.Ao.Ce(t,function(t){return r.Xr(t.sequenceNumber)}).next(function(){return n.Ao.yo(t,function(t){return r.Xr(t)})}).next(function(){return r.maxValue})},t.prototype.po=function(t,e,n){return this.Ao.po(t,e,n)},t.prototype.bo=function(t,e){return this.Ao.bo(t,e)},t.prototype.vo=function(t,e){var n=this;return this.params.io===Br.uo?(p(\"LruGarbageCollector\",\"Garbage collection skipped; disabled\"),$n.resolve(Gr)):this.So(t).next(function(r){return r<n.params.io?(p(\"LruGarbageCollector\",\"Garbage collection skipped; Cache size \"+r+\" is lower than threshold \"+n.params.io),Gr):n.Do(t,e)})},t.prototype.So=function(t){return this.Ao.So(t)},t.prototype.Do=function(t,e){var n,i,o,s,u,a,c,h=this,f=Date.now();return this.Ro(t,this.params.ro).next(function(e){return e>h.params.oo?(p(\"LruGarbageCollector\",\"Capping sequence numbers to collect down to the maximum of \"+h.params.oo+\" from \"+e),i=h.params.oo):i=e,s=Date.now(),h.Vo(t,i)}).next(function(r){return n=r,u=Date.now(),h.po(t,n,e)}).next(function(e){return o=e,a=Date.now(),h.bo(t,n)}).next(function(t){return c=Date.now(),l()<=r.LogLevel.DEBUG&&p(\"LruGarbageCollector\",\"LRU Garbage Collection\\n\\tCounted targets in \"+(s-f)+\"ms\\n\\tDetermined least recently used \"+i+\" in \"+(u-s)+\"ms\\n\\tRemoved \"+o+\" targets in \"+(a-u)+\"ms\\n\\tRemoved \"+t+\" documents in \"+(c-a)+\"ms\\nTotal Duration: \"+(c-f)+\"ms\"),$n.resolve({Zr:!0,eo:i,no:o,so:t})})},t}();function Wr(t){for(var e=\"\",n=0;n<t.length;n++)e.length>0&&(e=Hr(e)),e=Qr(t.get(n),e);return Hr(e)}function Qr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case\"\\0\":n+=\"\u0001\u0010\";break;case\"\u0001\":n+=\"\u0001\u0011\";break;default:n+=o}}return n}function Hr(t){return t+\"\u0001\u0001\"}function Yr(t){var e=t.length;if(m(e>=2),2===e)return m(\"\u0001\"===t.charAt(0)&&\"\u0001\"===t.charAt(1)),q.U();for(var n=e-2,r=[],i=\"\",o=0;o<e;){var s=t.indexOf(\"\u0001\",o);switch((s<0||s>n)&&g(),t.charAt(s+1)){case\"\u0001\":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=\"\"),r.push(a);break;case\"\u0010\":i+=t.substring(o,s),i+=\"\\0\";break;case\"\u0011\":i+=t.substring(o,s+1);break;default:g()}o=s+2}return new q(r)}var Xr=function(t){this.Co=t};function Jr(t,e){if(e.document)return function(t,e,n){var r=ce(t,e.name),i=oe(e.updateTime),o=new cn({mapValue:{fields:e.fields}});return new pn(r,i,o,{hasCommittedMutations:!!n})}(t.Co,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=G.Z(e.noDocument.path),r=ni(e.noDocument.readTime);return new dn(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=G.Z(e.unknownDocument.path),o=ni(e.unknownDocument.version);return new vn(i,o)}return g()}function $r(t,e,n){var r=Zr(n),i=e.key.path.F().L();if(e instanceof pn){var o=function(t,e){return{name:ae(t,e.key),fields:e.rn().mapValue.fields,updateTime:ne(t,e.version.v())}}(t.Co,e),s=e.hasCommittedMutations;return new Si(null,null,o,s,r,i)}if(e instanceof dn){var u=e.key.path.L(),a=ei(e.version),c=e.hasCommittedMutations;return new Si(null,new Ai(u,a),null,c,r,i)}if(e instanceof vn){var h=e.key.path.L(),f=ei(e.version);return new Si(new Di(h,f),null,null,!0,r,i)}return g()}function Zr(t){var e=t.v();return[e.seconds,e.nanoseconds]}function ti(t){var e=new R(t[0],t[1]);return U.V(e)}function ei(t){var e=t.v();return new bi(e.seconds,e.nanoseconds)}function ni(t){var e=new R(t.seconds,t.nanoseconds);return U.V(e)}function ri(t,e){var n=(e.baseMutations||[]).map(function(e){return ye(t.Co,e)}),r=e.mutations.map(function(e){return ye(t.Co,e)}),i=R.fromMillis(e.localWriteTimeMs);return new Or(e.batchId,i,n,r)}function ii(t){var e,n,r=ni(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ni(t.lastLimboFreeSnapshotVersion):U.min();return void 0!==t.query.documents?(m(1===(n=t.query).documents.length),e=Nn(mn(fe(n.documents[0])))):e=we(t.query),new Z(e,t.targetId,0,t.lastListenSequenceNumber,r,i,N.fromBase64String(t.resumeToken))}function oi(t,e){var n,r=ei(e.nt),i=ei(e.lastLimboFreeSnapshotVersion);n=X(e.target)?ge(t.Co,e.target):me(t.Co,e.target);var o=e.resumeToken.toBase64();return new ki(e.targetId,H(e.target),r,o,e.sequenceNumber,i,n)}var si=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Dr=n,this.No=r,this.xo={}}return t.Fo=function(e,n,r,i){return m(\"\"!==e.uid),new t(e.Zs()?e.uid:\"\",n,r,i)},t.prototype.ko=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ci(t).rs({index:Ti.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.Oo=function(t,e,n,r){var i=this,o=hi(t),s=ci(t);return s.add({}).next(function(u){m(\"number\"==typeof u);for(var a=new Or(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return ve(t.Co,e)}),i=n.mutations.map(function(e){return ve(t.Co,e)});return new Ti(e,n.batchId,n.ar.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new st(function(t,e){return I(t.B(),e.B())}),l=0,p=r;l<p.length;l++){var d=p[l],v=Ni.key(i.userId,d.key.path,u);f=f.add(d.key.path.F()),h.push(s.put(c)),h.push(o.put(v,Ni.PLACEHOLDER))}return f.forEach(function(e){h.push(i.Dr.Mo(t,e))}),t.pr(function(){i.xo[u]=a.keys()}),$n.kn(h).next(function(){return a})})},t.prototype.$o=function(t,e){var n=this;return ci(t).get(e).next(function(t){return t?(m(t.userId===n.userId),ri(n.serializer,t)):null})},t.prototype.Lo=function(t,e){var n=this;return this.xo[e]?$n.resolve(this.xo[e]):this.$o(t,e).next(function(t){if(t){var r=t.keys();return n.xo[e]=r,r}return null})},t.prototype.Bo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ci(t).rs({index:Ti.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(m(e.batchId>=r),o=ri(n.serializer,e)),i.done()}).next(function(){return o})},t.prototype.qo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ci(t).rs({index:Ti.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.Uo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ci(t).ts(Ti.userMutationsIndex,n).next(function(t){return t.map(function(t){return ri(e.serializer,t)})})},t.prototype.Nr=function(t,e){var n=this,r=Ni.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return hi(t).rs({range:i},function(r,i,s){var u=r[0],a=r[1],c=r[2],h=Yr(a);if(u===n.userId&&e.path.isEqual(h))return ci(t).get(c).next(function(t){if(!t)throw g();m(t.userId===n.userId),o.push(ri(n.serializer,t))});s.done()}).next(function(){return o})},t.prototype.$r=function(t,e){var n=this,r=new st(I),i=[];return e.forEach(function(e){var o=Ni.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=hi(t).rs({range:s},function(t,i,o){var s=t[0],u=t[1],a=t[2],c=Yr(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()});i.push(u)}),$n.kn(i).next(function(){return n.Ko(t,r)})},t.prototype.Qr=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ni.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new st(I);return hi(t).rs({range:s},function(t,e,o){var s=t[0],a=t[1],c=t[2],h=Yr(a);s===n.userId&&r.M(h)?h.length===i&&(u=u.add(c)):o.done()}).next(function(){return n.Ko(t,u)})},t.prototype.Ko=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(ci(t).get(e).next(function(t){if(null===t)throw g();m(t.userId===n.userId),r.push(ri(n.serializer,t))}))}),$n.kn(i).next(function(){return r})},t.prototype.Qo=function(t,e){var n=this;return ai(t.Wo,this.userId,e).next(function(r){return t.pr(function(){n.jo(e.batchId)}),$n.forEach(r,function(e){return n.No.Go(t,e)})})},t.prototype.jo=function(t){delete this.xo[t]},t.prototype.zo=function(t){var e=this;return this.ko(t).next(function(n){if(!n)return $n.resolve();var r=IDBKeyRange.lowerBound(Ni.prefixForUser(e.userId)),i=[];return hi(t).rs({range:r},function(t,n,r){if(t[0]===e.userId){var o=Yr(t[1]);i.push(o)}else r.done()}).next(function(){m(0===i.length)})})},t.prototype.Ho=function(t,e){return ui(t,this.userId,e)},t.prototype.Jo=function(t){var e=this;return fi(t).get(this.userId).next(function(t){return t||new Ei(e.userId,-1,\"\")})},t}();function ui(t,e,n){var r=Ni.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return hi(t).rs({range:o,ss:!0},function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()}).next(function(){return s})}function ai(t,e,n){var r=t.store(Ti.store),i=t.store(Ni.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.rs({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){m(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Ni.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return $n.kn(o).next(function(){return c})}function ci(t){return Wi.Kn(t,Ti.store)}function hi(t){return Wi.Kn(t,Ni.store)}function fi(t){return Wi.Kn(t,Ei.store)}var li=function(){function t(t,e){this.serializer=t,this.Dr=e}return t.prototype.Ir=function(t,e,n){return vi(t).put(yi(e),n)},t.prototype.Ar=function(t,e){var n=vi(t),r=yi(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.Yo(t,r)})},t.prototype.Rr=function(t,e){var n=this;return vi(t).get(yi(e)).next(function(t){return n.Xo(t)})},t.prototype.Zo=function(t,e){var n=this;return vi(t).get(yi(e)).next(function(t){var e=n.Xo(t);return e?{ta:e,size:gi(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=ht();return this.ea(t,e,function(t,e){var i=n.Xo(e);r=r.ot(t,i)}).next(function(){return r})},t.prototype.na=function(t,e){var n=this,r=ht(),i=new rt(G.D);return this.ea(t,e,function(t,e){var o=n.Xo(e);o?(r=r.ot(t,o),i=i.ot(t,gi(e))):(r=r.ot(t,null),i=i.ot(t,0))}).next(function(){return{sa:r,ia:i}})},t.prototype.ea=function(t,e,n){if(e.P())return $n.resolve();var r=IDBKeyRange.bound(e.first().path.L(),e.last().path.L()),i=e._t(),o=i.It();return vi(t).rs({range:r},function(t,e,r){for(var s=G.Z(t);o&&G.D(o,s)<0;)n(o,null),o=i.It();o&&o.isEqual(s)&&(n(o,e),o=i.At()?i.It():null),o?r.Xn(o.path.L()):r.done()}).next(function(){for(;o;)n(o,null),o=i.At()?i.It():null})},t.prototype.Lr=function(t,e,n){var r=this,i=lt(),o=e.path.length+1,s={};if(n.isEqual(U.min())){var u=e.path.L();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.L(),c=Zr(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Si.collectionReadTimeIndex}return vi(t).rs(s,function(t,n,s){if(t.length===o){var u=Jr(r.serializer,n);e.path.M(u.key.path)?u instanceof pn&&Ln(e,u)&&(i=i.ot(u.key,u)):s.done()}}).next(function(){return i})},t.prototype.ra=function(t){return new pi(this,!!t&&t.oa)},t.prototype.aa=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return di(t).get(xi.key).next(function(t){return m(!!t),t})},t.prototype.Yo=function(t,e){return di(t).put(xi.key,e)},t.prototype.Xo=function(t){if(t){var e=Jr(this.serializer,t);return e instanceof dn&&e.version.isEqual(U.min())?null:e}return null},t}(),pi=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).ha=e,r.oa=n,r.ca=new C(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,e.__extends)(n,t),n.prototype.Vr=function(t){var e=this,n=[],r=0,i=new st(function(t,e){return I(t.B(),e.B())});return this.wr.forEach(function(o,s){var u=e.ca.get(o);if(s){var a=$r(e.ha.serializer,s,e.readTime);i=i.add(o.path.F());var c=gi(a);r+=c-u,n.push(e.ha.Ir(t,o,a))}else if(r-=u,e.oa){var h=$r(e.ha.serializer,new dn(o,U.min()),e.readTime);n.push(e.ha.Ir(t,o,h))}else n.push(e.ha.Ar(t,o))}),i.forEach(function(r){n.push(e.ha.Dr.Mo(t,r))}),n.push(this.ha.updateMetadata(t,r)),$n.kn(n)},n.prototype.Pr=function(t,e){var n=this;return this.ha.Zo(t,e).next(function(t){return null===t?(n.ca.set(e,0),null):(n.ca.set(e,t.size),t.ta)})},n.prototype.gr=function(t,e){var n=this;return this.ha.na(t,e).next(function(t){var e=t.sa;return t.ia.forEach(function(t,e){n.ca.set(t,e)}),e})},n}(Cr);function di(t){return Wi.Kn(t,xi.store)}function vi(t){return Wi.Kn(t,Si.store)}function yi(t){return t.path.L()}function gi(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw g();e=t.noDocument}return JSON.stringify(e).length}var mi=function(){function t(){this.ua=new wi}return t.prototype.Mo=function(t,e){return this.ua.add(e),$n.resolve()},t.prototype.Kr=function(t,e){return $n.resolve(this.ua.getEntries(e))},t}(),wi=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.O(),n=t.F(),r=this.index[e]||new st(q.D),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.O(),n=t.F(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new st(q.D)).L()},t}(),_i=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;m(n<r&&n>=0&&r<=10);var o=new rr(\"createOrUpgrade\",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ii.store)}(t),function(t){t.createObjectStore(Ei.store,{keyPath:Ei.keyPath}),t.createObjectStore(Ti.store,{keyPath:Ti.keyPath,autoIncrement:!0}).createIndex(Ti.userMutationsIndex,Ti.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ni.store)}(t),Vi(t),function(t){t.createObjectStore(Si.store)}(t));var s=$n.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Pi.store),t.deleteObjectStore(ki.store),t.deleteObjectStore(Li.store)}(t),Vi(t)),s=s.next(function(){return t=o.store(Li.store),e=new Li(0,0,U.min().v(),0),t.put(Li.key,e);var t,e})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(Ti.store).ts().next(function(n){t.deleteObjectStore(Ti.store),t.createObjectStore(Ti.store,{keyPath:Ti.keyPath,autoIncrement:!0}).createIndex(Ti.userMutationsIndex,Ti.userMutationsKeyPath,{unique:!0});var r=e.store(Ti.store),i=n.map(function(t){return r.put(t)});return $n.kn(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Ci.store,{keyPath:Ci.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(xi.store)}(t),i.addDocumentGlobal(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&r>=8&&(s=s.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains(\"remoteDocumentChanges\")&&t.deleteObjectStore(\"remoteDocumentChanges\")}(t),function(t){var e=t.objectStore(Si.store);e.createIndex(Si.readTimeIndex,Si.readTimeIndexPath,{unique:!1}),e.createIndex(Si.collectionReadTimeIndex,Si.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.rewriteCanonicalIds(o)})),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Si.store).rs(function(t,n){e+=gi(n)}).next(function(){var n=new xi(e);return t.store(xi.store).put(xi.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Ei.store),r=t.store(Ti.store);return n.ts().next(function(n){return $n.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.ts(Ti.userMutationsIndex,i).next(function(r){return $n.forEach(r,function(r){m(r.userId===n.userId);var i=ri(e.serializer,r);return ai(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Pi.store),n=t.store(Si.store);return t.store(Li.store).get(Li.key).next(function(t){var r=[];return n.rs(function(n,i){var o=new q(n),s=[0,Wr(o)];r.push(e.get(s).next(function(n){return n?$n.resolve():function(n){return e.put(new Pi(0,Wr(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return $n.kn(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Oi.store,{keyPath:Oi.keyPath});var n=e.store(Oi.store),r=new wi,i=function(t){if(r.add(t)){var e=t.O(),i=t.F();return n.put({collectionId:e,parent:Wr(i)})}};return e.store(Si.store).rs({ss:!0},function(t,e){var n=new q(t);return i(n.F())}).next(function(){return e.store(Ni.store).rs({ss:!0},function(t,e){t[0];var n=t[1],r=(t[2],Yr(n));return i(r.F())})})},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(ki.store);return n.rs(function(t,r){var i=ii(r),o=oi(e.serializer,i);return n.put(o)})},t}(),bi=function(t,e){this.seconds=t,this.nanoseconds=e},Ii=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ii.store=\"owner\",Ii.key=\"owner\";var Ei=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ei.store=\"mutationQueues\",Ei.keyPath=\"userId\";var Ti=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ti.store=\"mutations\",Ti.keyPath=\"batchId\",Ti.userMutationsIndex=\"userMutationsIndex\",Ti.userMutationsKeyPath=[\"userId\",\"batchId\"];var Ni=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Wr(e)]},t.key=function(t,e,n){return[t,Wr(e),n]},t}();Ni.store=\"documentMutations\",Ni.PLACEHOLDER=new Ni;var Ai=function(t,e){this.path=t,this.readTime=e},Di=function(t,e){this.path=t,this.version=e},Si=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Si.store=\"remoteDocuments\",Si.readTimeIndex=\"readTimeIndex\",Si.readTimeIndexPath=\"readTime\",Si.collectionReadTimeIndex=\"collectionReadTimeIndex\",Si.collectionReadTimeIndexPath=[\"parentPath\",\"readTime\"];var xi=function(t){this.byteSize=t};xi.store=\"remoteDocumentGlobal\",xi.key=\"remoteDocumentGlobalKey\";var ki=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ki.store=\"targets\",ki.keyPath=\"targetId\",ki.queryTargetsIndexName=\"queryTargetsIndex\",ki.queryTargetsKeyPath=[\"canonicalId\",\"targetId\"];var Pi=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Pi.store=\"targetDocuments\",Pi.keyPath=[\"targetId\",\"path\"],Pi.documentTargetsIndex=\"documentTargetsIndex\",Pi.documentTargetsKeyPath=[\"path\",\"targetId\"];var Li=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Li.key=\"targetGlobalKey\",Li.store=\"targetGlobal\";var Oi=function(t,e){this.collectionId=t,this.parent=e};function Vi(t){t.createObjectStore(Pi.store,{keyPath:Pi.keyPath}).createIndex(Pi.documentTargetsIndex,Pi.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ki.store,{keyPath:ki.keyPath}).createIndex(ki.queryTargetsIndexName,ki.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Li.store)}Oi.store=\"collectionParents\",Oi.keyPath=[\"collectionId\",\"parent\"];var Ci=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ci.store=\"clientMetadata\",Ci.keyPath=\"clientId\";var Ri=(0,e.__spreadArrays)((0,e.__spreadArrays)((0,e.__spreadArrays)([Ei.store,Ti.store,Ni.store,Si.store,ki.store,Ii.store,Li.store,Pi.store],[Ci.store]),[xi.store]),[Oi.store]),Ui=function(){function t(){this.la=new wi}return t.prototype.Mo=function(t,e){var n=this;if(!this.la.has(e)){var r=e.O(),i=e.F();t.pr(function(){n.la.add(e)});var o={collectionId:r,parent:Wr(i)};return Mi(t).put(o)}return $n.resolve()},t.prototype.Kr=function(t,e){var n=[],r=IDBKeyRange.bound([e,\"\"],[T(e),\"\"],!1,!0);return Mi(t).ts(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Yr(o.parent))}return n})},t}();function Mi(t){return Wi.Kn(t,Oi.store)}var qi=function(){function t(t){this._a=t}return t.prototype.next=function(){return this._a+=2,this._a},t.fa=function(){return new t(0)},t.da=function(){return new t(-1)},t}(),Fi=function(){function t(t,e){this.No=t,this.serializer=e}return t.prototype.wa=function(t){var e=this;return this.Ea(t).next(function(n){var r=new qi(n.highestTargetId);return n.highestTargetId=r.next(),e.Ta(t,n).next(function(){return n.highestTargetId})})},t.prototype.Ia=function(t){return this.Ea(t).next(function(t){return U.V(new R(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.ma=function(t){return this.Ea(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.Aa=function(t,e,n){var r=this;return this.Ea(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.v()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ta(t,i)})},t.prototype.Ra=function(t,e){var n=this;return this.Pa(t,e).next(function(){return n.Ea(t).next(function(r){return r.targetCount+=1,n.ga(e,r),n.Ta(t,r)})})},t.prototype.Va=function(t,e){return this.Pa(t,e)},t.prototype.ya=function(t,e){var n=this;return this.pa(t,e.targetId).next(function(){return ji(t).delete(e.targetId)}).next(function(){return n.Ea(t)}).next(function(e){return m(e.targetCount>0),e.targetCount-=1,n.Ta(t,e)})},t.prototype.po=function(t,e,n){var r=this,i=0,o=[];return ji(t).rs(function(s,u){var a=ii(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.ya(t,a)))}).next(function(){return $n.kn(o)}).next(function(){return i})},t.prototype.Ce=function(t,e){return ji(t).rs(function(t,n){var r=ii(n);e(r)})},t.prototype.Ea=function(t){return Gi(t).get(Li.key).next(function(t){return m(null!==t),t})},t.prototype.Ta=function(t,e){return Gi(t).put(Li.key,e)},t.prototype.Pa=function(t,e){return ji(t).put(oi(this.serializer,e))},t.prototype.ga=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.ba=function(t){return this.Ea(t).next(function(t){return t.targetCount})},t.prototype.va=function(t,e){var n=H(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return ji(t).rs({range:r,index:ki.queryTargetsIndexName},function(t,n,r){var o=ii(n);Y(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.Sa=function(t,e,n){var r=this,i=[],o=Bi(t);return e.forEach(function(e){var s=Wr(e.path);i.push(o.put(new Pi(n,s))),i.push(r.No.Da(t,n,e))}),$n.kn(i)},t.prototype.Ca=function(t,e,n){var r=this,i=Bi(t);return $n.forEach(e,function(e){var o=Wr(e.path);return $n.kn([i.delete([n,o]),r.No.Na(t,n,e)])})},t.prototype.pa=function(t,e){var n=Bi(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.xa=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Bi(t),i=vt();return r.rs({range:n,ss:!0},function(t,e,n){var r=Yr(t[1]),o=new G(r);i=i.add(o)}).next(function(){return i})},t.prototype.Ho=function(t,e){var n=Wr(e.path),r=IDBKeyRange.bound([n],[T(n)],!1,!0),i=0;return Bi(t).rs({index:Pi.documentTargetsIndex,ss:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.Ue=function(t,e){return ji(t).get(e).next(function(t){return t?ii(t):null})},t}();function ji(t){return Wi.Kn(t,ki.store)}function Gi(t){return Wi.Kn(t,Li.store)}function Bi(t){return Wi.Kn(t,Pi.store)}var zi=\"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.\",Ki=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Wo=e,r.Fa=n,r}return(0,e.__extends)(n,t),n}(Ur),Wi=function(){function t(e,n,r,i,o,s,u,a,f,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.fn=o,this.window=s,this.document=u,this.ka=f,this.Oa=l,this.Ma=null,this.$a=!1,this.isPrimary=!1,this.networkEnabled=!0,this.La=null,this.inForeground=!1,this.Ba=null,this.qa=null,this.Ua=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!t.Ln())throw new h(c.UNIMPLEMENTED,\"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.\");this.No=new Yi(this,i),this.Qa=n+\"main\",this.serializer=new Xr(a),this.Wa=new Zn(this.Qa,10,new _i(this.serializer)),this.ja=new Fi(this.No,this.serializer),this.Dr=new Ui,this.vr=function(t,e){return new li(t,e)}(this.serializer,this.Dr),this.window&&this.window.localStorage?this.Ga=this.window.localStorage:(this.Ga=null,!1===l&&d(\"IndexedDbPersistence\",\"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page.\"))}return t.Kn=function(t,e){if(t instanceof Ki)return Zn.Kn(t.Wo,e);throw g()},t.prototype.start=function(){var t=this;return this.za().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new h(c.FAILED_PRECONDITION,zi);return t.Ha(),t.Ja(),t.Ya(),t.runTransaction(\"getHighestListenSequenceNumber\",\"readonly\",function(e){return t.ja.ma(e)})}).then(function(e){t.Ma=new Ir(e,t.ka)}).then(function(){t.$a=!0}).catch(function(e){return t.Wa&&t.Wa.close(),Promise.reject(e)})},t.prototype.Xa=function(t){var n=this;return this.Ka=function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return this.Ii?[2,t(r)]:[2]})})},t(this.isPrimary)},t.prototype.Za=function(t){var n=this;this.Wa.jn(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return null===r.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.th=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.Ii?[4,this.za()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.za=function(){var t=this;return this.runTransaction(\"updateClientMetadataAndTryBecomePrimary\",\"readwrite\",function(e){return Hi(e).put(new Ci(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.eh(e).next(function(e){e||(t.isPrimary=!1,t.fn.Cs(function(){return t.Ka(!1)}))})}).next(function(){return t.nh(e)}).next(function(n){return t.isPrimary&&!n?t.sh(e).next(function(){return!1}):!!n&&t.ih(e).next(function(){return!0})})}).catch(function(e){if(nr(e))return p(\"IndexedDbPersistence\",\"Failed to extend owner lease: \",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return p(\"IndexedDbPersistence\",\"Releasing owner lease after error during lease refresh\",e),!1}).then(function(e){t.isPrimary!==e&&t.fn.Cs(function(){return t.Ka(e)}),t.isPrimary=e})},t.prototype.eh=function(t){var e=this;return Qi(t).get(Ii.key).next(function(t){return $n.resolve(e.rh(t))})},t.prototype.oh=function(t){return Hi(t).delete(this.clientId)},t.prototype.ah=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,s=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return!this.isPrimary||this.hh(this.Ua,18e5)?[3,2]:(this.Ua=Date.now(),[4,this.runTransaction(\"maybeGarbageCollectMultiClientState\",\"readwrite-primary\",function(e){var n=t.Kn(e,Ci.store);return n.ts().next(function(t){var e=s.uh(t,18e5),r=t.filter(function(t){return-1===e.indexOf(t)});return $n.forEach(r,function(t){return n.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(n=e.sent(),this.Ga)for(r=0,i=n;r<i.length;r++)o=i[r],this.Ga.removeItem(this.lh(o.clientId));e.label=2;case 2:return[2]}})})},t.prototype.Ya=function(){var t=this;this.qa=this.fn.Vn(\"client_metadata_refresh\",4e3,function(){return t.za().then(function(){return t.ah()}).then(function(){return t.Ya()})})},t.prototype.rh=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.nh=function(t){var e=this;return this.Oa?$n.resolve(!0):Qi(t).get(Ii.key).next(function(n){if(null!==n&&e.hh(n.leaseTimestampMs,5e3)&&!e._h(n.ownerId)){if(e.rh(n)&&e.networkEnabled)return!0;if(!e.rh(n)){if(!n.allowTabSynchronization)throw new h(c.FAILED_PRECONDITION,zi);return!1}}return!(!e.networkEnabled||!e.inForeground)||Hi(t).ts().next(function(t){return void 0===e.uh(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&p(\"IndexedDbPersistence\",\"Client \"+(t?\"is\":\"is not\")+\" eligible for a primary lease.\"),t})},t.prototype.Di=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.$a=!1,this.fh(),this.qa&&(this.qa.cancel(),this.qa=null),this.dh(),this.wh(),[4,this.Wa.runTransaction(\"shutdown\",\"readwrite\",[Ii.store,Ci.store],function(e){var n=new Ki(e,Ir.ai);return t.sh(n).next(function(){return t.oh(n)})})];case 1:return e.sent(),this.Wa.close(),this.Eh(),[2]}})})},t.prototype.uh=function(t,e){var n=this;return t.filter(function(t){return n.hh(t.updateTimeMs,e)&&!n._h(t.clientId)})},t.prototype.pi=function(){var t=this;return this.runTransaction(\"getActiveClients\",\"readonly\",function(e){return Hi(e).ts().next(function(e){return t.uh(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,\"Ii\",{get:function(){return this.$a},enumerable:!1,configurable:!0}),t.prototype.Th=function(t){return si.Fo(t,this.serializer,this.Dr,this.No)},t.prototype.Ih=function(){return this.ja},t.prototype.mh=function(){return this.vr},t.prototype.Ah=function(){return this.Dr},t.prototype.runTransaction=function(t,e,n){var r=this;p(\"IndexedDbPersistence\",\"Starting transaction:\",t);var i,o=\"readonly\"===e?\"readonly\":\"readwrite\";return this.Wa.runTransaction(t,o,Ri,function(o){return i=new Ki(o,r.Ma?r.Ma.next():Ir.ai),\"readwrite-primary\"===e?r.eh(i).next(function(t){return!!t||r.nh(i)}).next(function(e){if(!e)throw d(\"Failed to obtain primary lease for action '\"+t+\"'.\"),r.isPrimary=!1,r.fn.Cs(function(){return r.Ka(!1)}),new h(c.FAILED_PRECONDITION,Rr);return n(i)}).next(function(t){return r.ih(i).next(function(){return t})}):r.Rh(i).next(function(){return n(i)})}).then(function(t){return i.br(),t})},t.prototype.Rh=function(t){var e=this;return Qi(t).get(Ii.key).next(function(t){if(null!==t&&e.hh(t.leaseTimestampMs,5e3)&&!e._h(t.ownerId)&&!e.rh(t)&&!(e.Oa||e.allowTabSynchronization&&t.allowTabSynchronization))throw new h(c.FAILED_PRECONDITION,zi)})},t.prototype.ih=function(t){var e=new Ii(this.clientId,this.allowTabSynchronization,Date.now());return Qi(t).put(Ii.key,e)},t.Ln=function(){return Zn.Ln()},t.prototype.sh=function(t){var e=this,n=Qi(t);return n.get(Ii.key).next(function(t){return e.rh(t)?(p(\"IndexedDbPersistence\",\"Releasing primary lease.\"),n.delete(Ii.key)):$n.resolve()})},t.prototype.hh=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(d(\"Detected an update time that is in the future: \"+t+\" > \"+n),1))},t.prototype.Ha=function(){var t=this;null!==this.document&&\"function\"==typeof this.document.addEventListener&&(this.Ba=function(){t.fn.ws(function(){return t.inForeground=\"visible\"===t.document.visibilityState,t.za()})},this.document.addEventListener(\"visibilitychange\",this.Ba),this.inForeground=\"visible\"===this.document.visibilityState)},t.prototype.dh=function(){this.Ba&&(this.document.removeEventListener(\"visibilitychange\",this.Ba),this.Ba=null)},t.prototype.Ja=function(){var t,e=this;\"function\"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.La=function(){e.fh(),e.fn.ws(function(){return e.Di()})},this.window.addEventListener(\"unload\",this.La))},t.prototype.wh=function(){this.La&&(this.window.removeEventListener(\"unload\",this.La),this.La=null)},t.prototype._h=function(t){var e;try{var n=null!==(null===(e=this.Ga)||void 0===e?void 0:e.getItem(this.lh(t)));return p(\"IndexedDbPersistence\",\"Client '\"+t+\"' \"+(n?\"is\":\"is not\")+\" zombied in LocalStorage\"),n}catch(t){return d(\"IndexedDbPersistence\",\"Failed to get zombied client id.\",t),!1}},t.prototype.fh=function(){if(this.Ga)try{this.Ga.setItem(this.lh(this.clientId),String(Date.now()))}catch(t){d(\"Failed to set zombie client id.\",t)}},t.prototype.Eh=function(){if(this.Ga)try{this.Ga.removeItem(this.lh(this.clientId))}catch(t){}},t.prototype.lh=function(t){return\"firestore_zombie_\"+this.persistenceKey+\"_\"+t},t}();function Qi(t){return Wi.Kn(t,Ii.store)}function Hi(t){return Wi.Kn(t,Ci.store)}var Yi=function(){function t(t,e){this.db=t,this.wo=new Kr(this,e)}return t.prototype.Po=function(t){var e=this.Ph(t);return this.db.Ih().ba(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.Ph=function(t){var e=0;return this.yo(t,function(t){e++}).next(function(){return e})},t.prototype.Ce=function(t,e){return this.db.Ih().Ce(t,e)},t.prototype.yo=function(t,e){return this.gh(t,function(t,n){return e(n)})},t.prototype.Da=function(t,e,n){return Xi(t,n)},t.prototype.Na=function(t,e,n){return Xi(t,n)},t.prototype.po=function(t,e,n){return this.db.Ih().po(t,e,n)},t.prototype.Go=function(t,e){return Xi(t,e)},t.prototype.Vh=function(t,e){return function(t,e){var n=!1;return fi(t).os(function(r){return ui(t,r,e).next(function(t){return t&&(n=!0),$n.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.bo=function(t,e){var n=this,r=this.db.mh().ra(),i=[],o=0;return this.gh(t,function(s,u){if(u<=e){var a=n.Vh(t,s).next(function(e){if(!e)return o++,r.Rr(t,s).next(function(){return r.Ar(s),Bi(t).delete([0,Wr(s.path)])})});i.push(a)}}).next(function(){return $n.kn(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.st(t.Fa);return this.db.Ih().Va(t,n)},t.prototype.yh=function(t,e){return Xi(t,e)},t.prototype.gh=function(t,e){var n,r=Bi(t),i=Ir.ai;return r.rs({index:Pi.documentTargetsIndex},function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Ir.ai&&e(new G(Yr(n)),i),i=u,n=s):i=Ir.ai}).next(function(){i!==Ir.ai&&e(new G(Yr(n)),i)})},t.prototype.So=function(t){return this.db.mh().aa(t)},t}();function Xi(t,e){return Bi(t).put(function(t,e){return new Pi(0,Wr(t.path),e)}(e,t.Fa))}function Ji(t,e){var n=t.projectId;return t.I||(n+=\".\"+t.database),\"firestore/\"+e+\"/\"+n+\"/\"}var $i=function(){function t(t,e,n){this.persistence=t,this.ph=e,this.bh=new rt(I),this.Sh=new C(function(t){return H(t)},Y),this.Dh=U.min(),this.Sr=t.Th(n),this.Ch=t.mh(),this.ja=t.Ih(),this.Nh=new Mr(this.Ch,this.Sr,this.persistence.Ah()),this.ph.xh(this.Nh)}return t.prototype.mo=function(t){var e=this;return this.persistence.runTransaction(\"Collect garbage\",\"readwrite-primary\",function(n){return t.vo(n,e.bh)})},t}();function Zi(t,e){var n=w(t);return n.persistence.runTransaction(\"Acknowledge batch\",\"readwrite-primary\",function(t){var r=e.batch.keys(),i=n.Ch.ra({oa:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=$n.resolve();return o.forEach(function(t){s=s.next(function(){return r.Rr(e,t)}).next(function(e){var o=e,s=n.dr.get(t);m(null!==s),(!o||o.version.h(s)<0)&&(o=i.hr(t,o,n))&&r.Ir(o,n._r)})}),s.next(function(){return t.Sr.Qo(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n.Sr.zo(t)}).next(function(){return n.Nh.Or(t,r)})})}function to(t){var e=w(t);return e.persistence.runTransaction(\"Get last remote snapshot version\",\"readonly\",function(t){return e.ja.Ia(t)})}function eo(t,e){var n=w(t),r=e.nt,i=n.bh;return n.persistence.runTransaction(\"Apply remote event\",\"readwrite-primary\",function(t){var o=n.Ch.ra({oa:!0});i=n.bh;var s=[];e.zt.forEach(function(e,o){var u=i.get(o);if(u){s.push(n.ja.Ca(t,e.se,o).next(function(){return n.ja.Sa(t,e.ee,o)}));var a=e.resumeToken;if(a.o()>0){var c=u.it(a,r).st(t.Fa);i=i.ot(o,c),function(t,e,n){return m(e.resumeToken.o()>0),0===t.resumeToken.o()||e.nt.p()-t.nt.p()>=3e8||n.ee.size+n.ne.size+n.se.size>0}(u,c,e)&&s.push(n.ja.Va(t,c))}}});var u=ct(),a=vt();if(e.Jt.forEach(function(t,e){a=a.add(t)}),s.push(o.getEntries(t,a).next(function(i){e.Jt.forEach(function(a,c){var h=i.get(a);c instanceof dn&&c.version.isEqual(U.min())?(o.Ar(a,r),u=u.ot(a,c)):null==h||c.version.h(h.version)>0||0===c.version.h(h.version)&&h.hasPendingWrites?(o.Ir(c,r),u=u.ot(a,c)):p(\"LocalStore\",\"Ignoring outdated watch update for \",a,\". Current version:\",h.version,\" Watch version:\",c.version),e.Yt.has(a)&&s.push(n.persistence.No.yh(t,a))})})),!r.isEqual(U.min())){var c=n.ja.Ia(t).next(function(e){return n.ja.Aa(t,t.Fa,r)});s.push(c)}return $n.kn(s).next(function(){return o.apply(t)}).next(function(){return n.Nh.Mr(t,u)})}).then(function(t){return n.bh=i,t})}function no(t,e){var n=w(t);return n.persistence.runTransaction(\"Get next mutation batch\",\"readonly\",function(t){return void 0===e&&(e=-1),n.Sr.Bo(t,e)})}function ro(t,e){var n=w(t);return n.persistence.runTransaction(\"Allocate target\",\"readwrite\",function(t){var r;return n.ja.va(t,e).next(function(i){return i?(r=i,$n.resolve(r)):n.ja.wa(t).next(function(i){return r=new Z(e,i,0,t.Fa),n.ja.Ra(t,r).next(function(){return r})})})}).then(function(t){var r=n.bh.get(t.targetId);return(null===r||t.nt.h(r.nt)>0)&&(n.bh=n.bh.ot(t.targetId,t),n.Sh.set(e,t.targetId)),t})}function io(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=w(t),o=i.bh.get(n),s=r?\"readwrite\":\"readwrite-primary\",e.label=1;case 1:return e.trys.push([1,4,,5]),r?[3,3]:[4,i.persistence.runTransaction(\"Release target\",s,function(t){return i.persistence.No.removeTarget(t,o)})];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!nr(u=e.sent()))throw u;return p(\"LocalStore\",\"Failed to update sequence numbers for target \"+n+\": \"+u),[3,5];case 5:return i.bh=i.bh.remove(n),i.Sh.delete(o.target),[2]}})})}function oo(t,e,n){var r=w(t),i=U.min(),o=vt();return r.persistence.runTransaction(\"Execute query\",\"readonly\",function(t){return function(t,e,n){var r=w(t),i=r.Sh.get(n);return void 0!==i?$n.resolve(r.bh.get(i)):r.ja.va(e,n)}(r,t,Nn(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.ja.xa(t,e.targetId).next(function(t){o=t})}).next(function(){return r.ph.Lr(t,e,n?i:U.min(),n?o:vt())}).next(function(t){return{documents:t,Fh:o}})})}function so(t,e){var n=w(t),r=w(n.ja),i=n.bh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction(\"Get target data\",\"readonly\",function(t){return r.Ue(t,e).next(function(t){return t?t.target:null})})}function uo(t){var e=w(t);return e.persistence.runTransaction(\"Get new document changes\",\"readonly\",function(t){return function(t,e,n){var r=w(t),i=ct(),o=Zr(n),s=vi(e),u=IDBKeyRange.lowerBound(o,!0);return s.rs({index:Si.readTimeIndex,range:u},function(t,e){var n=Jr(r.serializer,e);i=i.ot(n.key,n),o=e.readTime}).next(function(){return{kh:i,readTime:ti(o)}})}(e.Ch,t,e.Dh)}).then(function(t){var n=t.kh,r=t.readTime;return e.Dh=r,n})}function ao(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){return[2,(n=w(t)).persistence.runTransaction(\"Synchronize last document change read time\",\"readonly\",function(t){return function(t){var e=vi(t),n=U.min();return e.rs({index:Si.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=ti(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){n.Dh=t})]})})}function co(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){if(t.code!==c.FAILED_PRECONDITION||t.message!==Rr)throw t;return p(\"LocalStore\",\"Unexpectedly lost primary lease\"),[2]})})}var ho=function(){function t(){this.Oh=new st(fo.Mh),this.$h=new st(fo.Lh)}return t.prototype.P=function(){return this.Oh.P()},t.prototype.Da=function(t,e){var n=new fo(t,e);this.Oh=this.Oh.add(n),this.$h=this.$h.add(n)},t.prototype.Bh=function(t,e){var n=this;t.forEach(function(t){return n.Da(t,e)})},t.prototype.Na=function(t,e){this.qh(new fo(t,e))},t.prototype.Uh=function(t,e){var n=this;t.forEach(function(t){return n.Na(t,e)})},t.prototype.Kh=function(t){var e=this,n=new G(new q([])),r=new fo(n,t),i=new fo(n,t+1),o=[];return this.$h.xt([r,i],function(t){e.qh(t),o.push(t.key)}),o},t.prototype.Qh=function(){var t=this;this.Oh.forEach(function(e){return t.qh(e)})},t.prototype.qh=function(t){this.Oh=this.Oh.delete(t),this.$h=this.$h.delete(t)},t.prototype.Wh=function(t){var e=new G(new q([])),n=new fo(e,t),r=new fo(e,t+1),i=vt();return this.$h.xt([n,r],function(t){i=i.add(t.key)}),i},t.prototype.Ho=function(t){var e=new fo(t,0),n=this.Oh.kt(e);return null!==n&&t.isEqual(n.key)},t}(),fo=function(){function t(t,e){this.key=t,this.jh=e}return t.Mh=function(t,e){return G.D(t.key,e.key)||I(t.jh,e.jh)},t.Lh=function(t,e){return I(t.jh,e.jh)||G.D(t.key,e.key)},t}(),lo=function(t,e){this.user=e,this.type=\"OAuth\",this.Gh={},this.Gh.Authorization=\"Bearer \"+t},po=function(){function t(){this.zh=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.Hh=function(){},t.prototype.Jh=function(t){this.zh=t,t(br.UNAUTHENTICATED)},t.prototype.Yh=function(){this.zh=null},t}(),vo=function(){function t(t){var e=this;this.Xh=null,this.currentUser=br.UNAUTHENTICATED,this.Zh=!1,this.tc=0,this.zh=null,this.forceRefresh=!1,this.Xh=function(){e.tc++,e.currentUser=e.ec(),e.Zh=!0,e.zh&&e.zh(e.currentUser)},this.tc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Xh):(this.Xh(null),t.get().then(function(t){e.auth=t,e.Xh&&e.auth.addAuthTokenListener(e.Xh)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.tc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.tc!==e?(p(\"FirebaseCredentialsProvider\",\"getToken aborted due to token change.\"),t.getToken()):n?(m(\"string\"==typeof n.accessToken),new lo(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.Hh=function(){this.forceRefresh=!0},t.prototype.Jh=function(t){this.zh=t,this.Zh&&t(this.currentUser)},t.prototype.Yh=function(){this.auth&&this.auth.removeAuthTokenListener(this.Xh),this.Xh=null,this.zh=null},t.prototype.ec=function(){var t=this.auth&&this.auth.getUid();return m(null===t||\"string\"==typeof t),new br(t)},t}(),yo=function(){function t(t,e){this.nc=t,this.sc=e,this.type=\"FirstParty\",this.user=br.ni}return Object.defineProperty(t.prototype,\"Gh\",{get:function(){var t={\"X-Goog-AuthUser\":this.sc},e=this.nc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),go=function(){function t(t,e){this.nc=t,this.sc=e}return t.prototype.getToken=function(){return Promise.resolve(new yo(this.nc,this.sc))},t.prototype.Jh=function(t){t(br.ni)},t.prototype.Yh=function(){},t.prototype.Hh=function(){},t}(),mo=function(){function t(t,e,n,r,i,o){this.fn=t,this.ic=n,this.rc=r,this.oc=i,this.listener=o,this.state=0,this.ac=0,this.hc=null,this.stream=null,this.Vs=new Jn(t,e)}return t.prototype.cc=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.uc=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.lc()},t.prototype.stop=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.cc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype._c=function(){this.state=0,this.Vs.reset()},t.prototype.fc=function(){var t=this;this.uc()&&null===this.hc&&(this.hc=this.fn.Vn(this.ic,6e4,function(){return t.dc()}))},t.prototype.wc=function(t){this.Ec(),this.stream.send(t)},t.prototype.dc=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return this.uc()?[2,this.close(0)]:[2]})})},t.prototype.Ec=function(){this.hc&&(this.hc.cancel(),this.hc=null)},t.prototype.close=function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.Ec(),this.Vs.cancel(),this.ac++,3!==t?this.Vs.reset():n&&n.code===c.RESOURCE_EXHAUSTED?(d(n.toString()),d(\"Using maximum backoff delay to prevent overloading the backend.\"),this.Vs.Rn()):n&&n.code===c.UNAUTHENTICATED&&this.oc.Hh(),null!==this.stream&&(this.Tc(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ic(n)];case 1:return e.sent(),[2]}})})},t.prototype.Tc=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.mc(this.ac),n=this.ac;this.oc.getToken().then(function(e){t.ac===n&&t.Ac(e)},function(n){e(function(){var e=new h(c.UNKNOWN,\"Fetching auth token failed: \"+n.message);return t.Rc(e)})})},t.prototype.Ac=function(t){var e=this,n=this.mc(this.ac);this.stream=this.Pc(t),this.stream.gc(function(){n(function(){return e.state=2,e.listener.gc()})}),this.stream.Ic(function(t){n(function(){return e.Rc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.lc=function(){var t=this;this.state=4,this.Vs.Pn(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.Rc=function(t){return p(\"PersistentStream\",\"close with error: \"+t),this.stream=null,this.close(3,t)},t.prototype.mc=function(t){var e=this;return function(n){e.fn.ws(function(){return e.ac===t?n():(p(\"PersistentStream\",\"stream callback skipped by getCloseGuardedDispatcher.\"),Promise.resolve())})}},t}(),wo=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,\"listen_stream_connection_backoff\",\"listen_stream_idle\",n,r,o)||this).serializer=i,s}return(0,e.__extends)(n,t),n.prototype.Pc=function(t){return this.rc.Vc(\"Listen\",t)},n.prototype.onMessage=function(t){this.Vs.reset();var e=function(t,e){var n;if(\"targetChange\"in e){e.targetChange;var r=function(t){return\"NO_CHANGE\"===t?0:\"ADD\"===t?1:\"REMOVE\"===t?2:\"CURRENT\"===t?3:\"RESET\"===t?4:g()}(e.targetChange.targetChangeType||\"NO_CHANGE\"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Ke?(m(void 0===e||\"string\"==typeof e),N.fromBase64String(e||\"\")):(m(void 0===e||e instanceof Uint8Array),N.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?c.UNKNOWN:nt(t.code);return new h(e,t.message||\"\")}(s);n=new Nt(r,i,o,u||null)}else if(\"documentChange\"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var f=ce(t,a.document.name),l=oe(a.document.updateTime),p=new cn({mapValue:{fields:a.document.fields}}),d=new pn(f,l,p,{}),v=a.targetIds||[],y=a.removedTargetIds||[];n=new Et(v,y,d.key,d)}else if(\"documentDelete\"in e){e.documentDelete;var w=e.documentDelete;w.document;var _=ce(t,w.document),b=w.readTime?oe(w.readTime):U.min(),I=new dn(_,b),E=w.removedTargetIds||[];n=new Et([],E,I.key,I)}else if(\"documentRemove\"in e){e.documentRemove;var T=e.documentRemove;T.document;var A=ce(t,T.document),D=T.removedTargetIds||[];n=new Et([],D,A,null)}else{if(!(\"filter\"in e))return g();e.filter;var S=e.filter;S.targetId;var x=S.count||0,k=new tt(x),P=S.targetId;n=new Tt(P,k)}return n}(this.serializer,t),n=function(t){if(!(\"targetChange\"in t))return U.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?U.min():e.readTime?oe(e.readTime):U.min()}(t);return this.listener.yc(e,n)},n.prototype.bc=function(t){var e={};e.database=le(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=X(r)?{documents:ge(t,r)}:{query:me(t,r)}).targetId=e.targetId,e.resumeToken.o()>0&&(n.resumeToken=re(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return\"existence-filter-mismatch\";case 2:return\"limbo-document\";default:return g()}}(0,e.et);return null==n?null:{\"goog-listen-tags\":n}}(this.serializer,t);n&&(e.labels=n),this.wc(e)},n.prototype.vc=function(t){var e={};e.database=le(this.serializer),e.removeTarget=t,this.wc(e)},n}(mo),_o=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,\"write_stream_connection_backoff\",\"write_stream_idle\",n,r,o)||this).serializer=i,s.Sc=!1,s}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,\"Dc\",{get:function(){return this.Sc},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.Sc=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.Tc=function(){this.Sc&&this.Cc([])},n.prototype.Pc=function(t){return this.rc.Vc(\"Write\",t)},n.prototype.onMessage=function(t){if(m(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Sc){this.Vs.reset();var e=function(t,e){return t&&t.length>0?(m(void 0!==e),t.map(function(t){return function(t,e){var n=t.updateTime?oe(t.updateTime):oe(e);n.isEqual(U.min())&&(n=oe(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Ke(n,r)}(t,e)})):[]}(t.writeResults,t.commitTime),n=oe(t.commitTime);return this.listener.Nc(n,e)}return m(!t.writeResults||0===t.writeResults.length),this.Sc=!0,this.listener.xc()},n.prototype.Fc=function(){var t={};t.database=le(this.serializer),this.wc(t)},n.prototype.Cc=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ve(e.serializer,t)})};this.wc(n)},n}(mo),bo=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.rc=n,i.serializer=r,i.kc=!1,i}return(0,e.__extends)(n,t),n.prototype.Oc=function(){if(this.kc)throw new h(c.FAILED_PRECONDITION,\"The client has already been terminated.\")},n.prototype.Mc=function(t,e,n){var r=this;return this.Oc(),this.credentials.getToken().then(function(i){return r.rc.Mc(t,e,n,i)}).catch(function(t){throw t.code===c.UNAUTHENTICATED&&r.credentials.Hh(),t})},n.prototype.$c=function(t,e,n){var r=this;return this.Oc(),this.credentials.getToken().then(function(i){return r.rc.$c(t,e,n,i)}).catch(function(t){throw t.code===c.UNAUTHENTICATED&&r.credentials.Hh(),t})},n.prototype.terminate=function(){this.kc=!1},n}(function(){}),Io=function(){function t(t,e){this.hs=t,this.di=e,this.state=\"Unknown\",this.Lc=0,this.Bc=null,this.qc=!0}return t.prototype.Uc=function(){var t=this;0===this.Lc&&(this.Kc(\"Unknown\"),this.Bc=this.hs.Vn(\"online_state_timeout\",1e4,function(){return t.Bc=null,t.Qc(\"Backend didn't respond within 10 seconds.\"),t.Kc(\"Offline\"),Promise.resolve()}))},t.prototype.Wc=function(t){\"Online\"===this.state?this.Kc(\"Unknown\"):(this.Lc++,this.Lc>=1&&(this.jc(),this.Qc(\"Connection failed 1 times. Most recent error: \"+t.toString()),this.Kc(\"Offline\")))},t.prototype.set=function(t){this.jc(),this.Lc=0,\"Online\"===t&&(this.qc=!1),this.Kc(t)},t.prototype.Kc=function(t){t!==this.state&&(this.state=t,this.di(t))},t.prototype.Qc=function(t){var e=\"Could not reach Cloud Firestore backend. \"+t+\"\\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.\";this.qc?(d(e),this.qc=!1):p(\"OnlineStateTracker\",e)},t.prototype.jc=function(){null!==this.Bc&&(this.Bc.cancel(),this.Bc=null)},t}(),Eo=function(t,n,r,i,o){var s=this;this.Gc=t,this.zc=n,this.hs=r,this.Hc={},this.Jc=[],this.Yc=new Map,this.Xc=new Set,this.Zc=[],this.tu=o,this.tu.eu(function(t){r.ws(function(){return(0,e.__awaiter)(s,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return Oo(this)?(p(\"RemoteStore\",\"Restarting streams for network reachability change.\"),[4,function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(n=w(t)).Xc.add(4),[4,No(n)];case 1:return e.sent(),n.nu.set(\"Unknown\"),n.Xc.delete(4),[4,To(n)];case 2:return e.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.nu=new Io(r,i)};function To(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:if(!Oo(t))return[3,4];n=0,r=t.Zc,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function No(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:n=0,r=t.Zc,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}})})}function Ao(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return n=w(t),p(\"RemoteStore\",\"RemoteStore shutting down.\"),n.Xc.add(5),[4,No(n)];case 1:return e.sent(),n.tu.Di(),n.nu.set(\"Unknown\"),[2]}})})}function Do(t,e){var n=w(t);n.Yc.has(e.targetId)||(n.Yc.set(e.targetId,e),Lo(n)?Po(n):Ho(n).uc()&&xo(n,e))}function So(t,e){var n=w(t),r=Ho(n);n.Yc.delete(e),r.uc()&&ko(n,e),0===n.Yc.size&&(r.uc()?r.fc():Oo(n)&&n.nu.set(\"Unknown\"))}function xo(t,e){t.su.me(e.targetId),Ho(t).bc(e)}function ko(t,e){t.su.me(e),Ho(t).vc(e)}function Po(t){t.su=new Dt({qe:function(e){return t.Hc.qe(e)},Ue:function(e){return t.Yc.get(e)||null}}),Ho(t).start(),t.nu.Uc()}function Lo(t){return Oo(t)&&!Ho(t).cc()&&t.Yc.size>0}function Oo(t){return 0===w(t).Xc.size}function Vo(t){t.su=void 0}function Co(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return t.Yc.forEach(function(e,n){xo(t,e)}),[2]})})}function Ro(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return Vo(t),Lo(t)?(t.nu.Wc(n),Po(t)):t.nu.set(\"Unknown\"),[2]})})}function Uo(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,e.__generator)(this,function(u){switch(u.label){case 0:if(t.nu.set(\"Online\"),!(n instanceof Nt&&2===n.state&&n.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=n.cause,i=0,o=n.targetIds,e.label=1;case 1:return i<o.length?(s=o[i],t.Yc.has(s)?[4,t.Hc.iu(s,r)]:[3,3]):[3,5];case 2:e.sent(),t.Yc.delete(s),t.su.removeTarget(s),e.label=3;case 3:e.label=4;case 4:return i++,[3,1];case 5:return[2]}})})}(t,n)];case 2:return u.sent(),[3,5];case 3:return i=u.sent(),p(\"RemoteStore\",\"Failed to remove targets %s: %s \",n.targetIds.join(\",\"),i),[4,Mo(t,i)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(n instanceof Et?t.su.be(n):n instanceof Tt?t.su.ke(n):t.su.De(n),r.isEqual(U.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,to(t.Gc)];case 8:return o=u.sent(),r.h(o)>=0?[4,function(t,e){var n=t.su.$e(e);return n.zt.forEach(function(n,r){if(n.resumeToken.o()>0){var i=t.Yc.get(r);i&&t.Yc.set(r,i.it(n.resumeToken,e))}}),n.Ht.forEach(function(e){var n=t.Yc.get(e);if(n){t.Yc.set(e,n.it(N.u,n.nt)),ko(t,e);var r=new Z(n.target,e,1,n.sequenceNumber);xo(t,r)}}),t.Hc.ru(n)}(t,r)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return p(\"RemoteStore\",\"Failed to raise snapshot:\",s=u.sent()),[4,Mo(t,s)];case 12:return u.sent(),[3,13];case 13:return[2]}})})}function Mo(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i=this;return(0,e.__generator)(this,function(o){switch(o.label){case 0:if(!nr(n))throw n;return t.Xc.add(1),[4,No(t)];case 1:return o.sent(),t.nu.set(\"Offline\"),r||(r=function(){return to(t.Gc)}),t.hs.Cs(function(){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return p(\"RemoteStore\",\"Retrying IndexedDB access\"),[4,r()];case 1:return e.sent(),t.Xc.delete(1),[4,To(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function qo(t,e){return e().catch(function(n){return Mo(t,n,e)})}function Fo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:n=w(t),r=Yo(n),i=n.Jc.length>0?n.Jc[n.Jc.length-1].batchId:-1,e.label=1;case 1:if(!function(t){return Oo(t)&&t.Jc.length<10}(n))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,no(n.Gc,i)];case 3:return null===(o=e.sent())?(0===n.Jc.length&&r.fc(),[3,7]):(i=o.batchId,function(t,e){t.Jc.push(e);var n=Yo(t);n.uc()&&n.Dc&&n.Cc(e.mutations)}(n,o),[3,6]);case 4:return s=e.sent(),[4,Mo(n,s)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return jo(n)&&Go(n),[2]}})})}function jo(t){return Oo(t)&&!Yo(t).cc()&&t.Jc.length>0}function Go(t){Yo(t).start()}function Bo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){return Yo(t).Fc(),[2]})})}function zo(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r,i,o;return(0,e.__generator)(this,function(e){for(n=Yo(t),r=0,i=t.Jc;r<i.length;r++)o=i[r],n.Cc(o.mutations);return[2]})})}function Ko(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i=t.Jc.shift(),o=Vr.from(i,n,r),[4,qo(t,function(){return t.Hc.ou(o)})];case 1:return e.sent(),[4,Fo(t)];case 2:return e.sent(),[2]}})})}function Wo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(r){switch(r.label){case 0:return n&&Yo(t).Dc?[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return et(i=n.code)&&i!==c.ABORTED?(r=t.Jc.shift(),Yo(t)._c(),[4,qo(t,function(){return t.Hc.au(r.batchId,n)})]):[3,3];case 1:return e.sent(),[4,Fo(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})}(t,n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return jo(t)&&Go(t),[2]}})})}function Qo(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=w(t),n?(r.Xc.delete(2),[4,To(r)]):[3,2];case 1:return e.sent(),[3,5];case 2:return n?[3,4]:(r.Xc.add(2),[4,No(r)]);case 3:e.sent(),r.nu.set(\"Unknown\"),e.label=4;case 4:e.label=5;case 5:return[2]}})})}function Ho(t){var n=this;return t.hu||(t.hu=function(t,e,n){var r=w(t);return r.Oc(),new wo(e,r.rc,r.credentials,r.serializer,n)}(t.zc,t.hs,{gc:Co.bind(null,t),Ic:Ro.bind(null,t),yc:Uo.bind(null,t)}),t.Zc.push(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r?(t.hu._c(),Lo(t)?Po(t):t.nu.set(\"Unknown\"),[3,3]):[3,1];case 1:return[4,t.hu.stop()];case 2:e.sent(),Vo(t),e.label=3;case 3:return[2]}})})})),t.hu}function Yo(t){var n=this;return t.cu||(t.cu=function(t,e,n){var r=w(t);return r.Oc(),new _o(e,r.rc,r.credentials,r.serializer,n)}(t.zc,t.hs,{gc:Bo.bind(null,t),Ic:Wo.bind(null,t),xc:zo.bind(null,t),Nc:Ko.bind(null,t)}),t.Zc.push(function(r){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r?(t.cu._c(),[4,Fo(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.cu.stop()];case 3:e.sent(),t.Jc.length>0&&(p(\"RemoteStore\",\"Stopping write stream with \"+t.Jc.length+\" pending writes\"),t.Jc=[]),e.label=4;case 4:return[2]}})})})),t.cu}var Xo=function(t){this.key=t},Jo=function(t){this.key=t},$o=function(){function t(t,e){this.query=t,this.uu=e,this.lu=null,this.te=!1,this._u=vt(),this.Qt=vt(),this.fu=On(t),this.du=new mt(this.fu)}return Object.defineProperty(t.prototype,\"wu\",{get:function(){return this.uu},enumerable:!1,configurable:!0}),t.prototype.Eu=function(t,e){var n=this,r=e?e.Tu:new wt,i=e?e.du:this.du,o=e?e.Qt:this.Qt,s=i,u=!1,a=wn(this.query)&&i.size===this.query.limit?i.last():null,c=_n(this.query)&&i.size===this.query.limit?i.first():null;if(t.ut(function(t,e){var h=i.get(t),f=e instanceof pn?e:null;f&&(f=Ln(n.query,f)?f:null);var l=!!h&&n.Qt.has(h.key),p=!!f&&(f.Ye||n.Qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Iu(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.fu(f,a)>0||c&&n.fu(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),wn(this.query)||_n(this.query))for(;s.size>this.query.limit;){var h=wn(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{du:s,Tu:r,mu:u,Qt:o}},t.prototype.Iu=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},t.prototype.Vr=function(t,e,n){var r=this,i=this.du;this.du=t.du,this.Qt=t.Qt;var o=t.Tu.Ut();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return g()}};return n(t)-n(e)}(t.type,e.type)||r.fu(t.doc,e.doc)}),this.Au(n);var s=e?this.Ru():[],u=0===this._u.size&&this.te?1:0,a=u!==this.lu;return this.lu=u,0!==o.length||a?{snapshot:new _t(this.query,t.du,i,o,t.Qt,0===u,a,!1),Pu:s}:{Pu:s}},t.prototype.Ks=function(t){return this.te&&\"Offline\"===t?(this.te=!1,this.Vr({du:this.du,Tu:new wt,Qt:this.Qt,mu:!1},!1)):{Pu:[]}},t.prototype.gu=function(t){return!this.uu.has(t)&&!!this.du.has(t)&&!this.du.get(t).Ye},t.prototype.Au=function(t){var e=this;t&&(t.ee.forEach(function(t){return e.uu=e.uu.add(t)}),t.ne.forEach(function(t){}),t.se.forEach(function(t){return e.uu=e.uu.delete(t)}),this.te=t.te)},t.prototype.Ru=function(){var t=this;if(!this.te)return[];var e=this._u;this._u=vt(),this.du.forEach(function(e){t.gu(e.key)&&(t._u=t._u.add(e.key))});var n=[];return e.forEach(function(e){t._u.has(e)||n.push(new Jo(e))}),this._u.forEach(function(t){e.has(t)||n.push(new Xo(t))}),n},t.prototype.Vu=function(t){this.uu=t.Fh,this._u=vt();var e=this.Eu(t.documents);return this.Vr(e,!0)},t.prototype.yu=function(){return _t.Gt(this.query,this.du,this.Qt,0===this.lu)},t}(),Zo=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ts=function(t){this.key=t,this.pu=!1},es=function(){function t(t,e,n,r,i,o){this.Gc=t,this.bu=e,this.vu=n,this.Su=r,this.currentUser=i,this.Du=o,this.Cu={},this.Nu=new C(function(t){return kn(t)},xn),this.xu=new Map,this.Fu=[],this.ku=new rt(G.D),this.Ou=new Map,this.Mu=new ho,this.$u={},this.Lu=new Map,this.Bu=qi.da(),this.onlineState=\"Unknown\",this.qu=void 0}return Object.defineProperty(t.prototype,\"Uu\",{get:function(){return!0===this.qu},enumerable:!1,configurable:!0}),t}();function ns(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=Ss(t),(s=r.Nu.get(n))?(i=s.targetId,r.Su.$i(i),o=s.view.yu(),[3,4]):[3,1];case 1:return[4,ro(r.Gc,Nn(n))];case 2:return u=e.sent(),a=r.Su.$i(u.targetId),i=u.targetId,[4,rs(r,n,i,\"current\"===a)];case 3:o=e.sent(),r.Uu&&Do(r.bu,u),e.label=4;case 4:return[2,o]}})})}function rs(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,u,a,c,h;return(0,e.__generator)(this,function(f){switch(f.label){case 0:return t.Ku=function(n,r,i){return function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(o=n.view.Eu(r)).mu?[4,oo(t.Gc,n.query,!1).then(function(t){var e=t.documents;return n.view.Eu(e,o)})]:[3,2];case 1:o=e.sent(),e.label=2;case 2:return s=i&&i.zt.get(n.targetId),u=n.view.Vr(o,t.Uu,s),[2,(ds(t,n.targetId,u.Pu),u.snapshot)]}})})}(t,n,r,i)},[4,oo(t.Gc,n,!0)];case 1:return o=f.sent(),s=new $o(n,o.Fh),u=s.Eu(o.documents),a=It.Zt(r,i&&\"Offline\"!==t.onlineState),c=s.Vr(u,t.Uu,a),ds(t,r,c.Pu),h=new Zo(n,r,s),[2,(t.Nu.set(n,h),t.xu.has(r)?t.xu.get(r).push(n):t.xu.set(r,[n]),c.snapshot)]}})})}function is(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=w(t),i=r.Nu.get(n),(o=r.xu.get(i.targetId)).length>1?[2,(r.xu.set(i.targetId,o.filter(function(t){return!xn(t,n)})),void r.Nu.delete(n))]:r.Uu?(r.Su.Bi(i.targetId),r.Su.xi(i.targetId)?[3,2]:[4,io(r.Gc,i.targetId,!1).then(function(){r.Su.Ui(i.targetId),So(r.bu,i.targetId),ls(r,i.targetId)}).catch(co)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return ls(r,i.targetId),[4,io(r.Gc,i.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}})})}function os(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=w(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,eo(r.Gc,n)];case 2:return i=e.sent(),n.zt.forEach(function(t,e){var n=r.Ou.get(e);n&&(m(t.ee.size+t.ne.size+t.se.size<=1),t.ee.size>0?n.pu=!0:t.ne.size>0?m(n.pu):t.se.size>0&&(m(n.pu),n.pu=!1))}),[4,gs(r,i,n)];case 3:return e.sent(),[3,6];case 4:return[4,co(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function ss(t,e,n){var r=w(t);if(r.Uu&&0===n||!r.Uu&&1===n){var i=[];r.Nu.forEach(function(t,n){var r=n.view.Ks(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=w(t);n.onlineState=e;var r=!1;n.Bs.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Ks(e)&&(r=!0)}),r&&wr(n)}(r.vu,e),i.length&&r.Cu.yc(i),r.onlineState=e,r.Uu&&r.Su.ji(e)}}function us(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,u,a,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(i=w(t)).Su.Ki(n,\"rejected\",r),o=i.Ou.get(n),(s=o&&o.key)?(u=(u=new rt(G.D)).ot(s,new dn(s,U.min())),a=vt().add(s),c=new bt(U.min(),new Map,new st(I),u,a),[4,os(i,c)]):[3,2];case 1:return e.sent(),i.ku=i.ku.remove(s),i.Ou.delete(n),ys(i),[3,4];case 2:return[4,io(i.Gc,n,!1).then(function(){return ls(i,n,r)}).catch(co)];case 3:e.sent(),e.label=4;case 4:return[2]}})})}function as(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=w(t),i=n.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Zi(r.Gc,n)];case 2:return o=e.sent(),fs(r,i,null),hs(r,i),r.Su.Oi(i,\"acknowledged\"),[4,gs(r,o)];case 3:return e.sent(),[3,6];case 4:return[4,co(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function cs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=w(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,function(t,e){var n=w(t);return n.persistence.runTransaction(\"Reject batch\",\"readwrite-primary\",function(t){var r;return n.Sr.$o(t,e).next(function(e){return m(null!==e),r=e.keys(),n.Sr.Qo(t,e)}).next(function(){return n.Sr.zo(t)}).next(function(){return n.Nh.Or(t,r)})})}(i.Gc,n)];case 2:return o=e.sent(),fs(i,n,r),hs(i,n),i.Su.Oi(n,\"rejected\",r),[4,gs(i,o)];case 3:return e.sent(),[3,6];case 4:return[4,co(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}})})}function hs(t,e){(t.Lu.get(e)||[]).forEach(function(t){t.resolve()}),t.Lu.delete(e)}function fs(t,e,n){var r=w(t),i=r.$u[r.currentUser.ti()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.$u[r.currentUser.ti()]=i}}function ls(t,e,n){void 0===n&&(n=null),t.Su.Bi(e);for(var r=0,i=t.xu.get(e);r<i.length;r++){var o=i[r];t.Nu.delete(o),n&&t.Cu.Qu(o,n)}t.xu.delete(e),t.Uu&&t.Mu.Kh(e).forEach(function(e){t.Mu.Ho(e)||ps(t,e)})}function ps(t,e){var n=t.ku.get(e);null!==n&&(So(t.bu,n),t.ku=t.ku.remove(e),t.Ou.delete(n),ys(t))}function ds(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Xo?(t.Mu.Da(o.key,e),vs(t,o)):o instanceof Jo?(p(\"SyncEngine\",\"Document no longer in limbo: \"+o.key),t.Mu.Na(o.key,e),t.Mu.Ho(o.key)||ps(t,o.key)):g()}}function vs(t,e){var n=e.key;t.ku.get(n)||(p(\"SyncEngine\",\"New document in limbo: \"+n),t.Fu.push(n),ys(t))}function ys(t){for(;t.Fu.length>0&&t.ku.size<t.Du;){var e=t.Fu.shift(),n=t.Bu.next();t.Ou.set(n,new ts(e)),t.ku=t.ku.ot(e,n),Do(t.bu,new Z(Nn(mn(e.path)),n,2,Ir.ai))}}function gs(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,u;return(0,e.__generator)(this,function(a){switch(a.label){case 0:return i=w(t),o=[],s=[],u=[],i.Nu.P()?[3,3]:(i.Nu.forEach(function(t,e){u.push(i.Ku(e,n,r).then(function(t){if(t){i.Uu&&i.Su.Ki(e.targetId,t.fromCache?\"not-current\":\"current\"),o.push(t);var n=qr.zr(e.targetId,t);s.push(n)}}))}),[4,Promise.all(u)]);case 1:return a.sent(),i.Cu.yc(o),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,f;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=w(t),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction(\"notifyLocalViewChanges\",\"readwrite\",function(t){return $n.forEach(n,function(e){return $n.forEach(e.jr,function(n){return r.persistence.No.Da(t,e.targetId,n)}).next(function(){return $n.forEach(e.Gr,function(n){return r.persistence.No.Na(t,e.targetId,n)})})})})];case 2:return e.sent(),[3,4];case 3:if(!nr(i=e.sent()))throw i;return p(\"LocalStore\",\"Failed to update sequence numbers: \"+i),[3,4];case 4:for(o=0,s=n;o<s.length;o++)u=s[o],a=u.targetId,u.fromCache||(c=r.bh.get(a),h=c.nt,f=c.rt(h),r.bh=r.bh.ot(a,f));return[2]}})})}(i.Gc,s)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function ms(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return(r=w(t)).currentUser.isEqual(n)?[3,3]:(p(\"SyncEngine\",\"User change. New user:\",n.ti()),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=w(t),i=r.Sr,o=r.Nh,[4,r.persistence.runTransaction(\"Handle user change\",\"readonly\",function(t){var e;return r.Sr.Uo(t).next(function(s){return e=s,i=r.persistence.Th(n),o=new Mr(r.Ch,i,r.persistence.Ah()),i.Uo(t)}).next(function(n){for(var r=[],i=[],s=vt(),u=0,a=e;u<a.length;u++){var c=a[u];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=n;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return o.Or(t,s).next(function(t){return{Wu:t,ju:r,Gu:i}})})})];case 1:return s=e.sent(),[2,(r.Sr=i,r.Nh=o,r.ph.xh(r.Nh),s)]}})})}(r.Gc,n)]);case 1:return i=o.sent(),r.currentUser=n,function(t,e){t.Lu.forEach(function(t){t.forEach(function(t){t.reject(new h(c.CANCELLED,\"'waitForPendingWrites' promise is rejected due to a user change.\"))})}),t.Lu.clear()}(r),r.Su.Wi(n,i.ju,i.Gu),[4,gs(r,i.Wu)];case 2:o.sent(),o.label=3;case 3:return[2]}})})}function ws(t,e){var n=w(t),r=n.Ou.get(e);if(r&&r.pu)return vt().add(r.key);var i=vt(),o=n.xu.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Nu.get(a);i=i.Ot(c.view.wu)}return i}function _s(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,oo((r=w(t)).Gc,n.query,!0)];case 1:return i=e.sent(),o=n.view.Vu(i),[2,(r.Uu&&ds(r,n.targetId,o.Pu),o)]}})})}function bs(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,function(t,e){var n=w(t),r=w(n.Sr);return n.persistence.runTransaction(\"Lookup mutation documents\",\"readonly\",function(t){return r.Lo(t,e).next(function(e){return e?n.Nh.Or(t,e):$n.resolve(null)})})}((o=w(t)).Gc,n)];case 1:return null===(s=e.sent())?[3,6]:\"pending\"!==r?[3,3]:[4,Fo(o.bu)];case 2:return e.sent(),[3,4];case 3:\"acknowledged\"===r||\"rejected\"===r?(fs(o,n,i||null),hs(o,n),function(t,e){w(w(t).Sr).jo(e)}(o.Gc,n)):g(),e.label=4;case 4:return[4,gs(o,s)];case 5:return e.sent(),[3,7];case 6:p(\"SyncEngine\",\"Cannot apply mutation batch with id: \"+n),e.label=7;case 7:return[2]}})})}function Is(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return Ss(r=w(t)),xs(r),!0!==n||!0===r.qu?[3,3]:(i=r.Su.Ci(),[4,Es(r,i.L())]);case 1:return o=e.sent(),r.qu=!0,[4,Qo(r.bu,!0)];case 2:for(e.sent(),s=0,u=o;s<u.length;s++)a=u[s],Do(r.bu,a);return[3,7];case 3:return!1!==n||!1===r.qu?[3,7]:(c=[],h=Promise.resolve(),r.xu.forEach(function(t,e){r.Su.qi(e)?c.push(e):h=h.then(function(){return ls(r,e),io(r.Gc,e,!0)}),So(r.bu,e)}),[4,h]);case 4:return e.sent(),[4,Es(r,c)];case 5:return e.sent(),function(t){var e=w(t);e.Ou.forEach(function(t,n){So(e.bu,n)}),e.Mu.Qh(),e.Ou=new Map,e.ku=new rt(G.D)}(r),r.qu=!1,[4,Qo(r.bu,!1)];case 6:e.sent(),e.label=7;case 7:return[2]}})})}function Es(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,f,l,p,d,v,y;return(0,e.__generator)(this,function(e){switch(e.label){case 0:r=w(t),i=[],o=[],s=0,u=n,e.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=r.xu.get(a))&&0!==h.length?[4,ro(r.Gc,Nn(h[0]))]:[3,7]):[3,13];case 2:c=e.sent(),f=0,l=h,e.label=3;case 3:return f<l.length?(p=l[f],d=r.Nu.get(p),[4,_s(r,d)]):[3,6];case 4:(v=e.sent()).snapshot&&o.push(v.snapshot),e.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,so(r.Gc,a)];case 8:return y=e.sent(),[4,ro(r.Gc,y)];case 9:return c=e.sent(),[4,rs(r,Ts(y),a,!1)];case 10:e.sent(),e.label=11;case 11:i.push(c),e.label=12;case 12:return s++,[3,1];case 13:return[2,(r.Cu.yc(o),i)]}})})}function Ts(t){return gn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,\"F\",t.startAt,t.endAt)}function Ns(t){var e=w(t);return w(w(e.Gc).persistence).pi()}function As(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(o=w(t)).qu?(p(\"SyncEngine\",\"Ignoring unexpected query state notification.\"),[3,8]):[3,1];case 1:if(!o.xu.has(n))return[3,8];switch(r){case\"current\":case\"not-current\":return[3,2];case\"rejected\":return[3,5]}return[3,7];case 2:return[4,uo(o.Gc)];case 3:return s=e.sent(),u=bt.Xt(n,\"current\"===r),[4,gs(o,s,u)];case 4:return e.sent(),[3,8];case 5:return[4,io(o.Gc,n,!0)];case 6:return e.sent(),ls(o,n,i),[3,8];case 7:g(),e.label=8;case 8:return[2]}})})}function Ds(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,u,a,c,h,f,l,d;return(0,e.__generator)(this,function(v){switch(v.label){case 0:if(!(i=Ss(t)).qu)return[3,10];o=0,s=n,v.label=1;case 1:return o<s.length?(u=s[o],i.xu.has(u)?(p(\"SyncEngine\",\"Adding an already active target \"+u),[3,5]):[4,so(i.Gc,u)]):[3,6];case 2:return a=v.sent(),[4,ro(i.Gc,a)];case 3:return c=v.sent(),[4,rs(i,Ts(a),c.targetId,!1)];case 4:v.sent(),Do(i.bu,c),v.label=5;case 5:return o++,[3,1];case 6:h=function(t){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return i.xu.has(t)?[4,io(i.Gc,t,!1).then(function(){So(i.bu,t),ls(i,t)}).catch(co)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},f=0,l=r,v.label=7;case 7:return f<l.length?(d=l[f],[5,h(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return f++,[3,7];case 10:return[2]}})})}function Ss(t){var e=w(t);return e.bu.Hc.ru=os.bind(null,e),e.bu.Hc.qe=ws.bind(null,e),e.bu.Hc.iu=us.bind(null,e),e.Cu.yc=gr.bind(null,e.vu),e.Cu.Qu=mr.bind(null,e.vu),e}function xs(t){var e=w(t);return e.bu.Hc.ou=as.bind(null,e),e.bu.Hc.au=cs.bind(null,e),e}var ks=function(){function t(){}return t.prototype.xh=function(t){this.zu=t},t.prototype.Lr=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.on.length||1===t.on.length&&t.on[0].field.W())}(e)||n.isEqual(U.min())?this.Hu(t,e):this.zu.Or(t,i).next(function(s){var u=o.Ju(e,s);return(wn(e)||_n(e))&&o.mu(e.an,u,i,n)?o.Hu(t,e):(l()<=r.LogLevel.DEBUG&&p(\"IndexFreeQueryEngine\",\"Re-using previous result from %s to execute query: %s\",n.toString(),Pn(e)),o.zu.Lr(t,e,n).next(function(t){return u.forEach(function(e){t=t.ot(e.key,e)}),t}))})},t.prototype.Ju=function(t,e){var n=new st(On(t));return e.forEach(function(e,r){r instanceof pn&&Ln(t,r)&&(n=n.add(r))}),n},t.prototype.mu=function(t,e,n,r){if(n.size!==e.size)return!0;var i=\"F\"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.h(r)>0)},t.prototype.Hu=function(t,e){return l()<=r.LogLevel.DEBUG&&p(\"IndexFreeQueryEngine\",\"Using full collection scan to execute query:\",Pn(e)),this.zu.Lr(t,e,U.min())},t}(),Ps=function(){function t(t,e){this.Dr=t,this.No=e,this.Sr=[],this.Yu=1,this.Xu=new st(fo.Mh)}return t.prototype.ko=function(t){return $n.resolve(0===this.Sr.length)},t.prototype.Oo=function(t,e,n,r){var i=this.Yu;this.Yu++,this.Sr.length>0&&this.Sr[this.Sr.length-1];var o=new Or(i,e,n,r);this.Sr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Xu=this.Xu.add(new fo(a.key,i)),this.Dr.Mo(t,a.key.path.F())}return $n.resolve(o)},t.prototype.$o=function(t,e){return $n.resolve(this.Zu(e))},t.prototype.Bo=function(t,e){var n=e+1,r=this.tl(n),i=r<0?0:r;return $n.resolve(this.Sr.length>i?this.Sr[i]:null)},t.prototype.qo=function(){return $n.resolve(0===this.Sr.length?-1:this.Yu-1)},t.prototype.Uo=function(t){return $n.resolve(this.Sr.slice())},t.prototype.Nr=function(t,e){var n=this,r=new fo(e,0),i=new fo(e,Number.POSITIVE_INFINITY),o=[];return this.Xu.xt([r,i],function(t){var e=n.Zu(t.jh);o.push(e)}),$n.resolve(o)},t.prototype.$r=function(t,e){var n=this,r=new st(I);return e.forEach(function(t){var e=new fo(t,0),i=new fo(t,Number.POSITIVE_INFINITY);n.Xu.xt([e,i],function(t){r=r.add(t.jh)})}),$n.resolve(this.el(r))},t.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;G.X(i)||(i=i.child(\"\"));var o=new fo(new G(i),0),s=new st(I);return this.Xu.Ft(function(t){var e=t.key.path;return!!n.M(e)&&(e.length===r&&(s=s.add(t.jh)),!0)},o),$n.resolve(this.el(s))},t.prototype.el=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.Zu(t);null!==r&&n.push(r)}),n},t.prototype.Qo=function(t,e){var n=this;m(0===this.nl(e.batchId,\"removed\")),this.Sr.shift();var r=this.Xu;return $n.forEach(e.mutations,function(i){var o=new fo(i.key,e.batchId);return r=r.delete(o),n.No.Go(t,i.key)}).next(function(){n.Xu=r})},t.prototype.jo=function(t){},t.prototype.Ho=function(t,e){var n=new fo(e,0),r=this.Xu.kt(n);return $n.resolve(e.isEqual(r&&r.key))},t.prototype.zo=function(t){return this.Sr.length,$n.resolve()},t.prototype.nl=function(t,e){return this.tl(t)},t.prototype.tl=function(t){return 0===this.Sr.length?0:t-this.Sr[0].batchId},t.prototype.Zu=function(t){var e=this.tl(t);return e<0||e>=this.Sr.length?null:this.Sr[e]},t}(),Ls=function(){function t(t,e){this.Dr=t,this.sl=e,this.docs=new rt(G.D),this.size=0}return t.prototype.Ir=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.sl(e);return this.docs=this.docs.ot(r,{ta:e,size:s,readTime:n}),this.size+=s-o,this.Dr.Mo(t,r.path.F())},t.prototype.Ar=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Rr=function(t,e){var n=this.docs.get(e);return $n.resolve(n?n.ta:null)},t.prototype.getEntries=function(t,e){var n=this,r=ht();return e.forEach(function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ta:null)}),$n.resolve(r)},t.prototype.Lr=function(t,e,n){for(var r=lt(),i=new G(e.path.child(\"\")),o=this.docs.ft(i);o.At();){var s=o.It(),u=s.key,a=s.value,c=a.ta,h=a.readTime;if(!e.path.M(u.path))break;h.h(n)<=0||c instanceof pn&&Ln(e,c)&&(r=r.ot(c.key,c))}return $n.resolve(r)},t.prototype.il=function(t,e){return $n.forEach(this.docs,function(t){return e(t)})},t.prototype.ra=function(t){return new Os(this)},t.prototype.aa=function(t){return $n.resolve(this.size)},t}(),Os=function(t){function n(e){var n=this;return(n=t.call(this)||this).ha=e,n}return(0,e.__extends)(n,t),n.prototype.Vr=function(t){var e=this,n=[];return this.wr.forEach(function(r,i){i?n.push(e.ha.Ir(t,i,e.readTime)):e.ha.Ar(r)}),$n.kn(n)},n.prototype.Pr=function(t,e){return this.ha.Rr(t,e)},n.prototype.gr=function(t,e){return this.ha.getEntries(t,e)},n}(Cr),Vs=function(){function t(t){this.persistence=t,this.rl=new C(function(t){return H(t)},Y),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.ol=0,this.al=new ho,this.targetCount=0,this.hl=qi.fa()}return t.prototype.Ce=function(t,e){return this.rl.forEach(function(t,n){return e(n)}),$n.resolve()},t.prototype.Ia=function(t){return $n.resolve(this.lastRemoteSnapshotVersion)},t.prototype.ma=function(t){return $n.resolve(this.ol)},t.prototype.wa=function(t){return this.highestTargetId=this.hl.next(),$n.resolve(this.highestTargetId)},t.prototype.Aa=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ol&&(this.ol=e),$n.resolve()},t.prototype.Pa=function(t){this.rl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.hl=new qi(e),this.highestTargetId=e),t.sequenceNumber>this.ol&&(this.ol=t.sequenceNumber)},t.prototype.Ra=function(t,e){return this.Pa(e),this.targetCount+=1,$n.resolve()},t.prototype.Va=function(t,e){return this.Pa(e),$n.resolve()},t.prototype.ya=function(t,e){return this.rl.delete(e.target),this.al.Kh(e.targetId),this.targetCount-=1,$n.resolve()},t.prototype.po=function(t,e,n){var r=this,i=0,o=[];return this.rl.forEach(function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.rl.delete(s),o.push(r.pa(t,u.targetId)),i++)}),$n.kn(o).next(function(){return i})},t.prototype.ba=function(t){return $n.resolve(this.targetCount)},t.prototype.va=function(t,e){var n=this.rl.get(e)||null;return $n.resolve(n)},t.prototype.Sa=function(t,e,n){return this.al.Bh(e,n),$n.resolve()},t.prototype.Ca=function(t,e,n){this.al.Uh(e,n);var r=this.persistence.No,i=[];return r&&e.forEach(function(e){i.push(r.Go(t,e))}),$n.kn(i)},t.prototype.pa=function(t,e){return this.al.Kh(e),$n.resolve()},t.prototype.xa=function(t,e){var n=this.al.Wh(e);return $n.resolve(n)},t.prototype.Ho=function(t,e){return $n.resolve(this.al.Ho(e))},t}(),Cs=function(){function t(t){var e=this;this.cl={},this.Ma=new Ir(0),this.$a=!1,this.$a=!0,this.No=t(this),this.ja=new Vs(this),this.Dr=new mi,this.vr=function(t,n){return new Ls(t,function(t){return e.No.ul(t)})}(this.Dr)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Di=function(){return this.$a=!1,Promise.resolve()},Object.defineProperty(t.prototype,\"Ii\",{get:function(){return this.$a},enumerable:!1,configurable:!0}),t.prototype.Za=function(){},t.prototype.th=function(){},t.prototype.Ah=function(){return this.Dr},t.prototype.Th=function(t){var e=this.cl[t.ti()];return e||(e=new Ps(this.Dr,this.No),this.cl[t.ti()]=e),e},t.prototype.Ih=function(){return this.ja},t.prototype.mh=function(){return this.vr},t.prototype.runTransaction=function(t,e,n){var r=this;p(\"MemoryPersistence\",\"Starting transaction:\",t);var i=new Rs(this.Ma.next());return this.No.ll(),n(i).next(function(t){return r.No._l(i).next(function(){return t})}).xn().then(function(t){return i.br(),t})},t.prototype.fl=function(t,e){return $n.On(Object.values(this.cl).map(function(n){return function(){return n.Ho(t,e)}}))},t}(),Rs=function(t){function n(e){var n=this;return(n=t.call(this)||this).Fa=e,n}return(0,e.__extends)(n,t),n}(Ur),Us=function(){function t(t){this.persistence=t,this.dl=new ho,this.wl=null}return t.El=function(e){return new t(e)},Object.defineProperty(t.prototype,\"Tl\",{get:function(){if(this.wl)return this.wl;throw g()},enumerable:!1,configurable:!0}),t.prototype.Da=function(t,e,n){return this.dl.Da(n,e),this.Tl.delete(n.toString()),$n.resolve()},t.prototype.Na=function(t,e,n){return this.dl.Na(n,e),this.Tl.add(n.toString()),$n.resolve()},t.prototype.Go=function(t,e){return this.Tl.add(e.toString()),$n.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.dl.Kh(e.targetId).forEach(function(t){return n.Tl.add(t.toString())});var r=this.persistence.Ih();return r.xa(t,e.targetId).next(function(t){t.forEach(function(t){return n.Tl.add(t.toString())})}).next(function(){return r.ya(t,e)})},t.prototype.ll=function(){this.wl=new Set},t.prototype._l=function(t){var e=this,n=this.persistence.mh().ra();return $n.forEach(this.Tl,function(r){var i=G.H(r);return e.Il(t,i).next(function(t){t||n.Ar(i)})}).next(function(){return e.wl=null,n.apply(t)})},t.prototype.yh=function(t,e){var n=this;return this.Il(t,e).next(function(t){t?n.Tl.delete(e.toString()):n.Tl.add(e.toString())})},t.prototype.ul=function(t){return 0},t.prototype.Il=function(t,e){var n=this;return $n.On([function(){return $n.resolve(n.dl.Ho(e))},function(){return n.persistence.Ih().Ho(t,e)},function(){return n.persistence.fl(t,e)}])},t}(),Ms=function(){function t(t){this.ml=t.ml,this.Al=t.Al}return t.prototype.gc=function(t){this.Rl=t},t.prototype.Ic=function(t){this.Pl=t},t.prototype.onMessage=function(t){this.gl=t},t.prototype.close=function(){this.Al()},t.prototype.send=function(t){this.ml(t)},t.prototype.Vl=function(){this.Rl()},t.prototype.yl=function(t){this.Pl(t)},t.prototype.pl=function(t){this.gl(t)},t}(),qs={BatchGetDocuments:\"batchGet\",Commit:\"commit\",RunQuery:\"runQuery\"},Fs=function(t){function n(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.T=e.T,n}return(0,e.__extends)(n,t),n.prototype.Nl=function(t,e,n,r){return new Promise(function(i,s){var u=new o.XhrIo;u.listenOnce(o.EventType.COMPLETE,function(){try{switch(u.getLastErrorCode()){case o.ErrorCode.NO_ERROR:var e=u.getResponseJson();p(\"Connection\",\"XHR received:\",JSON.stringify(e)),i(e);break;case o.ErrorCode.TIMEOUT:p(\"Connection\",'RPC \"'+t+'\" timed out'),s(new h(c.DEADLINE_EXCEEDED,\"Request time out\"));break;case o.ErrorCode.HTTP_ERROR:var n=u.getStatus();if(p(\"Connection\",'RPC \"'+t+'\" failed with status:',n,\"response text:\",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=r.status.toLowerCase().replace(\"_\",\"-\");return Object.values(c).indexOf(e)>=0?e:c.UNKNOWN}();s(new h(a,r.message))}else s(new h(c.UNKNOWN,\"Server responded with status \"+u.getStatus()))}else s(new h(c.UNAVAILABLE,\"Connection failed.\"));break;default:g()}}finally{p(\"Connection\",'RPC \"'+t+'\" completed.')}});var a=JSON.stringify(r);u.send(e,\"POST\",a,n,15)})},n.prototype.Vc=function(t,e){var n=[this.vl,\"/\",\"google.firestore.v1.Firestore\",\"/\",t,\"/channel\"],r=(0,o.createWebChannelTransport)(),s={httpSessionIdParam:\"gsessionid\",initMessageHeaders:{},messageUrlParams:{database:\"projects/\"+this._.projectId+\"/databases/\"+this._.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.T};this.Cl(s.initMessageHeaders,e),(0,i.isMobileCordova)()||(0,i.isReactNative)()||(0,i.isElectron)()||(0,i.isIE)()||(0,i.isUWP)()||(0,i.isBrowserExtension)()||(s.httpHeadersOverwriteParam=\"$httpHeaders\");var u=n.join(\"\");p(\"Connection\",\"Creating WebChannel: \"+u,s);var a=r.createWebChannel(u,s),f=!1,l=!1,d=new Ms({ml:function(t){l?p(\"Connection\",\"Not sending because WebChannel is closed:\",t):(f||(p(\"Connection\",\"Opening WebChannel transport.\"),a.open(),f=!0),p(\"Connection\",\"WebChannel sending:\",t),a.send(t))},Al:function(){return a.close()}}),y=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return y(o.WebChannel.EventType.OPEN,function(){l||p(\"Connection\",\"WebChannel transport opened.\")}),y(o.WebChannel.EventType.CLOSE,function(){l||(l=!0,p(\"Connection\",\"WebChannel transport closed\"),d.yl())}),y(o.WebChannel.EventType.ERROR,function(t){l||(l=!0,v(\"Connection\",\"WebChannel transport errored:\",t),d.yl(new h(c.UNAVAILABLE,\"The operation could not be completed\")))}),y(o.WebChannel.EventType.MESSAGE,function(t){var e;if(!l){var n=t.data[0];m(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){p(\"Connection\",\"WebChannel received error:\",i);var o=i.status,s=function(t){var e=J[o];if(void 0!==e)return nt(e)}(),u=i.message;void 0===s&&(s=c.INTERNAL,u=\"Unknown error status: \"+o+\" with message \"+i.message),l=!0,d.yl(new h(s,u)),a.close()}else p(\"Connection\",\"WebChannel received:\",n),d.pl(n)}}),setTimeout(function(){d.Vl()},0),d},n}(function(){function t(t){this.bl=t,this._=t._;var e=t.ssl?\"https\":\"http\";this.vl=e+\"://\"+t.host,this.Sl=\"projects/\"+this._.projectId+\"/databases/\"+this._.database+\"/documents\"}return t.prototype.Mc=function(t,e,n,r){var i=this.Dl(t,e);p(\"RestConnection\",\"Sending: \",i,n);var o={};return this.Cl(o,r),this.Nl(t,i,o,n).then(function(t){return p(\"RestConnection\",\"Received: \",t),t},function(e){throw v(\"RestConnection\",t+\" failed with error: \",e,\"url: \",i,\"request:\",n),e})},t.prototype.$c=function(t,e,n,r){return this.Mc(t,e,n,r)},t.prototype.Cl=function(t,e){if(t[\"X-Goog-Api-Client\"]=\"gl-js/ fire/8.0.0\",t[\"Content-Type\"]=\"text/plain\",e)for(var n in e.Gh)e.Gh.hasOwnProperty(n)&&(t[n]=e.Gh[n])},t.prototype.Dl=function(t,e){var n=qs[t];return this.vl+\"/v1/\"+e+\":\"+n},t}()),js=function(){function t(){var t=this;this.xl=function(){return t.Fl()},this.kl=function(){return t.Ol()},this.Ml=[],this.$l()}return t.prototype.eu=function(t){this.Ml.push(t)},t.prototype.Di=function(){window.removeEventListener(\"online\",this.xl),window.removeEventListener(\"offline\",this.kl)},t.prototype.$l=function(){window.addEventListener(\"online\",this.xl),window.addEventListener(\"offline\",this.kl)},t.prototype.Fl=function(){p(\"ConnectivityMonitor\",\"Network connectivity changed: AVAILABLE\");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(0)},t.prototype.Ol=function(){p(\"ConnectivityMonitor\",\"Network connectivity changed: UNAVAILABLE\");for(var t=0,e=this.Ml;t<e.length;t++)(0,e[t])(1)},t.Ln=function(){return\"undefined\"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Gs=function(){function t(){}return t.prototype.eu=function(t){},t.prototype.Di=function(){},t}();function Bs(t){return new $t(t,!0)}var zs=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.Su=this.Ll(t),this.persistence=this.Bl(t),[4,this.persistence.start()];case 1:return e.sent(),this.ql=this.Ul(t),this.Gc=this.Kl(t),[2]}})})},t.prototype.Ul=function(t){return null},t.prototype.Kl=function(t){return e=this.persistence,n=new ks,r=t.Ql,new $i(e,n,r);var e,n,r},t.prototype.Bl=function(t){return new Cs(Us.El)},t.prototype.Ll=function(t){return new Lr},t.prototype.terminate=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.ql&&this.ql.stop(),[4,this.Su.Di()];case 1:return t.sent(),[4,this.persistence.Di()];case 2:return t.sent(),[2]}})})},t}(),Ks=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Wl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,e.__extends)(n,t),n.prototype.initialize=function(n){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return e.sent(),[4,ao(this.Gc)];case 2:return e.sent(),[4,this.Wl.initialize(this,n)];case 3:return e.sent(),[4,xs(this.Wl.fi)];case 4:return e.sent(),[4,Fo(this.Wl.bu)];case 5:return e.sent(),[2]}})})},n.prototype.Ul=function(t){var e=this.persistence.No.wo;return new zr(e,t.hs)},n.prototype.Bl=function(t){var e=Ji(t.bl._,t.bl.persistenceKey),n=void 0!==this.cacheSizeBytes?Br.ao(this.cacheSizeBytes):Br.fo,r=Bs(t.bl._);return new Wi(this.synchronizeTabs,e,t.clientId,n,t.hs,ar(),cr(),r,this.Su,!!this.forceOwnership)},n.prototype.Ll=function(t){return new Lr},n}(zs),Ws=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Wl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,e.__extends)(n,t),n.prototype.initialize=function(n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i=this;return(0,e.__generator)(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Wl.fi,this.Su instanceof Pr?(this.Su.fi={er:bs.bind(null,r),nr:As.bind(null,r),sr:Ds.bind(null,r),pi:Ns.bind(null,r)},[4,this.Su.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.Xa(function(t){return(0,e.__awaiter)(i,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,Is(this.Wl.fi,t)];case 1:return e.sent(),this.ql&&(t&&!this.ql.Ii?this.ql.start(this.Gc):t||this.ql.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},n.prototype.Ll=function(t){var e=ar();if(!Pr.Ln(e))throw new h(c.UNIMPLEMENTED,\"IndexedDB persistence is only available on platforms that support LocalStorage.\");var n=Ji(t.bl._,t.bl.persistenceKey);return new Pr(e,t.hs,n,t.clientId,t.Ql)},n}(Ks),Qs=function(){function t(){}return t.prototype.initialize=function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.Gc?[3,2]:(this.Gc=t.Gc,this.Su=t.Su,this.zc=this.jl(n),this.bu=this.Gl(n),this.vu=this.zl(n),this.fi=this.Hl(n,!t.synchronizeTabs),this.Su.di=function(t){return ss(r.fi,t,1)},this.bu.Hc.Jl=ms.bind(null,this.fi),[4,Qo(this.bu,this.fi.Uu)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.zl=function(t){return new dr},t.prototype.jl=function(t){var e,n=Bs(t.bl._),r=(e=t.bl,new Fs(e));return function(t,e,n){return new bo(t,r,n)}(t.credentials,0,n)},t.prototype.Gl=function(t){var e,n,r,i,o,s=this;return e=this.Gc,n=this.zc,r=t.hs,i=function(t){return ss(s.fi,t,0)},o=js.Ln()?new js:new Gs,new Eo(e,n,r,i,o)},t.prototype.Hl=function(t,e){return function(t,e,n,r,i,o,s){var u=new es(t,e,n,r,i,o);return s&&(u.qu=!0),u}(this.Gc,this.bu,this.vu,this.Su,t.Ql,t.Du,e)},t.prototype.terminate=function(){return Ao(this.bu)},t}(),Hs=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Yl(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Yl(this.observer.error,t):console.error(\"Uncaught Error in snapshot listener:\",t)},t.prototype.Xl=function(){this.muted=!0},t.prototype.Yl=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}();function Ys(t,e,n){if(!n)throw new h(c.INVALID_ARGUMENT,\"Function \"+t+\"() cannot be called with an empty \"+e+\".\")}function Xs(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new h(c.INVALID_ARGUMENT,\"Invalid options passed to function \"+t+'(): You cannot specify both \"merge\" and \"mergeFields\".');return e}function Js(t,e,n,r){if(!0===e&&!0===r)throw new h(c.INVALID_ARGUMENT,t+\" and \"+n+\" cannot be used together.\")}function $s(t){if(void 0===t)return\"undefined\";if(null===t)return\"null\";if(\"string\"==typeof t)return t.length>20&&(t=t.substring(0,20)+\"...\"),JSON.stringify(t);if(\"number\"==typeof t||\"boolean\"==typeof t)return\"\"+t;if(\"object\"==a(t)){if(t instanceof Array)return\"an array\";var e=function(t){if(t.constructor){var e=/function\\s+([^\\s(]+)\\s*\\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?\"a custom \"+e+\" object\":\"an object\"}return\"function\"==typeof t?\"a function\":g()}function Zs(t,e){if(e<=0)throw new h(c.INVALID_ARGUMENT,\"Function \"+t+\"() requires a positive number, but it was: \"+e+\".\")}var tu=function(t){for(var e=0;e<t.length;++e)if(0===t[e].length)throw new h(c.INVALID_ARGUMENT,\"Invalid field name at argument $(i + 1). Field names must not be empty.\");this.Zl=new j(t)},eu=function(t){function n(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return(0,e.__extends)(n,t),n.documentId=function(){return new n(j.j().B())},n.prototype.isEqual=function(t){return t instanceof n&&this.Zl.isEqual(t.Zl)},n}(tu),nu=new RegExp(\"[~\\\\*/\\\\[\\\\]]\"),ru=function(t){this.t_=t},iu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.e_=function(t){if(2!==t.n_)throw 1===t.n_?t.s_(this.t_+\"() can only appear at the top level of your update data\"):t.s_(this.t_+\"() cannot be used with set() unless you pass {merge:true}\");return t.Qe.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(ru);function ou(t,e,n){return new gu({n_:3,i_:e.settings.i_,methodName:t.t_,r_:n},e._,e.serializer,e.ignoreUndefinedProperties)}var su=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.e_=function(t){return new ze(t.path,new Ce)},n.prototype.isEqual=function(t){return t instanceof n},n}(ru),uu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).o_=n,r}return(0,e.__extends)(n,t),n.prototype.e_=function(t){var e=ou(this,t,!0),n=this.o_.map(function(t){return Eu(t,e)}),r=new Re(n);return new ze(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(ru),au=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).o_=n,r}return(0,e.__extends)(n,t),n.prototype.e_=function(t){var e=ou(this,t,!0),n=this.o_.map(function(t){return Eu(t,e)}),r=new Me(n);return new ze(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(ru),cu=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).a_=n,r}return(0,e.__extends)(n,t),n.prototype.e_=function(t){var e=new Fe(t.serializer,ee(t.serializer,this.a_));return new ze(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(ru),hu=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new h(c.INVALID_ARGUMENT,\"Latitude must be a number between -90 and 90, but was: \"+t);if(!isFinite(e)||e<-180||e>180)throw new h(c.INVALID_ARGUMENT,\"Longitude must be a number between -180 and 180, but was: \"+e);this.h_=t,this.c_=e}return Object.defineProperty(t.prototype,\"latitude\",{get:function(){return this.h_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"longitude\",{get:function(){return this.c_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.h_===t.h_&&this.c_===t.c_},t.prototype.toJSON=function(){return{latitude:this.h_,longitude:this.c_}},t.prototype.g=function(t){return I(this.h_,t.h_)||I(this.c_,t.c_)},t}(),fu=function(t){this.u_=t},lu=/^__.*__$/,pu=function(t,e,n){this.l_=t,this.__=e,this.f_=n},du=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.d_=function(t,e){var n=[];return null!==this.Qe?n.push(new en(t,this.data,this.Qe,e)):n.push(new tn(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new rn(t,this.fieldTransforms)),n},t}(),vu=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.d_=function(t,e){var n=[new en(t,this.data,this.Qe,e)];return this.fieldTransforms.length>0&&n.push(new rn(t,this.fieldTransforms)),n},t}();function yu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw g()}}var gu=function(){function t(t,e,n,r,i,o){this.settings=t,this._=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.w_(),this.fieldTransforms=i||[],this.Qe=o||[]}return Object.defineProperty(t.prototype,\"path\",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"n_\",{get:function(){return this.settings.n_},enumerable:!1,configurable:!0}),t.prototype.E_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this._,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},t.prototype.T_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.E_({path:n,r_:!1});return r.I_(t),r},t.prototype.m_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.E_({path:n,r_:!1});return r.w_(),r},t.prototype.A_=function(t){return this.E_({path:void 0,r_:!0})},t.prototype.s_=function(t){return xu(t,this.settings.methodName,this.settings.R_||!1,this.path,this.settings.i_)},t.prototype.contains=function(t){return void 0!==this.Qe.find(function(e){return t.M(e)})||void 0!==this.fieldTransforms.find(function(e){return t.M(e.field)})},t.prototype.w_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.I_(this.path.get(t))},t.prototype.I_=function(t){if(0===t.length)throw this.s_(\"Document fields must not be empty\");if(yu(this.n_)&&lu.test(t))throw this.s_('Document fields cannot begin and end with \"__\"')},t}(),mu=function(){function t(t,e,n){this._=t,this.ignoreUndefinedProperties=e,this.serializer=n||Bs(t)}return t.prototype.P_=function(t,e,n,r){return void 0===r&&(r=!1),new gu({n_:t,methodName:e,i_:n,path:j.U(),r_:!1,R_:r},this._,this.serializer,this.ignoreUndefinedProperties)},t}();function wu(t,e,n,r,i,o){void 0===o&&(o={});var s=t.P_(o.merge||o.mergeFields?2:0,e,n,i);Au(\"Data must be an object, but it was:\",s,r);var u,a,f=Tu(r,s);if(o.merge)u=new Be(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var l=[],p=0,d=o.mergeFields;p<d.length;p++){var v=d[p],y=void 0;if(v instanceof tu)y=v.Zl;else{if(\"string\"!=typeof v)throw g();y=Su(e,v,n)}if(!s.contains(y))throw new h(c.INVALID_ARGUMENT,\"Field '\"+y+\"' is specified in your field mask but missing from your input data.\");ku(l,y)||l.push(y)}u=new Be(l),a=s.fieldTransforms.filter(function(t){return u.Je(t.field)})}else u=null,a=s.fieldTransforms;return new du(new cn(f),u,a)}function _u(t,e,n,r){var i=t.P_(1,e,n);Au(\"Data must be an object, but it was:\",i,r);var o=[],s=new hn;O(r,function(t,r){var u=Su(e,t,n),a=i.m_(u);if(r instanceof iu||r instanceof fu&&r.u_ instanceof iu)o.push(u);else{var c=Eu(r,a);null!=c&&(o.push(u),s.set(u,c))}});var u=new Be(o);return new vu(s.Xe(),u,i.fieldTransforms)}function bu(t,e,n,r,i,o){var s=t.P_(1,e,n),u=[Du(e,r,n)],a=[i];if(o.length%2!=0)throw new h(c.INVALID_ARGUMENT,\"Function \"+e+\"() needs to be called with an even number of arguments that alternate between field names and values.\");for(var f=0;f<o.length;f+=2)u.push(Du(e,o[f])),a.push(o[f+1]);for(var l=[],p=new hn,d=u.length-1;d>=0;--d)if(!ku(l,u[d])){var v=u[d],y=a[d],g=s.m_(v);if(y instanceof iu||y instanceof fu&&y.u_ instanceof iu)l.push(v);else{var m=Eu(y,g);null!=m&&(l.push(v),p.set(v,m))}}var w=new Be(l);return new vu(p.Xe(),w,s.fieldTransforms)}function Iu(t,e,n,r){return void 0===r&&(r=!1),Eu(n,t.P_(r?4:3,e))}function Eu(t,e){if(t instanceof fu&&(t=t.u_),Nu(t))return Au(\"Unsupported field value:\",e,t),Tu(t,e);if(t instanceof ru)return function(t,e){if(!yu(e.n_))throw e.s_(t.t_+\"() can only be used with update() and set()\");if(!e.path)throw e.s_(t.t_+\"() is not currently supported inside arrays\");var n=t.e_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Qe.push(e.path),t instanceof Array){if(e.settings.r_&&4!==e.n_)throw e.s_(\"Nested arrays are not supported\");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Eu(o[i],e.A_(r));null==s&&(s={nullValue:\"NULL_VALUE\"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:\"NULL_VALUE\"};if(\"number\"==typeof t)return ee(e.serializer,t);if(\"boolean\"==typeof t)return{booleanValue:t};if(\"string\"==typeof t)return{stringValue:t};if(t instanceof Date){var n=R.fromDate(t);return{timestampValue:ne(e.serializer,n)}}if(t instanceof R){var r=new R(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ne(e.serializer,r)}}if(t instanceof hu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof A)return{bytesValue:re(e.serializer,t.l)};if(t instanceof pu){var i=e._,o=t.l_;if(!o.isEqual(i))throw e.s_(\"Document reference is for database \"+o.projectId+\"/\"+o.database+\" but should be for database \"+i.projectId+\"/\"+i.database);return{referenceValue:se(t.l_||e._,t.__.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.s_(\"Unsupported field value: \"+$s(t))}(t,e)}function Tu(t,e){var n={};return V(t)?e.path&&e.path.length>0&&e.Qe.push(e.path):O(t,function(t,r){var i=Eu(r,e.T_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Nu(t){return!(\"object\"!=a(t)||null===t||t instanceof Array||t instanceof Date||t instanceof R||t instanceof hu||t instanceof A||t instanceof pu||t instanceof ru)}function Au(t,e,n){if(!Nu(n)||!function(t){return\"object\"==a(t)&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=$s(n);throw\"an object\"===r?e.s_(t+\" a custom object\"):e.s_(t+\" \"+r)}}function Du(t,e,n){if(e instanceof tu)return e.Zl;if(\"string\"==typeof e)return Su(t,e);throw xu(\"Field path arguments must be of type string or FieldPath.\",t,!1,void 0,n)}function Su(t,n,r){try{return function(t){if(t.search(nu)>=0)throw new h(c.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not contain '~', '*', '/', '[', or ']'\");try{return new(eu.bind.apply(eu,(0,e.__spreadArrays)([void 0],t.split(\".\"))))}catch(n){throw new h(c.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\")}}(n).Zl}catch(n){throw xu((i=n)instanceof Error?i.message:i.toString(),t,!1,void 0,r)}var i}function xu(t,e,n,r,i){var o=r&&!r.P(),s=void 0!==i,u=\"Function \"+e+\"() called with invalid data\";n&&(u+=\" (via `toFirestore()`)\");var a=\"\";return(o||s)&&(a+=\" (found\",o&&(a+=\" in field \"+r),s&&(a+=\" in document \"+i),a+=\")\"),new h(c.INVALID_ARGUMENT,(u+=\". \")+t+a)}function ku(t,e){return t.some(function(t){return t.isEqual(e)})}var Pu=function(){function t(t){this.zc=t,this.g_=new Map,this.mutations=[],this.V_=!1,this.y_=null,this.p_=new Set}return t.prototype.b_=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(i){switch(i.label){case 0:if(this.v_(),this.mutations.length>0)throw new h(c.INVALID_ARGUMENT,\"Firestore transactions require all reads to be executed before all writes.\");return[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=w(t),i=le(r.serializer)+\"/documents\",o={documents:n.map(function(t){return ae(r.serializer,t)})},[4,r.$c(\"BatchGetDocuments\",i,o)];case 1:return s=e.sent(),u=new Map,s.forEach(function(t){var e=function(t,e){return\"found\"in e?function(t,e){m(!!e.found),e.found.name,e.found.updateTime;var n=ce(t,e.found.name),r=oe(e.found.updateTime),i=new cn({mapValue:{fields:e.found.fields}});return new pn(n,r,i,{})}(t,e):\"missing\"in e?function(t,e){m(!!e.missing),m(!!e.readTime);var n=ce(t,e.missing),r=oe(e.readTime);return new dn(n,r)}(t,e):g()}(r.serializer,t);u.set(e.key.toString(),e)}),a=[],[2,(n.forEach(function(t){var e=u.get(t.toString());m(!!e),a.push(e)}),a)]}})})}(this.zc,t)];case 1:return[2,((n=i.sent()).forEach(function(t){t instanceof dn||t instanceof pn?r.S_(t):g()}),n)]}})})},t.prototype.set=function(t,e){this.write(e.d_(t,this.Ge(t))),this.p_.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.d_(t,this.D_(t)))}catch(t){this.y_=t}this.p_.add(t.toString())},t.prototype.delete=function(t){this.write([new un(t,this.Ge(t))]),this.p_.add(t.toString())},t.prototype.commit=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){var t,n=this;return(0,e.__generator)(this,function(r){switch(r.label){case 0:if(this.v_(),this.y_)throw this.y_;return t=this.g_,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,e){var r=G.H(e);n.mutations.push(new an(r,n.Ge(r)))}),[4,function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=w(t),i=le(r.serializer)+\"/documents\",o={writes:n.map(function(t){return ve(r.serializer,t)})},[4,r.Mc(\"Commit\",i,o)];case 1:return e.sent(),[2]}})})}(this.zc,this.mutations)];case 1:return r.sent(),this.V_=!0,[2]}})})},t.prototype.S_=function(t){var e;if(t instanceof pn)e=t.version;else{if(!(t instanceof dn))throw g();e=U.min()}var n=this.g_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new h(c.ABORTED,\"Document version changed between two reads.\")}else this.g_.set(t.key.toString(),e)},t.prototype.Ge=function(t){var e=this.g_.get(t.toString());return!this.p_.has(t.toString())&&e?We.updateTime(e):We.ze()},t.prototype.D_=function(t){var e=this.g_.get(t.toString());if(!this.p_.has(t.toString())&&e){if(e.isEqual(U.min()))throw new h(c.INVALID_ARGUMENT,\"Can't update a document that doesn't exist.\");return We.updateTime(e)}return We.exists(!0)},t.prototype.write=function(t){this.v_(),this.mutations=this.mutations.concat(t)},t.prototype.v_=function(){},t}(),Lu=function(){function t(t,e,n,r){this.hs=t,this.zc=e,this.updateFunction=n,this.ls=r,this.C_=5,this.Vs=new Jn(this.hs,\"transaction_retry\")}return t.prototype.run=function(){this.N_()},t.prototype.N_=function(){var t=this;this.Vs.Pn(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){var t,n,r=this;return(0,e.__generator)(this,function(e){return t=new Pu(this.zc),(n=this.x_(t))&&n.then(function(e){r.hs.ws(function(){return t.commit().then(function(){r.ls.resolve(e)}).catch(function(t){r.F_(t)})})}).catch(function(t){r.F_(t)}),[2]})})})},t.prototype.x_=function(t){try{var e=this.updateFunction(t);return!B(e)&&e.catch&&e.then?e:(this.ls.reject(Error(\"Transaction callback must return a Promise\")),null)}catch(t){return this.ls.reject(t),null}},t.prototype.F_=function(t){var e=this;this.C_>0&&this.k_(t)?(this.C_-=1,this.hs.ws(function(){return e.N_(),Promise.resolve()})):this.ls.reject(t)},t.prototype.k_=function(t){if(\"FirebaseError\"===t.name){var e=t.code;return\"aborted\"===e||\"failed-precondition\"===e||!et(e)}return!1},t}(),Ou=function(){function t(t,e){this.credentials=t,this.hs=e,this.clientId=b.t(),this.O_=new Xn}return t.prototype.start=function(t,n,r){var i=this;this.M_(),this.bl=t;var o=new Xn,s=!1;return this.credentials.Jh(function(t){if(!s)return s=!0,p(\"FirestoreClient\",\"Initializing. user=\",t.uid),i.L_(n,r,t,o).then(i.O_.resolve,i.O_.reject);i.hs.Cs(function(){return function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(r=w(t)).hs.Fs(),p(\"RemoteStore\",\"RemoteStore received new credentials\"),i=Oo(r),r.Xc.add(3),[4,No(r)];case 1:return e.sent(),i&&r.nu.set(\"Unknown\"),[4,r.Hc.Jl(n)];case 2:return e.sent(),r.Xc.delete(3),[4,To(r)];case 3:return e.sent(),[2]}})})}(i.bu,t)})}),this.hs.ws(function(){return i.O_.promise}),o.promise},t.prototype.enableNetwork=function(){var t=this;return this.M_(),this.hs.enqueue(function(){return t.persistence.th(!0),function(t){var e=w(t);return e.Xc.delete(0),To(e)}(t.bu)})},t.prototype.L_=function(t,n,r,i){return(0,e.__awaiter)(this,void 0,void 0,function(){var o,s,u=this;return(0,e.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),o={hs:this.hs,bl:this.bl,clientId:this.clientId,credentials:this.credentials,Ql:r,Du:100},[4,t.initialize(o)];case 1:return a.sent(),[4,n.initialize(t,o)];case 2:return a.sent(),this.persistence=t.persistence,this.Su=t.Su,this.Gc=t.Gc,this.ql=t.ql,this.zc=n.zc,this.bu=n.bu,this.fi=n.fi,this.B_=n.vu,this.B_.Us=ns.bind(null,this.fi),this.B_.Ws=is.bind(null,this.fi),this.persistence.Za(function(){return(0,e.__awaiter)(u,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),i.resolve(),[3,4];case 3:if(s=a.sent(),i.reject(s),!function(t){return\"FirebaseError\"===t.name?t.code===c.FAILED_PRECONDITION||t.code===c.UNIMPLEMENTED:!(\"undefined\"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(s))throw s;return[2,(console.warn(\"Error enabling offline persistence. Falling back to persistence disabled: \"+s),this.L_(new zs,new Qs,r,i))];case 4:return[2]}})})},t.prototype.M_=function(){if(this.hs.ps)throw new h(c.FAILED_PRECONDITION,\"The client has already been terminated.\")},t.prototype.disableNetwork=function(){var t=this;return this.M_(),this.hs.enqueue(function(){return t.persistence.th(!1),function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return(n=w(t)).Xc.add(0),[4,No(n)];case 1:return e.sent(),n.nu.set(\"Offline\"),[2]}})})}(t.bu)})},t.prototype.terminate=function(){var t=this;this.hs.Ds();var n=new Xn;return this.hs.bs(function(){return(0,e.__awaiter)(t,void 0,void 0,function(){var t,r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),this.ql&&this.ql.stop(),[4,Ao(this.bu)];case 1:return e.sent(),[4,this.Su.Di()];case 2:return e.sent(),[4,this.persistence.Di()];case 3:return e.sent(),this.credentials.Yh(),n.resolve(),[3,5];case 4:return t=e.sent(),r=lr(t,\"Failed to shutdown persistence\"),n.reject(r),[3,5];case 5:return[2]}})})}),n.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.M_();var n=new Xn;return this.hs.ws(function(){return function(t,n){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,o,s,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:Oo((r=w(t)).bu)||p(\"SyncEngine\",\"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.\"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(t){var e=w(t);return e.persistence.runTransaction(\"Get highest unacknowledged batch id\",\"readonly\",function(t){return e.Sr.qo(t)})}(r.Gc)];case 2:return-1===(i=e.sent())?[2,void n.resolve()]:((o=r.Lu.get(i)||[]).push(n),r.Lu.set(i,o),[3,4]);case 3:return s=e.sent(),u=lr(s,\"Initialization of waitForPendingWrites() operation failed\"),n.reject(u),[3,4];case 4:return[2]}})})}(t.fi,n)}),n.promise},t.prototype.listen=function(t,e,n){var r=this;this.M_();var i=new Hs(n),o=new _r(t,i,e);return this.hs.ws(function(){return vr(r.B_,o)}),function(){i.Xl(),r.hs.ws(function(){return yr(r.B_,o)})}},t.prototype.q_=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return i.sent(),n=new Xn,[2,(this.hs.ws(function(){return function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,function(t,e){var n=w(t);return n.persistence.runTransaction(\"read document\",\"readonly\",function(t){return n.Nh.Cr(t,e)})}(t,n)];case 1:return(i=e.sent())instanceof pn?r.resolve(i):i instanceof dn?r.resolve(null):r.reject(new h(c.UNAVAILABLE,\"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)\")),[3,3];case 2:return o=e.sent(),s=lr(o,\"Failed to get document '\"+n+\" from cache\"),r.reject(s),[3,3];case 3:return[2]}})})}(r.Gc,t,n)}),n.promise)]}})})},t.prototype.U_=function(t,n){return void 0===n&&(n={}),(0,e.__awaiter)(this,void 0,void 0,function(){var r,i=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return e.sent(),r=new Xn,[2,(this.hs.ws(function(){return function(t,e,n,r,i){var o=new Hs({next:function(o){e.ws(function(){return yr(t,s)});var u=o.docs.has(n);!u&&o.fromCache?i.reject(new h(c.UNAVAILABLE,\"Failed to get document because the client is offline.\")):u&&o.fromCache&&r&&\"server\"===r.source?i.reject(new h(c.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to \"server\" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new _r(mn(n.path),o,{includeMetadataChanges:!0,Xs:!0});return vr(t,s)}(i.B_,i.hs,t,n,r)}),r.promise)]}})})},t.prototype.K_=function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return i.sent(),n=new Xn,[2,(this.hs.ws(function(){return function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,u,a,c;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,oo(t,n,!0)];case 1:return i=e.sent(),o=new $o(n,i.Fh),s=o.Eu(i.documents),u=o.Vr(s,!1),r.resolve(u.snapshot),[3,3];case 2:return a=e.sent(),c=lr(a,\"Failed to execute query '\"+n+\" against cache\"),r.reject(c),[3,3];case 3:return[2]}})})}(r.Gc,t,n)}),n.promise)]}})})},t.prototype.Q_=function(t,n){return void 0===n&&(n={}),(0,e.__awaiter)(this,void 0,void 0,function(){var r,i=this;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return this.M_(),[4,this.O_.promise];case 1:return e.sent(),r=new Xn,[2,(this.hs.ws(function(){return function(t,e,n,r,i){var o=new Hs({next:function(n){e.ws(function(){return yr(t,s)}),n.fromCache&&\"server\"===r.source?i.reject(new h(c.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to \"server\" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new _r(n,o,{includeMetadataChanges:!0,Xs:!0});return vr(t,s)}(i.B_,i.hs,t,n,r)}),r.promise)]}})})},t.prototype.write=function(t){var n=this;this.M_();var r=new Xn;return this.hs.ws(function(){return function(t,n,r){return(0,e.__awaiter)(this,void 0,void 0,function(){var i,o,s,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:i=xs(t),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,function(t,e){var n,r=w(t),i=R.now(),o=e.reduce(function(t,e){return t.add(e.key)},vt());return r.persistence.runTransaction(\"Locally write mutations\",\"readwrite\",function(t){return r.Nh.Or(t,o).next(function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=Je(c,n.get(c.key));null!=h&&s.push(new en(c.key,h,fn(h.proto.mapValue),We.exists(!0)))}return r.Sr.Oo(t,i,s,e)})}).then(function(t){var e=t.lr(n);return{batchId:t.batchId,wr:e}})}(i.Gc,n)];case 2:return o=e.sent(),i.Su.Fi(o.batchId),function(t,e,n){var r=t.$u[t.currentUser.ti()];r||(r=new rt(I)),r=r.ot(e,n),t.$u[t.currentUser.ti()]=r}(i,o.batchId,r),[4,gs(i,o.wr)];case 3:return e.sent(),[4,Fo(i.bu)];case 4:return e.sent(),[3,6];case 5:return s=e.sent(),u=lr(s,\"Failed to persist write\"),r.reject(u),[3,6];case 6:return[2]}})})}(n.fi,t,r)}),r.promise},t.prototype._=function(){return this.bl._},t.prototype.W_=function(t){var n=this;this.M_();var r=new Hs(t);return this.hs.ws(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2,function(t,e){w(t).qs.add(e),e.next()}(this.B_,r)]})})}),function(){r.Xl(),n.hs.ws(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){return(0,e.__generator)(this,function(t){return[2,function(t,e){w(t).qs.delete(e)}(this.B_,r)]})})})}},Object.defineProperty(t.prototype,\"j_\",{get:function(){return this.hs.ps},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.M_();var n=new Xn;return this.hs.ws(function(){return new Lu(e.hs,e.zc,t,n).run(),Promise.resolve()}),n.promise},t}();function Vu(t){return function(t,e){if(\"object\"!=a(t)||null===t)return!1;for(var n=t,r=0,i=[\"next\",\"error\",\"complete\"];r<i.length;r++){var o=i[r];if(o in n&&\"function\"==typeof n[o])return!0}return!1}(t)}var Cu=function(){function t(t,e,n,r){this._=t,this.G_=e,this.z_=n,this.H_=r}return t.prototype.J_=function(t){switch(Vt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Gt(t.integerValue||t.doubleValue);case 3:return this.Y_(t.timestampValue);case 4:return this.X_(t);case 5:return t.stringValue;case 6:return this.H_(Bt(t.bytesValue));case 7:return this.Z_(t.referenceValue);case 8:return this.tf(t.geoPointValue);case 9:return this.ef(t.arrayValue);case 10:return this.nf(t.mapValue);default:throw g()}},t.prototype.nf=function(t){var e=this,n={};return O(t.fields||{},function(t,r){n[t]=e.J_(r)}),n},t.prototype.tf=function(t){return new hu(Gt(t.latitude),Gt(t.longitude))},t.prototype.ef=function(t){var e=this;return(t.values||[]).map(function(t){return e.J_(t)})},t.prototype.X_=function(t){switch(this.G_){case\"previous\":var e=Pt(t);return null==e?null:this.J_(e);case\"estimate\":return this.Y_(Lt(t));default:return null}},t.prototype.Y_=function(t){var e=jt(t);return new R(e.seconds,e.nanos)},t.prototype.Z_=function(t){var e=q.q(t);m(ke(e));var n=new P(e.get(1),e.get(3)),r=new G(e.N(5));return n.isEqual(this._)||d(\"Document \"+r+\" contains a document reference within a different database (\"+n.projectId+\"/\"+n.database+\") which is not supported. It will be treated as a reference in the current database (\"+this._.projectId+\"/\"+this._.database+\") instead.\"),this.z_(r)},t}(),Ru=Br.uo,Uu=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new h(c.INVALID_ARGUMENT,\"Can't provide ssl option if host option is not set\");this.host=\"firestore.googleapis.com\",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Br._o;else{if(t.cacheSizeBytes!==Ru&&t.cacheSizeBytes<Br.lo)throw new h(c.INVALID_ARGUMENT,\"cacheSizeBytes must be at least \"+Br.lo);this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Js(\"experimentalForceLongPolling\",t.experimentalForceLongPolling,\"experimentalAutoDetectLongPolling\",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Mu=\"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.\",qu=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){throw new h(c.FAILED_PRECONDITION,Mu)},t.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new h(c.FAILED_PRECONDITION,Mu)},t.prototype.clearIndexedDbPersistence=function(t){throw new h(c.FAILED_PRECONDITION,Mu)},t}(),Fu=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){var n=new Qs,r=new Ks(n,t.sf().cacheSizeBytes,e);return t.if(r,n)},t.prototype.enableMultiTabIndexedDbPersistence=function(t){var e=new Qs,n=new Ws(e,t.sf().cacheSizeBytes);return t.if(n,e)},t.prototype.clearIndexedDbPersistence=function(t){var n=this,r=new Xn;return t.rf.bs(function(){return(0,e.__awaiter)(n,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t){return(0,e.__awaiter)(this,void 0,void 0,function(){var n;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return Zn.Ln()?(n=t+\"main\",[4,Zn.delete(n)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Ji(t.l_,t.af))];case 1:return i.sent(),r.resolve(),[3,3];case 2:return n=i.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise},t}(),ju=function(){function t(n,r,i){var o=this;if(void 0===i&&(i=new qu),this.hf=i,this.cf=null,this.rf=new fr,this.INTERNAL={delete:function(){return(0,e.__awaiter)(o,void 0,void 0,function(){return(0,e.__generator)(this,function(t){switch(t.label){case 0:return this.uf(),[4,this.lf.terminate()];case 1:return t.sent(),[2]}})})}},\"object\"==a(n.options)){var s=n;this.cf=s,this.l_=t._f(s),this.af=s.name,this.ff=new vo(r)}else{var u=n;if(!u.projectId)throw new h(c.INVALID_ARGUMENT,\"Must provide projectId\");this.l_=new P(u.projectId,u.database),this.af=\"[DEFAULT]\",this.ff=new po}this.df=new Uu({})}return Object.defineProperty(t.prototype,\"wf\",{get:function(){return this.Ef||(this.Ef=new mu(this.l_,this.df.ignoreUndefinedProperties)),this.Ef},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.df),t)).merge;var e=new Uu(t);if(this.lf&&!this.df.isEqual(e))throw new h(c.FAILED_PRECONDITION,\"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.\");this.df=e,void 0!==e.credentials&&(this.ff=function(t){if(!t)return new po;switch(t.type){case\"gapi\":var e=t.client;return m(!(\"object\"!=a(e)||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new go(e,t.sessionIndex||\"0\");case\"provider\":return t.client;default:throw new h(c.INVALID_ARGUMENT,\"makeCredentialsProvider failed due to invalid credential type\")}}(e.credentials))},t.prototype.useEmulator=function(t,e){\"firestore.googleapis.com\"!==this.df.host&&v(\"Host has been set in both settings() and useEmulator(), emulator host will be used\"),this.settings({host:t+\":\"+e,ssl:!1,merge:!0})},t.prototype.enableNetwork=function(){return this.uf(),this.lf.enableNetwork()},t.prototype.disableNetwork=function(){return this.uf(),this.lf.disableNetwork()},t.prototype.enablePersistence=function(t){if(this.lf)throw new h(c.FAILED_PRECONDITION,\"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.\");var e=!1,n=!1;return t&&Js(\"synchronizeTabs\",e=!!t.synchronizeTabs,\"experimentalForceOwningTab\",n=!!t.experimentalForceOwningTab),e?this.hf.enableMultiTabIndexedDbPersistence(this):this.hf.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(t){if(void 0!==this.lf&&!this.lf.j_)throw new h(c.FAILED_PRECONDITION,\"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.\");return[2,this.hf.clearIndexedDbPersistence(this)]})})},t.prototype.terminate=function(){return this.app._removeServiceInstance(\"firestore\"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,\"Tf\",{get:function(){return this.uf(),this.lf.j_},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.uf(),this.lf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.uf(),Vu(t))return this.lf.W_(t);var e={next:t};return this.lf.W_(e)},t.prototype.uf=function(){return this.lf||this.if(new zs,new Qs),this.lf},t.prototype.If=function(){return new k(this.l_,this.af,this.df.host,this.df.ssl,this.df.experimentalForceLongPolling,this.df.experimentalAutoDetectLongPolling)},t.prototype.if=function(t,e){var n=this.If();return this.lf=new Ou(this.ff,this.rf),this.lf.start(n,t,e)},t._f=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,\"projectId\"))throw new h(c.INVALID_ARGUMENT,'\"projectId\" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||\"string\"!=typeof n)throw new h(c.INVALID_ARGUMENT,\"projectId must be a string in FirebaseApp.options\");return new P(n)},Object.defineProperty(t.prototype,\"app\",{get:function(){if(!this.cf)throw new h(c.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this.cf},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return Ys(\"Firestore.collection\",\"path\",t),this.uf(),new ta(q.q(t),this,null)},t.prototype.doc=function(t){return Ys(\"Firestore.doc\",\"path\",t),this.uf(),zu.mf(q.q(t),this,null)},t.prototype.collectionGroup=function(t){if(Ys(\"Firestore.collectionGroup\",\"collectionId\",t),t.indexOf(\"/\")>=0)throw new h(c.INVALID_ARGUMENT,\"Invalid collection ID '\"+t+\"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.\");return this.uf(),new $u(function(t){return new yn(q.U(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return this.uf().transaction(function(n){return t(new Gu(e,n))})},t.prototype.batch=function(){return this.uf(),new Bu(this)},t.prototype.sf=function(){return this.df},t}(),Gu=function(){function t(t,e){this.Af=t,this.Rf=e}return t.prototype.get=function(t){var e=this,n=ea(\"Transaction.get\",t,this.Af);return this.Rf.b_([n.__]).then(function(t){if(!t||1!==t.length)return g();var r=t[0];if(r instanceof dn)return new Wu(e.Af,n.__,null,!1,!1,n.f_);if(r instanceof pn)return new Wu(e.Af,n.__,r,!1,!1,n.f_);throw g()})},t.prototype.set=function(t,e,n){var r=ea(\"Transaction.set\",t,this.Af);n=Xs(\"Transaction.set\",n);var i=ra(r.f_,e,n),o=wu(this.Af.wf,\"Transaction.set\",r.__,i,null!==r.f_,n);return this.Rf.set(r.__,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return\"string\"==typeof e||e instanceof eu?(r=ea(\"Transaction.update\",t,this.Af),i=bu(this.Af.wf,\"Transaction.update\",r.__,e,n,o)):(r=ea(\"Transaction.update\",t,this.Af),i=_u(this.Af.wf,\"Transaction.update\",r.__,e)),this.Rf.update(r.__,i),this},t.prototype.delete=function(t){var e=ea(\"Transaction.delete\",t,this.Af);return this.Rf.delete(e.__),this},t}(),Bu=function(){function t(t){this.Af=t,this.Pf=[],this.gf=!1}return t.prototype.set=function(t,e,n){this.Vf();var r=ea(\"WriteBatch.set\",t,this.Af);n=Xs(\"WriteBatch.set\",n);var i=ra(r.f_,e,n),o=wu(this.Af.wf,\"WriteBatch.set\",r.__,i,null!==r.f_,n);return this.Pf=this.Pf.concat(o.d_(r.__,We.ze())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Vf(),\"string\"==typeof e||e instanceof eu?(r=ea(\"WriteBatch.update\",t,this.Af),i=bu(this.Af.wf,\"WriteBatch.update\",r.__,e,n,o)):(r=ea(\"WriteBatch.update\",t,this.Af),i=_u(this.Af.wf,\"WriteBatch.update\",r.__,e)),this.Pf=this.Pf.concat(i.d_(r.__,We.exists(!0))),this},t.prototype.delete=function(t){this.Vf();var e=ea(\"WriteBatch.delete\",t,this.Af);return this.Pf=this.Pf.concat(new un(e.__,We.ze())),this},t.prototype.commit=function(){return this.Vf(),this.gf=!0,this.Pf.length>0?this.Af.uf().write(this.Pf):Promise.resolve()},t.prototype.Vf=function(){if(this.gf)throw new h(c.FAILED_PRECONDITION,\"A write batch can no longer be used after commit() has been called.\")},t}(),zu=function(t){function n(e,n,r){var i=this;return(i=t.call(this,n.l_,e,r)||this).__=e,i.firestore=n,i.f_=r,i.lf=i.firestore.uf(),i}return(0,e.__extends)(n,t),n.mf=function(t,e,r){if(t.length%2!=0)throw new h(c.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \"+t.B()+\" has \"+t.length);return new n(new G(t),e,r)},Object.defineProperty(n.prototype,\"id\",{get:function(){return this.__.path.O()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"parent\",{get:function(){return new ta(this.__.path.F(),this.firestore,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"path\",{get:function(){return this.__.path.B()},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){if(Ys(\"DocumentReference.collection\",\"path\",t),!t)throw new h(c.INVALID_ARGUMENT,\"Must provide a non-empty collection name to collection()\");var e=q.q(t);return new ta(this.__.path.child(e),this.firestore,null)},n.prototype.isEqual=function(t){return t instanceof n&&this.firestore===t.firestore&&this.__.isEqual(t.__)&&this.f_===t.f_},n.prototype.set=function(t,e){e=Xs(\"DocumentReference.set\",e);var n=ra(this.f_,t,e),r=wu(this.firestore.wf,\"DocumentReference.set\",this.__,n,null!==this.f_,e);return this.lf.write(r.d_(this.__,We.ze()))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n=\"string\"==typeof t||t instanceof eu?bu(this.firestore.wf,\"DocumentReference.update\",this.__,t,e,r):_u(this.firestore.wf,\"DocumentReference.update\",this.__,t),this.lf.write(n.d_(this.__,We.exists(!0)))},n.prototype.delete=function(){return this.lf.write([new un(this.__,We.ze())])},n.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s={includeMetadataChanges:!1},u=0;\"object\"!=a(i[u])||Vu(i[u])||(s=i[u],u++);var c={includeMetadataChanges:s.includeMetadataChanges};if(Vu(i[u])){var h=i[u];i[u]=null===(t=h.next)||void 0===t?void 0:t.bind(h),i[u+1]=null===(e=h.error)||void 0===e?void 0:e.bind(h),i[u+2]=null===(n=h.complete)||void 0===n?void 0:n.bind(h)}var f={next:function(t){i[u]&&i[u](r.yf(t))},error:i[u+1],complete:i[u+2]};return this.lf.listen(mn(this.__.path),c,f)},n.prototype.get=function(t){var e=this,n=this.firestore.uf();return t&&\"cache\"===t.source?n.q_(this.__).then(function(t){return new Wu(e.firestore,e.__,t,!0,t instanceof pn&&t.Ye,e.f_)}):n.U_(this.__,t).then(function(t){return e.yf(t)})},n.prototype.withConverter=function(t){return new n(this.__,this.firestore,t)},n.prototype.yf=function(t){var e=t.docs.get(this.__);return new Wu(this.firestore,this.__,e,t.fromCache,t.hasPendingWrites,this.f_)},n}(pu),Ku=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Wu=function(){function t(t,e,n,r,i,o){this.Af=t,this.__=e,this.pf=n,this.bf=r,this.vf=i,this.f_=o}return t.prototype.data=function(t){var e=this;if(void 0===t&&(t={}),this.pf){if(this.f_){var n=new Qu(this.Af,this.__,this.pf,this.bf,this.vf,null);return this.f_.fromFirestore(n,t)}return new Cu(this.Af.l_,t.serverTimestamps||\"none\",function(t){return new zu(t,e.Af,null)},function(t){return new x(t)}).J_(this.pf.rn())}},t.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.pf){var r=this.pf.data().field(Du(\"DocumentSnapshot.get\",t,this.__));if(null!==r)return new Cu(this.Af.l_,e.serverTimestamps||\"none\",function(t){return new zu(t,n.Af,n.f_)},function(t){return new x(t)}).J_(r)}},Object.defineProperty(t.prototype,\"id\",{get:function(){return this.__.path.O()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"ref\",{get:function(){return new zu(this.__,this.Af,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"exists\",{get:function(){return null!==this.pf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"metadata\",{get:function(){return new Ku(this.vf,this.bf)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&this.Af===e.Af&&this.bf===e.bf&&this.__.isEqual(e.__)&&(null===this.pf?null===e.pf:this.pf.isEqual(e.pf))&&this.f_===e.f_},t}(),Qu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.prototype.data=function(e){return t.prototype.data.call(this,e)},n}(Wu);function Hu(t,e,n){if(\"string\"==typeof n){if(\"\"===n)throw new h(c.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.\");if(!En(e)&&-1!==n.indexOf(\"/\"))throw new h(c.INVALID_ARGUMENT,\"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '\"+n+\"' contains a '/' character.\");var r=e.path.child(q.q(n));if(!G.X(r))throw new h(c.INVALID_ARGUMENT,\"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '\"+r+\"' is not because it has an odd number of segments (\"+r.length+\").\");return zt(t,new G(r))}if(n instanceof pu)return zt(t,n.__);throw new h(c.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: \"+$s(n)+\".\")}function Yu(t,e){if(!Array.isArray(t)||0===t.length)throw new h(c.INVALID_ARGUMENT,\"Invalid Query. A non-empty array is required for '\"+e.toString()+\"' filters.\");if(t.length>10)throw new h(c.INVALID_ARGUMENT,\"Invalid Query. '\"+e.toString()+\"' filters support a maximum of 10 elements in the value array.\")}function Xu(t,e,n){if(!n.isEqual(e))throw new h(c.INVALID_ARGUMENT,\"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '\"+e.toString()+\"' and so you must also use '\"+e.toString()+\"' as your first orderBy(), but your first orderBy() is on field '\"+n.toString()+\"' instead.\")}function Ju(t){if(_n(t)&&0===t.on.length)throw new h(c.UNIMPLEMENTED,\"limitToLast() queries require specifying at least one orderBy() clause\")}var $u=function(){function t(t,e,n){this.Sf=t,this.firestore=e,this.f_=n}return t.prototype.where=function(e,n,r){var i=Du(\"Query.where\",e),o=function(t,e,n,r,i,o,s){var u;if(i.W()){if(\"array-contains\"===o||\"array-contains-any\"===o)throw new h(c.INVALID_ARGUMENT,\"Invalid Query. You can't perform '\"+o+\"' queries on FieldPath.documentId().\");if(\"in\"===o||\"not-in\"===o){Yu(s,o);for(var a=[],f=0,l=s;f<l.length;f++){var p=l[f];a.push(Hu(r,t,p))}u={arrayValue:{values:a}}}else u=Hu(r,t,s)}else\"in\"!==o&&\"not-in\"!==o&&\"array-contains-any\"!==o||Yu(s,o),u=Iu(n,\"Query.where\",s,\"in\"===o||\"not-in\"===o);var d=Vn.create(i,o,u);return function(t,e){if(e.un()){var n=In(t);if(null!==n&&!n.isEqual(e.field))throw new h(c.INVALID_ARGUMENT,\"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '\"+n.toString()+\"' and '\"+e.field.toString()+\"'\");var r=bn(t);null!==r&&Xu(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(e.op){case\"!=\":return[\"!=\",\"not-in\"];case\"array-contains\":return[\"array-contains\",\"array-contains-any\",\"not-in\"];case\"in\":return[\"array-contains-any\",\"in\",\"not-in\"];case\"array-contains-any\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\"];case\"not-in\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\",\"!=\"];default:return[]}}());if(null!==i)throw i===e.op?new h(c.INVALID_ARGUMENT,\"Invalid query. You cannot use more than one '\"+e.op.toString()+\"' filter.\"):new h(c.INVALID_ARGUMENT,\"Invalid query. You cannot use '\"+e.op.toString()+\"' filters with '\"+i.toString()+\"' filters.\")}(t,d),d}(this.Sf,0,this.firestore.wf,this.firestore.l_,i,n,r);return new t(function(t,e){var n=t.filters.concat([e]);return new yn(t.path,t.collectionGroup,t.on.slice(),n,t.limit,t.an,t.startAt,t.endAt)}(this.Sf,o),this.firestore,this.f_)},t.prototype.orderBy=function(e,n){var r;if(void 0===n||\"asc\"===n)r=\"asc\";else{if(\"desc\"!==n)throw new h(c.INVALID_ARGUMENT,\"Function Query.orderBy() has unknown direction '\"+n+\"', expected 'asc' or 'desc'.\");r=\"desc\"}var i=Du(\"Query.orderBy\",e),o=function(t,e,n){if(null!==t.startAt)throw new h(c.INVALID_ARGUMENT,\"Invalid query. You must not call startAt() or startAfter() before calling orderBy().\");if(null!==t.endAt)throw new h(c.INVALID_ARGUMENT,\"Invalid query. You must not call endAt() or endBefore() before calling orderBy().\");var r=new Qn(e,n);return function(t,e){if(null===bn(t)){var n=In(t);null!==n&&Xu(0,n,e.field)}}(t,r),r}(this.Sf,i,r);return new t(function(t,e){var n=t.on.concat([e]);return new yn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(this.Sf,o),this.firestore,this.f_)},t.prototype.limit=function(e){return Zs(\"Query.limit\",e),new t(An(this.Sf,e,\"F\"),this.firestore,this.f_)},t.prototype.limitToLast=function(e){return Zs(\"Query.limitToLast\",e),new t(An(this.Sf,e,\"L\"),this.firestore,this.f_)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df(\"Query.startAt\",e,n,!0);return new t(Dn(this.Sf,i),this.firestore,this.f_)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df(\"Query.startAfter\",e,n,!1);return new t(Dn(this.Sf,i),this.firestore,this.f_)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df(\"Query.endBefore\",e,n,!0);return new t(Sn(this.Sf,i),this.firestore,this.f_)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Df(\"Query.endAt\",e,n,!1);return new t(Sn(this.Sf,i),this.firestore,this.f_)},t.prototype.isEqual=function(e){return e instanceof t&&this.firestore===e.firestore&&xn(this.Sf,e.Sf)&&this.f_===e.f_},t.prototype.withConverter=function(e){return new t(this.Sf,this.firestore,e)},t.prototype.Df=function(t,e,n,r){if(e instanceof Wu)return function(t,e,n,r,i){if(!r)throw new h(c.NOT_FOUND,\"Can't use a DocumentSnapshot that doesn't exist for \"+n+\"().\");for(var o=[],s=0,u=Tn(t);s<u.length;s++){var a=u[s];if(a.field.W())o.push(zt(e,r.key));else{var f=r.field(a.field);if(kt(f))throw new h(c.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field \"'+a.field+'\" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){var l=a.field.B();throw new h(c.INVALID_ARGUMENT,\"Invalid query. You are trying to start or end a query using a document for which the field '\"+l+\"' (used as the orderBy) does not exist.\")}o.push(f)}}return new Bn(o,i)}(this.Sf,this.firestore.l_,t,e.pf,r);var i=[e].concat(n);return function(t,e,n,r,i,o){var s=t.on;if(i.length>s.length)throw new h(c.INVALID_ARGUMENT,\"Too many arguments provided to \"+r+\"(). The number of arguments must be less than or equal to the number of orderBy() clauses\");for(var u=[],f=0;f<i.length;f++){var l=i[f];if(s[f].field.W()){if(\"string\"!=typeof l)throw new h(c.INVALID_ARGUMENT,\"Invalid query. Expected a string for document ID in \"+r+\"(), but got a \"+a(l));if(!En(t)&&-1!==l.indexOf(\"/\"))throw new h(c.INVALID_ARGUMENT,\"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must be a plain document ID, but '\"+l+\"' contains a slash.\");var p=t.path.child(q.q(l));if(!G.X(p))throw new h(c.INVALID_ARGUMENT,\"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must result in a valid document path, but '\"+p+\"' is not because it contains an odd number of segments.\");var d=new G(p);u.push(zt(e,d))}else{var v=Iu(n,r,l);u.push(v)}}return new Bn(u,o)}(this.Sf,this.firestore.l_,this.firestore.wf,t,i,r)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s={},u=0;if(\"object\"!=a(i[u])||Vu(i[u])||(s=i[u],u++),Vu(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}var h={next:function(t){i[u]&&i[u](new Zu(r.firestore,r.Sf,t,r.f_))},error:i[u+1],complete:i[u+2]};return Ju(this.Sf),this.firestore.uf().listen(this.Sf,s,h)},t.prototype.get=function(t){var e=this;Ju(this.Sf);var n=this.firestore.uf();return(t&&\"cache\"===t.source?n.K_(this.Sf):n.Q_(this.Sf,t)).then(function(t){return new Zu(e.firestore,e.Sf,t,e.f_)})},t}(),Zu=function(){function t(t,e,n,r){this.Af=t,this.Cf=e,this.Nf=n,this.f_=r,this.xf=null,this.Ff=null,this.metadata=new Ku(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,\"docs\",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"empty\",{get:function(){return this.Nf.docs.P()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this.Nf.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this.Nf.docs.forEach(function(r){t.call(e,n.kf(r,n.metadata.fromCache,n.Nf.Qt.has(r.key)))})},Object.defineProperty(t.prototype,\"query\",{get:function(){return new $u(this.Cf,this.Af,this.f_)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=!(!t||!t.includeMetadataChanges);if(e&&this.Nf.jt)throw new h(c.INVALID_ARGUMENT,\"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().\");return this.xf&&this.Ff===e||(this.xf=function(t,e,n){if(t.Kt.P()){var r=0;return t.docChanges.map(function(e){var i=n(e.doc,t.fromCache,t.Qt.has(e.doc.key));return e.doc,{type:\"added\",doc:i,oldIndex:-1,newIndex:r++}})}var i=t.Kt;return t.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var r=n(e.doc,t.fromCache,t.Qt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:na(e.type),doc:r,oldIndex:o,newIndex:s}})}(this.Nf,e,this.kf.bind(this)),this.Ff=e),this.xf},t.prototype.isEqual=function(e){return e instanceof t&&this.Af===e.Af&&xn(this.Cf,e.Cf)&&this.Nf.isEqual(e.Nf)&&this.f_===e.f_},t.prototype.kf=function(t,e,n){return new Qu(this.Af,t.key,t,e,n,this.f_)},t}(),ta=function(t){function n(e,n,r){var i=this;if((i=t.call(this,mn(e),n,r)||this).Of=e,e.length%2!=1)throw new h(c.INVALID_ARGUMENT,\"Invalid collection reference. Collection references must have an odd number of segments, but \"+e.B()+\" has \"+e.length);return i}return(0,e.__extends)(n,t),Object.defineProperty(n.prototype,\"id\",{get:function(){return this.Sf.path.O()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"parent\",{get:function(){var t=this.Sf.path.F();return t.P()?null:new zu(new G(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,\"path\",{get:function(){return this.Sf.path.B()},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){0===arguments.length&&(t=b.t()),Ys(\"CollectionReference.doc\",\"path\",t);var e=q.q(t);return zu.mf(this.Sf.path.child(e),this.firestore,this.f_)},n.prototype.add=function(t){var e=this.f_?this.f_.toFirestore(t):t,n=this.doc();return new zu(n.__,this.firestore,null).set(e).then(function(){return n})},n.prototype.withConverter=function(t){return new n(this.Of,this.firestore,t)},n}($u);function ea(t,e,n){var r=function(t,e){if(!(t instanceof e)){if(e.name===t.constructor.name)throw new h(c.INVALID_ARGUMENT,\"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?\");var n=$s(t);throw new h(c.INVALID_ARGUMENT,\"Expected type '\"+e.name+\"', but it was: \"+n)}return t}(e,zu);if(r.firestore!==n)throw new h(c.INVALID_ARGUMENT,\"Provided document reference is from a different Firestore instance.\");return r}function na(t){switch(t){case 0:return\"added\";case 2:case 3:return\"modified\";case 1:return\"removed\";default:return g()}}function ra(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ia=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return(0,e.__extends)(n,t),n.serverTimestamp=function(){var t=new su(\"serverTimestamp\");return t.t_=\"FieldValue.serverTimestamp\",new n(t)},n.delete=function(){var t=new iu(\"deleteField\");return t.t_=\"FieldValue.delete\",new n(t)},n.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new uu(\"arrayUnion\",t)}.apply(void 0,t);return r.t_=\"FieldValue.arrayUnion\",new n(r)},n.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new au(\"arrayRemove\",t)}.apply(void 0,t);return r.t_=\"FieldValue.arrayRemove\",new n(r)},n.increment=function(t){var e=function(t){return new cu(\"increment\",t)}(t);return e.t_=\"FieldValue.increment\",new n(e)},n.prototype.isEqual=function(t){return this.u_.isEqual(t.u_)},n}(fu),oa={Firestore:ju,GeoPoint:hu,Timestamp:R,Blob:x,Transaction:Gu,WriteBatch:Bu,DocumentReference:zu,DocumentSnapshot:Wu,Query:$u,QueryDocumentSnapshot:Qu,QuerySnapshot:Zu,CollectionReference:ta,FieldPath:eu,FieldValue:ia,setLogLevel:function(t){var e;e=t,f.setLogLevel(e)},CACHE_SIZE_UNLIMITED:Ru};function sa(t){!function(t,e){t.INTERNAL.registerComponent(new s.Component(\"firestore\",function(t){return function(t,e){return new ju(t,e,new Fu)}(t.getProvider(\"app\").getImmediate(),t.getProvider(\"auth-internal\"))},\"PUBLIC\").setServiceProps(Object.assign({},oa)))}(t),t.registerVersion(\"@firebase/firestore\",\"2.0.0\")}sa(n.default);"},"sourceMaps":null,"error":null,"hash":"6c6b6cf8ba5a30f8e9d3a66b672a0bc6","cacheData":{"env":{}}}